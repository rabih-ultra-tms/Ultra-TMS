generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model APIAuditLog {
  id             String   @id @default(uuid())
  tenantId       String?
  userId         String?
  apiKeyId       String?
  endpoint       String   @db.VarChar(500)
  method         String   @db.VarChar(10)
  requestParams  Json?    @default("{}")
  responseStatus Int
  responseTimeMs Int
  ipAddress      String?  @db.VarChar(45)
  timestamp      DateTime @default(now())
  Tenant         Tenant?  @relation(fields: [tenantId], references: [id])
  user                User?              @relation(fields: [userId], references: [id])

  @@index([apiKeyId])
  @@index([endpoint])
  @@index([tenantId])
  @@index([timestamp])
  @@index([userId])
}

model APIRequestLog {
  id             String      @id @default(uuid())
  tenantId       String
  integrationId  String
  endpoint       String      @db.VarChar(500)
  method         String      @db.VarChar(10)
  requestHeaders Json        @default("{}")
  requestBody    Json?       @default("{}")
  responseStatus Int
  responseBody   Json?       @default("{}")
  durationMs     Int
  timestamp      DateTime    @default(now())
  integration    Integration @relation(fields: [integrationId], references: [id], onDelete: Cascade)
  tenant         Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([endpoint])
  @@index([integrationId])
  @@index([tenantId])
  @@index([timestamp])
}

model AccessLog {
  id           String   @id @default(uuid())
  tenantId     String?
  userId       String?
  resourceType String   @db.VarChar(50)
  resourceId   String   @db.VarChar(255)
  action       String   @db.VarChar(100)
  granted      Boolean
  denialReason String?
  ipAddress    String?  @db.VarChar(45)
  userAgent    String?
  timestamp    DateTime @default(now())
  Tenant       Tenant?  @relation(fields: [tenantId], references: [id])
  user                User?              @relation(fields: [userId], references: [id])

  @@index([granted])
  @@index([resourceType, resourceId])
  @@index([tenantId])
  @@index([timestamp])
  @@index([userId])
}

model AccessorialRate {
  id                    String        @id @default(uuid())
  tenantId              String
  contractId            String?
  accessorialType       String        @db.VarChar(50)
  name                  String        @db.VarChar(255)
  description           String?
  rateType              String        @db.VarChar(50)
  rateAmount            Decimal       @db.Decimal(10, 2)
  minimumCharge         Decimal?      @db.Decimal(10, 2)
  maximumCharge         Decimal?      @db.Decimal(10, 2)
  appliesToServiceTypes String[]      @db.VarChar(50)
  isDefault             Boolean       @default(false)
  status                String        @default("ACTIVE") @db.VarChar(50)
  createdAt             DateTime      @default(now())
  updatedAt             DateTime @updatedAt
  createdById           String?
  customFields          Json          @default("{}")
  deletedAt             DateTime?
  externalId            String?       @db.VarChar(255)
  sourceSystem          String?       @db.VarChar(100)
  updatedById           String?
  contract              RateContract? @relation(fields: [contractId], references: [id], onDelete: Cascade)
  tenant                Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([accessorialType])
  @@index([contractId])
  @@index([tenantId])
}

model Activity {
  id                  String       @id @default(uuid())
  tenantId            String
  entityType          String       @db.VarChar(50)
  entityId            String
  activityType        String       @db.VarChar(50)
  subject             String?      @db.VarChar(255)
  description         String?
  activityDate        DateTime     @default(now())
  durationMinutes     Int?
  dueDate             DateTime?
  completedAt         DateTime?
  priority            String?      @db.VarChar(20)
  status              String       @default("PENDING") @db.VarChar(50)
  ownerId             String?
  companyId           String?
  contactId           String?
  opportunityId       String?
  hubspotEngagementId String?      @db.VarChar(50)
  externalId          String?      @db.VarChar(255)
  sourceSystem        String?      @db.VarChar(100)
  customFields        Json         @default("{}")
  createdAt           DateTime     @default(now())
  updatedAt           DateTime @updatedAt
  deletedAt           DateTime?
  createdById         String?
  updatedById         String?
  company             Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contact             Contact?     @relation(fields: [contactId], references: [id], onDelete: Cascade)
  opportunity         Opportunity? @relation(fields: [opportunityId], references: [id], onDelete: Cascade)
  owner                User?              @relation(fields: [ownerId], references: [id])
  tenant              Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([activityDate])
  @@index([activityType])
  @@index([companyId])
  @@index([contactId])
  @@index([dueDate])
  @@index([entityType, entityId])
  @@index([externalId, sourceSystem])
  @@index([hubspotEngagementId])
  @@index([opportunityId])
  @@index([ownerId])
  @@index([status])
  @@index([tenantId])
}

model Agent {
  id                      String                    @id @default(uuid())
  tenantId                String
  agentCode               String                    @db.VarChar(20)
  agentType               AgentType
  status                  AgentStatus               @default(PENDING)
  externalId              String?                   @db.VarChar(100)
  sourceSystem            String?                   @db.VarChar(50)
  customFields            Json                      @default("{}")
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime @updatedAt
  deletedAt               DateTime?
  createdById             String?
  companyName             String                    @db.VarChar(200)
  contactEmail            String                    @db.VarChar(255)
  contactFirstName        String                    @db.VarChar(100)
  contactLastName         String                    @db.VarChar(100)
  contactPhone            String?                   @db.VarChar(20)
  addressLine1            String?                   @db.VarChar(200)
  addressLine2            String?                   @db.VarChar(200)
  city                    String?                   @db.VarChar(100)
  state                   String?                   @db.VarChar(50)
  zip                     String?                   @db.VarChar(20)
  country                 String                    @default("USA") @db.VarChar(3)
  dbaName                 String?                   @db.VarChar(200)
  legalEntityType         String?                   @db.VarChar(50)
  taxId                   String?                   @db.VarChar(20)
  territories             Json                      @default("[]")
  industryFocus           Json                      @default("[]")
  applicationDate         DateTime?
  backgroundCheckStatus   String?                   @db.VarChar(20)
  backgroundCheckDate     DateTime?
  trainingCompleted       Boolean                   @default(false)
  trainingCompletedDate   DateTime?
  activatedAt             DateTime?
  activatedBy             String?
  tier                    AgentTier                 @default(STANDARD)
  paymentMethod           String?                   @db.VarChar(20)
  bankName                String?                   @db.VarChar(100)
  bankRouting             String?                   @db.VarChar(20)
  bankAccount             String?                   @db.VarChar(50)
  bankAccountType         String?                   @db.VarChar(20)
  terminatedAt            DateTime?
  terminatedBy            String?
  terminationReason       String?
  tenant                  Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  AgentAgreement          AgentAgreement[]
  commissions         AgentCommission[]
  AgentContact            AgentContact[]
  AgentCustomerAssignment AgentCustomerAssignment[]
  AgentDrawBalance        AgentDrawBalance[]
  AgentLead               AgentLead[]
  AgentPayout             AgentPayout[]
  AgentPortalUser         AgentPortalUser[]
  Contract                Contract[]

  @@unique([tenantId, agentCode])
  @@index([agentType])
  @@index([contactEmail])
  @@index([status])
  @@index([tenantId])
}

model AgentAgreement {
  id                     String              @id @default(uuid())
  tenantId               String
  agentId                String
  agreementNumber        String              @db.VarChar(30)
  effectiveDate          DateTime            @db.Date
  expirationDate         DateTime?           @db.Date
  protectionPeriodMonths Int                 @default(12)
  createdAt              DateTime            @default(now())
  updatedAt              DateTime @updatedAt
  drawAmount             Decimal?            @db.Decimal(10, 2)
  drawFrequency          String?             @db.VarChar(20)
  drawRecoverable        Boolean             @default(true)
  minimumPayout          Decimal             @default(100) @db.Decimal(10, 2)
  minimumPerLoad         Decimal?            @db.Decimal(10, 2)
  name                   String?             @db.VarChar(200)
  paymentDay             Int                 @default(15)
  previousAgreementId    String?
  splitRate              Decimal?            @db.Decimal(5, 4)
  splitType              CommissionSplitType
  sunsetEnabled          Boolean             @default(false)
  sunsetPeriodMonths     Int?                @default(12)
  sunsetSchedule         Json                @default("[]")
  tiers                  Json                @default("[]")
  version                Int                 @default(1)
  status                 AgreementStatus     @default(ACTIVE)
  agent                  Agent               @relation(fields: [agentId], references: [id], onDelete: Cascade)
  AgentAgreement         AgentAgreement?     @relation("AgentAgreementToAgentAgreement", fields: [previousAgreementId], references: [id])
  other_AgentAgreement   AgentAgreement[]    @relation("AgentAgreementToAgentAgreement")
  tenant                 Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([agentId])
  @@index([effectiveDate])
  @@index([status])
}

model AgentCommission {
  id                      String                   @id @default(uuid())
  tenantId                String
  agentId                 String
  loadId                  String?
  orderId                 String?
  status                  AgentCommissionStatus    @default(CALCULATED)
  paidAt                  DateTime?
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime @updatedAt
  adjustments             Decimal                  @default(0) @db.Decimal(10, 2)
  assignmentId            String?
  commissionBase          Decimal                  @db.Decimal(12, 2)
  customerId              String?
  grossCommission         Decimal                  @db.Decimal(10, 2)
  invoiceId               String?
  loadMargin              Decimal?                 @db.Decimal(12, 2)
  loadRevenue             Decimal?                 @db.Decimal(12, 2)
  netCommission           Decimal                  @db.Decimal(10, 2)
  notes                   String?
  payoutId                String?
  salesRepCommission      Decimal?                 @db.Decimal(10, 2)
  splitRate               Decimal                  @db.Decimal(5, 4)
  splitType               CommissionSplitType
  commissionPeriod        String?                  @db.VarChar(7)
  agent                   Agent                    @relation(fields: [agentId], references: [id], onDelete: Cascade)
  AgentCustomerAssignment AgentCustomerAssignment? @relation(fields: [assignmentId], references: [id])
  company             Company?           @relation(fields: [customerId], references: [id])
  Invoice                 Invoice?                 @relation(fields: [invoiceId], references: [id])
  load                    Load?              @relation(fields: [loadId], references: [id])
  order               Order?             @relation(fields: [orderId], references: [id])
  AgentPayout             AgentPayout?             @relation(fields: [payoutId], references: [id])
  tenant                  Tenant                   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([agentId])
  @@index([commissionPeriod])
  @@index([customerId])
  @@index([invoiceId])
  @@index([loadId])
  @@index([orderId])
  @@index([status])
  @@index([tenantId])
}

model AgentContact {
  id              String            @id @default(uuid())
  tenantId        String
  agentId         String
  phone           String?           @db.VarChar(20)
  email           String?           @db.VarChar(255)
  isPrimary       Boolean           @default(false)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime @updatedAt
  firstName       String            @db.VarChar(100)
  lastName        String            @db.VarChar(100)
  mobile          String?           @db.VarChar(20)
  role            String?           @db.VarChar(50)
  hasPortalAccess Boolean           @default(false)
  isActive        Boolean           @default(true)
  agent           Agent             @relation(fields: [agentId], references: [id], onDelete: Cascade)
  tenant          Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  AgentPortalUser AgentPortalUser[]

  @@index([agentId])
  @@index([isPrimary])
  @@index([tenantId])
}

model AgentCustomerAssignment {
  id                   String            @id @default(uuid())
  tenantId             String
  agentId              String
  customerId           String
  splitPercent         Decimal?          @db.Decimal(5, 4)
  createdAt            DateTime          @default(now())
  updatedAt            DateTime @updatedAt
  createdById          String?
  currentSunsetRate    Decimal?          @db.Decimal(5, 4)
  inSunset             Boolean           @default(false)
  isProtected          Boolean           @default(true)
  leadId               String?
  overrideReason       String?
  overrideSplitRate    Decimal?          @db.Decimal(5, 4)
  protectionEnd        DateTime?
  protectionStart      DateTime
  source               String?           @db.VarChar(50)
  sunsetStartDate      DateTime?
  terminatedAt         DateTime?
  terminatedReason     String?
  transferredToAgentId String?
  assignmentType       AssignmentType
  status               AssignmentStatus  @default(ACTIVE)
  commissions      AgentCommission[]
  agent                Agent             @relation(fields: [agentId], references: [id], onDelete: Cascade)
  customer             Company?           @relation(fields: [customerId], references: [id], onDelete: Cascade)
  AgentLead            AgentLead?        @relation(fields: [leadId], references: [id])
  tenant               Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([agentId, customerId])
  @@index([assignmentType])
  @@index([customerId])
  @@index([status])
  @@index([tenantId])
}

model AgentDrawBalance {
  id                String    @id @default(uuid())
  tenantId          String
  agentId           String
  createdAt         DateTime  @default(now())
  updatedAt         DateTime @updatedAt
  amountRecovered   Decimal   @default(0) @db.Decimal(10, 2)
  carryoverBalance  Decimal   @default(0) @db.Decimal(10, 2)
  commissionsEarned Decimal   @default(0) @db.Decimal(10, 2)
  drawAmount        Decimal   @db.Decimal(10, 2)
  drawPaidAt        DateTime?
  period            String    @db.VarChar(7)
  shortfall         Decimal   @default(0) @db.Decimal(10, 2)
  agent             Agent     @relation(fields: [agentId], references: [id], onDelete: Cascade)
  tenant            Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([agentId])
  @@index([period])
  @@index([tenantId])
}

model AgentLead {
  id                      String                    @id @default(uuid())
  tenantId                String
  agentId                 String
  contactEmail            String?                   @db.VarChar(255)
  contactPhone            String?                   @db.VarChar(20)
  status                  LeadStatus                @default(SUBMITTED)
  convertedAt             DateTime?
  updatedAt               DateTime @updatedAt
  leadNumber              String                    @db.VarChar(20)
  companyName             String                    @db.VarChar(200)
  contactFirstName        String                    @db.VarChar(100)
  contactLastName         String                    @db.VarChar(100)
  contactTitle            String?                   @db.VarChar(100)
  conversionDeadline      DateTime?
  convertedCustomerId     String?
  equipmentNeeds          Json                      @default("[]")
  estimatedMonthlyRevenue Decimal?                  @db.Decimal(12, 2)
  estimatedMonthlyVolume  Int?
  industry                String?                   @db.VarChar(100)
  leadSource              String?                   @db.VarChar(50)
  notes                   String?
  primaryLanes            Json                      @default("[]")
  qualifiedAt             DateTime?
  qualifiedBy             String?
  rejectionReason         String?
  state                   String?                   @db.VarChar(50)
  submittedAt             DateTime                  @default(now())
  website                 String?                   @db.VarChar(255)
  assignedAt              DateTime?
  assignedTo              String?
  city                    String?                   @db.VarChar(100)
  AgentCustomerAssignment AgentCustomerAssignment[]
  agent                   Agent                     @relation(fields: [agentId], references: [id], onDelete: Cascade)
  company             Company?           @relation(fields: [convertedCustomerId], references: [id])
  tenant                  Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, leadNumber])
  @@index([agentId])
  @@index([conversionDeadline])
  @@index([status])
}

model AgentPayout {
  id                  String            @id @default(uuid())
  tenantId            String
  agentId             String
  payoutNumber        String            @db.VarChar(30)
  periodStart         DateTime          @db.Date
  periodEnd           DateTime          @db.Date
  paymentDate         DateTime?         @db.Date
  paymentMethod       PaymentMethod?
  createdAt           DateTime          @default(now())
  updatedAt           DateTime @updatedAt
  createdById         String?
  adjustments         Decimal           @default(0) @db.Decimal(10, 2)
  approvedAt          DateTime?
  approvedBy          String?
  drawRecovery        Decimal           @default(0) @db.Decimal(10, 2)
  grossCommissions    Decimal           @db.Decimal(12, 2)
  netAmount           Decimal           @db.Decimal(12, 2)
  paymentReference    String?           @db.VarChar(100)
  statementDocumentId String?
  status              AgentPayoutStatus @default(PENDING)
  commissions     AgentCommission[]
  agent               Agent             @relation(fields: [agentId], references: [id], onDelete: Cascade)
  document            Document?         @relation(fields: [statementDocumentId], references: [id])
  tenant              Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([agentId])
  @@index([periodStart, periodEnd])
  @@index([status])
  @@index([tenantId])
}

model AgentPortalUser {
  id                String        @id @default(uuid())
  tenantId          String
  agentId           String
  userId            String?
  role              String        @default("USER") @db.VarChar(20)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime @updatedAt
  agentContactId    String?
  email             String        @db.VarChar(255)
  firstName         String        @db.VarChar(100)
  lastLoginAt       DateTime?
  lastName          String        @db.VarChar(100)
  passwordChangedAt DateTime?
  passwordHash      String        @db.VarChar(255)
  status            String        @default("ACTIVE") @db.VarChar(20)
  AgentContact      AgentContact? @relation(fields: [agentContactId], references: [id])
  agent             Agent         @relation(fields: [agentId], references: [id], onDelete: Cascade)
  tenant            Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User?              @relation(fields: [userId], references: [id])

  @@unique([tenantId, email])
  @@index([agentId])
  @@index([tenantId])
  @@index([userId])
}

model AnalyticsCache {
  id         String   @id @default(uuid())
  tenantId   String
  cacheKey   String   @unique @db.VarChar(255)
  queryHash  String   @db.VarChar(64)
  resultData Json     @default("{}")
  createdAt  DateTime @default(now())
  expiresAt  DateTime
  hitCount   Int      @default(0)
  updatedAt  DateTime @updatedAt
  tenant     Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([hitCount])
  @@index([queryHash])
  @@index([tenantId])
}

model ApprovalRequest {
  id            String       @id @default(uuid())
  tenantId      String
  requestNumber String       @db.VarChar(50)
  title         String       @db.VarChar(255)
  description   String?
  approvalType  ApprovalType
  entityType    String       @db.VarChar(50)
  entityId      String
  approverIds   String[]
  status        String       @default("PENDING") @db.VarChar(50)
  dueDate       DateTime?    @db.Date
  decidedBy     String?
  decidedAt     DateTime?
  decision      String?      @db.VarChar(50)
  comments      String?
  externalId    String?      @db.VarChar(255)
  sourceSystem  String?      @db.VarChar(100)
  customFields  Json         @default("{}")
  createdAt     DateTime     @default(now())
  updatedAt     DateTime @updatedAt
  deletedAt     DateTime?
  createdById   String?
  updatedById   String?
  tenant        Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, requestNumber])
  @@index([entityType, entityId])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId])
}

model AuditAlert {
  id                 String               @id @default(uuid())
  tenantId           String
  alertName          String               @db.VarChar(255)
  triggerConditions  Json                 @default("{}")
  severity           AuditSeverityLevel
  notifyUsers        Json                 @default("[]")
  isActive           Boolean              @default(true)
  externalId         String?              @db.VarChar(255)
  sourceSystem       String?              @db.VarChar(100)
  customFields       Json                 @default("{}")
  createdAt          DateTime             @default(now())
  updatedAt          DateTime @updatedAt
  deletedAt          DateTime?
  createdById        String?
  updatedById        String?
  tenant             Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  AuditAlertIncident AuditAlertIncident[]

  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([severity])
  @@index([tenantId])
}

model AuditAlertIncident {
  id             String             @id @default(uuid())
  tenantId       String
  auditAlertId   String
  triggeredAt    DateTime           @default(now())
  triggerData    Json               @default("{}")
  severity       AuditSeverityLevel
  acknowledgedBy String?
  acknowledgedAt DateTime?
  resolvedAt     DateTime?
  notes          String?
  externalId     String?            @db.VarChar(255)
  sourceSystem   String?            @db.VarChar(100)
  customFields   Json               @default("{}")
  createdAt      DateTime           @default(now())
  updatedAt      DateTime @updatedAt
  deletedAt      DateTime?
  createdById    String?
  updatedById    String?
  auditAlert     AuditAlert         @relation(fields: [auditAlertId], references: [id], onDelete: Cascade)
  tenant         Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([auditAlertId])
  @@index([externalId, sourceSystem])
  @@index([resolvedAt])
  @@index([severity])
  @@index([tenantId])
  @@index([triggeredAt])
}

model AuditLog {
  id           String              @id @default(uuid())
  tenantId     String?
  userId       String?
  action       AuditAction
  category     AuditActionCategory
  severity     AuditSeverity       @default(INFO)
  entityType   String?             @db.VarChar(50)
  entityId     String?
  description  String?
  metadata     Json                @default("{}")
  ipAddress    String?             @db.VarChar(45)
  userAgent    String?
  externalId   String?             @db.VarChar(255)
  sourceSystem String?             @db.VarChar(100)
  customFields Json                @default("{}")
  createdAt    DateTime            @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  Tenant       Tenant?             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([action])
  @@index([category])
  @@index([createdAt])
  @@index([entityId])
  @@index([entityType, entityId])
  @@index([externalId, sourceSystem])
  @@index([severity])
  @@index([tenantId, action])
  @@index([tenantId, createdAt])
  @@index([tenantId, entityType])
  @@index([tenantId])
  @@index([tenantId, userId])
  @@index([userId])
}

model AuditRetentionPolicy {
  id               String    @id @default(uuid())
  tenantId         String
  entityType       String    @db.VarChar(100)
  retentionDays    Int
  archiveAfterDays Int?
  deleteAfterDays  Int?
  isActive         Boolean   @default(true)
  externalId       String?   @db.VarChar(255)
  sourceSystem     String?   @db.VarChar(100)
  customFields     Json      @default("{}")
  createdAt        DateTime  @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  createdById      String?
  updatedById      String?
  tenant           Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, entityType])
  @@index([entityType])
  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([tenantId])
}

model AuthorityChange {
  id           String    @id @default(uuid())
  tenantId     String
  carrierId    String
  changeType   String    @db.VarChar(100)
  changeDate   DateTime  @db.Date
  oldValue     String?
  newValue     String?
  description  String?
  sourceAgency String?   @db.VarChar(100)
  externalId   String?   @db.VarChar(255)
  sourceSystem String?   @db.VarChar(100)
  customFields Json      @default("{}")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([carrierId])
  @@index([changeDate])
  @@index([changeType])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
}

model BoardMetric {
  id                String    @id @default(uuid())
  tenantId          String
  accountId         String?
  periodType        String    @db.VarChar(20)
  periodStart       DateTime  @db.Date
  periodEnd         DateTime  @db.Date
  postsCreated      Int       @default(0)
  postsActive       Int       @default(0)
  postsExpired      Int       @default(0)
  postsCovered      Int       @default(0)
  totalViews        Int       @default(0)
  totalClicks       Int       @default(0)
  totalLeads        Int       @default(0)
  leadsContacted    Int       @default(0)
  leadsConverted    Int       @default(0)
  avgClickRate      Decimal?  @db.Decimal(5, 2)
  avgConversionRate Decimal?  @db.Decimal(5, 2)
  avgPostedRate     Decimal?  @db.Decimal(10, 2)
  avgAcceptedRate   Decimal?  @db.Decimal(10, 2)
  externalId        String?   @db.VarChar(255)
  sourceSystem      String?   @db.VarChar(100)
  customFields      Json      @default("{}")
  createdAt         DateTime  @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  tenant            Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, accountId, periodType, periodStart])
  @@index([accountId])
  @@index([externalId, sourceSystem])
  @@index([periodStart])
  @@index([periodType])
  @@index([tenantId])
}

model BusinessHours {
  id           String    @id @default(uuid())
  tenantId     String
  locationId   String?
  dayOfWeek    DayOfWeek
  openTime     String    @db.VarChar(5)
  closeTime    String    @db.VarChar(5)
  isClosed     Boolean   @default(false)
  timezone     String    @db.VarChar(50)
  externalId   String?   @db.VarChar(255)
  sourceSystem String?   @db.VarChar(100)
  customFields Json      @default("{}")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  location     Location? @relation(fields: [locationId], references: [id])
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([dayOfWeek])
  @@index([externalId, sourceSystem])
  @@index([locationId])
  @@index([tenantId])
}

model CacheConfig {
  id           String    @id @default(uuid())
  tenantId     String
  cacheType    CacheType
  key          String    @db.VarChar(255)
  ttlSeconds   Int       @default(3600)
  tags         String[]
  externalId   String?   @db.VarChar(255)
  sourceSystem String?   @db.VarChar(100)
  customFields Json      @default("{}")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, cacheType, key])
  @@index([cacheType])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
}

model CacheInvalidationRule {
  id               String    @id @default(uuid())
  tenantId         String
  triggerEvent     String    @db.VarChar(100)
  cachePattern     String    @db.VarChar(200)
  invalidationType String    @db.VarChar(20)
  isEnabled        Boolean   @default(true)
  externalId       String?   @db.VarChar(255)
  sourceSystem     String?   @db.VarChar(100)
  customFields     Json      @default("{}")
  createdAt        DateTime  @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  createdById      String?
  updatedById      String?
  tenant           Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([isEnabled])
  @@index([tenantId])
  @@index([triggerEvent])
}

model CacheStats {
  id           String    @id @default(uuid())
  tenantId     String?
  statDate     DateTime  @db.Date
  statHour     Int
  cacheType    String    @db.VarChar(50)
  hits         Int       @default(0)
  misses       Int       @default(0)
  sets         Int       @default(0)
  deletes      Int       @default(0)
  expirations  Int       @default(0)
  keysCount    Int?
  memoryBytes  BigInt?
  externalId   String?   @db.VarChar(255)
  sourceSystem String?   @db.VarChar(100)
  customFields Json      @default("{}")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  Tenant       Tenant?   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, statDate, statHour, cacheType])
  @@index([externalId, sourceSystem])
  @@index([statDate, statHour])
  @@index([tenantId])
}

model CannedResponse {
  id           String    @id @default(uuid())
  tenantId     String
  title        String    @db.VarChar(200)
  content      String
  category     String?   @db.VarChar(100)
  useCount     Int       @default(0)
  isPublic     Boolean   @default(false)
  ownerId      String?
  isActive     Boolean   @default(true)
  externalId   String?   @db.VarChar(255)
  sourceSystem String?   @db.VarChar(100)
  customFields Json      @default("{}")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([ownerId])
  @@index([tenantId])
}

model CapacityResult {
  id             String         @id @default(uuid())
  tenantId       String
  searchId       String
  carrierName    String         @db.VarChar(255)
  carrierMC      String?        @db.VarChar(20)
  carrierDOT     String?        @db.VarChar(20)
  contactName    String?        @db.VarChar(255)
  contactPhone   String?        @db.VarChar(20)
  truckLocation  String         @db.VarChar(500)
  truckCity      String?        @db.VarChar(100)
  truckState     String?        @db.VarChar(2)
  truckZip       String?        @db.VarChar(10)
  equipmentType  String         @db.VarChar(50)
  availableDate  DateTime       @db.Date
  length         Int?
  comments       String?
  contacted      Boolean        @default(false)
  contactedAt    DateTime?
  interested     Boolean?
  notes          String?
  externalId     String?        @db.VarChar(255)
  sourceSystem   String?        @db.VarChar(100)
  customFields   Json           @default("{}")
  createdAt      DateTime       @default(now())
  updatedAt      DateTime @updatedAt
  deletedAt      DateTime?
  createdById    String?
  updatedById    String?
  capacitySearch CapacitySearch @relation(fields: [searchId], references: [id], onDelete: Cascade)
  tenant         Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([availableDate])
  @@index([contacted])
  @@index([equipmentType])
  @@index([externalId, sourceSystem])
  @@index([searchId])
  @@index([tenantId])
  @@index([truckState])
}

model CapacitySearch {
  id             String           @id @default(uuid())
  tenantId       String
  accountId      String?
  searchNumber   String           @unique @db.VarChar(50)
  originCity     String?          @db.VarChar(100)
  originState    String           @db.VarChar(2)
  originRadius   Int?
  destCity       String?          @db.VarChar(100)
  destState      String           @db.VarChar(2)
  destRadius     Int?
  equipmentType  String           @db.VarChar(50)
  availableDate  DateTime         @db.Date
  minLength      Int?
  minWeight      Int?
  maxAge         String?          @db.VarChar(50)
  resultCount    Int              @default(0)
  externalId     String?          @db.VarChar(255)
  sourceSystem   String?          @db.VarChar(100)
  customFields   Json             @default("{}")
  createdAt      DateTime         @default(now())
  updatedAt      DateTime @updatedAt
  deletedAt      DateTime?
  createdById    String?
  updatedById    String?
  results CapacityResult[]
  tenant         Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([availableDate])
  @@index([createdAt])
  @@index([destState])
  @@index([equipmentType])
  @@index([externalId, sourceSystem])
  @@index([originState])
  @@index([searchNumber])
  @@index([tenantId])
}

model Carrier {
  id                        String                      @id @default(uuid())
  tenantId                  String
  mcNumber                  String?                     @db.VarChar(20)
  dotNumber                 String?                     @db.VarChar(20)
  scacCode                  String?                     @db.VarChar(10)
  carrierCode               String?                     @db.VarChar(50)
  legalName                 String                      @db.VarChar(255)
  dbaName                   String?                     @db.VarChar(255)
  companyType               String?                     @db.VarChar(50)
  primaryContactName        String?                     @db.VarChar(255)
  primaryContactEmail       String?                     @db.VarChar(255)
  primaryContactPhone       String?                     @db.VarChar(50)
  dispatchEmail             String?                     @db.VarChar(255)
  dispatchPhone             String?                     @db.VarChar(50)
  afterHoursPhone           String?                     @db.VarChar(50)
  addressLine1              String?                     @db.VarChar(255)
  addressLine2              String?                     @db.VarChar(255)
  city                      String?                     @db.VarChar(100)
  state                     String?                     @db.VarChar(50)
  postalCode                String?                     @db.VarChar(20)
  country                   String                      @default("USA") @db.VarChar(3)
  taxId                     String?                     @db.VarChar(50)
  w9OnFile                  Boolean                     @default(false)
  taxClassification         String?                     @db.VarChar(50)
  paymentTerms              String?                     @db.VarChar(50)
  quickPayFeePercent        Decimal?                    @db.Decimal(5, 2)
  factoringCompany          String?                     @db.VarChar(255)
  factoringAccount          String?                     @db.VarChar(100)
  bankName                  String?                     @db.VarChar(255)
  bankRoutingNumber         String?                     @db.VarChar(50)
  bankAccountNumberEnc      String?                     @db.VarChar(255)
  bankAccountType           String?                     @db.VarChar(20)
  equipmentTypes            String[]                    @db.VarChar(50)
  truckCount                Int?
  trailerCount              Int?
  serviceStates             String[]                    @db.VarChar(3)
  preferredLanes            Json                        @default("[]")
  status                    String                      @default("PENDING") @db.VarChar(50)
  qualificationTier         String?                     @db.VarChar(20)
  qualificationDate         DateTime?
  fmcsaAuthorityStatus      String?                     @db.VarChar(50)
  fmcsaCommonAuthority      Boolean?
  fmcsaContractAuthority    Boolean?
  fmcsaBrokerAuthority      Boolean?
  fmcsaSafetyRating         String?                     @db.VarChar(50)
  fmcsaOutOfService         Boolean                     @default(false)
  fmcsaLastChecked          DateTime?
  complianceScore           Int?
  safetyScore               Int?
  totalLoads                Int                         @default(0)
  onTimePickupRate          Decimal?                    @db.Decimal(5, 2)
  onTimeDeliveryRate        Decimal?                    @db.Decimal(5, 2)
  claimsRate                Decimal?                    @db.Decimal(5, 2)
  avgRating                 Decimal?                    @db.Decimal(3, 2)
  preferredLanguage         String                      @default("en") @db.VarChar(10)
  communicationPreference   String?                     @db.VarChar(20)
  internalNotes             String?
  onboardingNotes           String?
  externalId                String?                     @db.VarChar(255)
  sourceSystem              String?                     @db.VarChar(100)
  customFields              Json                        @default("{}")
  tags                      String[]                    @db.VarChar(100)
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime @updatedAt
  deletedAt                 DateTime?
  createdById               String?
  updatedById               String?
  AuthorityChange           AuthorityChange[]
  tenant                    Tenant                      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  CarrierCapacity           CarrierCapacity[]
  contacts CarrierContact[]
  documents                 CarrierDocument[]
  CarrierFactoringStatus    CarrierFactoringStatus?
  CarrierInsurance          CarrierInsurance[]
  CarrierInvoiceSubmission  CarrierInvoiceSubmission[]
  CarrierLoadView           CarrierLoadView[]
  CarrierPerformanceHistory CarrierPerformanceHistory[]
  CarrierPortalActivityLog  CarrierPortalActivityLog[]
  CarrierPortalDocument     CarrierPortalDocument[]
  CarrierPortalSession      CarrierPortalSession[]
  CarrierPortalUser         CarrierPortalUser[]
  CarrierQuickPayRequest    CarrierQuickPayRequest[]
  CarrierWatchlist          CarrierWatchlist[]
  Claim                     Claim[]
  Contract                  Contract[]
  CsaScore                  CsaScore[]
  Document                  Document[]
  drivers Driver[]
  FmcsaCarrierRecord        FmcsaCarrierRecord?
  FmcsaComplianceLog        FmcsaComplianceLog[]
  insuranceCertificates InsuranceCertificate[]
  loads Load[]
  LoadBid                   LoadBid[]
  LoadTender                LoadTender[]
  NOARecord                 NOARecord[]
  PaymentMade               PaymentMade[]
  PostLead                  PostLead[]
  SafetyAlert               SafetyAlert[]
  SafetyAuditTrail          SafetyAuditTrail[]
  SafetyIncident            SafetyIncident[]
  SafetyInspection          SafetyInspection[]
  Settlement                Settlement[]
  TenderRecipient           TenderRecipient[]

  @@unique([tenantId, dotNumber])
  @@unique([tenantId, mcNumber])
  @@index([dotNumber])
  @@index([equipmentTypes])
  @@index([externalId, sourceSystem])
  @@index([mcNumber])
  @@index([qualificationTier])
  @@index([scacCode])
  @@index([serviceStates])
  @@index([status])
  @@index([tenantId, deletedAt])
  @@index([tenantId])
  @@index([tenantId, status])
}

model CarrierCapacity {
  id             String         @id @default(uuid())
  tenantId       String
  carrierId      String
  equipmentType  String         @db.VarChar(50)
  availableUnits Int            @default(0)
  totalUnits     Int
  city           String?        @db.VarChar(100)
  state          String?        @db.VarChar(50)
  zipCode        String?        @db.VarChar(20)
  lat            Decimal?       @db.Decimal(10, 7)
  lng            Decimal?       @db.Decimal(10, 7)
  effectiveDate  DateTime       @db.Date
  expiresAt      DateTime?      @db.Date
  status         CapacityStatus @default(AVAILABLE)
  notes          String?
  externalId     String?        @db.VarChar(255)
  sourceSystem   String?        @db.VarChar(100)
  customFields   Json           @default("{}")
  createdAt      DateTime       @default(now())
  updatedAt      DateTime @updatedAt
  deletedAt      DateTime?
  createdById    String?
  updatedById    String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  tenant         Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([carrierId])
  @@index([effectiveDate])
  @@index([equipmentType])
  @@index([externalId, sourceSystem])
  @@index([state])
  @@index([status])
  @@index([tenantId])
}

model CarrierContact {
  id                   String    @id @default(uuid())
  carrierId            String
  firstName            String    @db.VarChar(100)
  lastName             String    @db.VarChar(100)
  title                String?   @db.VarChar(100)
  role                 String?   @db.VarChar(50)
  email                String?   @db.VarChar(255)
  phone                String?   @db.VarChar(50)
  mobile               String?   @db.VarChar(50)
  isPrimary            Boolean   @default(false)
  receivesRateConfirms Boolean   @default(false)
  receivesPodRequests  Boolean   @default(false)
  receivesPayments     Boolean   @default(false)
  preferredLanguage    String    @default("en") @db.VarChar(10)
  isActive             Boolean   @default(true)
  createdAt            DateTime  @default(now())
  updatedAt            DateTime @updatedAt
  createdById          String?
  customFields         Json      @default("{}")
  deletedAt            DateTime?
  externalId           String?   @db.VarChar(255)
  sourceSystem         String?   @db.VarChar(100)
  tenantId             String
  updatedById          String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  tenant               Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([carrierId])
  @@index([isActive])
  @@index([isPrimary])
  @@index([role])
}

model CarrierDocument {
  id              String    @id @default(uuid())
  tenantId        String
  carrierId       String
  documentType    String    @db.VarChar(50)
  name            String    @db.VarChar(255)
  description     String?
  filePath        String?   @db.VarChar(500)
  fileSize        Int?
  mimeType        String?   @db.VarChar(100)
  status          String    @default("PENDING") @db.VarChar(50)
  reviewedById    String?
  reviewedAt      DateTime?
  rejectionReason String?
  expirationDate  DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime @updatedAt
  createdById     String?
  customFields    Json      @default("{}")
  deletedAt       DateTime?
  externalId      String?   @db.VarChar(255)
  sourceSystem    String?   @db.VarChar(100)
  updatedById     String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  tenant          Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([carrierId])
  @@index([documentType])
  @@index([expirationDate])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId])
}

model CarrierFactoringStatus {
  id                 String            @id @default(uuid())
  tenantId           String
  carrierId          String            @unique
  factoringStatus    FactoringStatus   @default(NONE)
  factoringCompanyId String?
  activeNoaId        String?
  quickPayEnabled    Boolean           @default(false)
  quickPayFeePercent Decimal?          @db.Decimal(5, 2)
  notes              String?
  externalId         String?           @db.VarChar(255)
  sourceSystem       String?           @db.VarChar(100)
  customFields       Json              @default("{}")
  createdAt          DateTime          @default(now())
  updatedAt          DateTime @updatedAt
  deletedAt          DateTime?
  createdById        String?
  updatedById        String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  factoringCompany   FactoringCompany? @relation(fields: [factoringCompanyId], references: [id])
  tenant             Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([carrierId])
  @@index([externalId, sourceSystem])
  @@index([factoringCompanyId])
  @@index([factoringStatus])
  @@index([tenantId])
}

model CarrierInsurance {
  id             String        @id @default(uuid())
  tenantId       String
  carrierId      String
  insuranceType  InsuranceType
  policyNumber   String        @db.VarChar(100)
  carrierName    String        @db.VarChar(255)
  coverageAmount Decimal       @db.Decimal(15, 2)
  effectiveDate  DateTime      @db.Date
  expirationDate DateTime      @db.Date
  isExpired      Boolean       @default(false)
  agentName      String?       @db.VarChar(255)
  agentPhone     String?       @db.VarChar(20)
  agentEmail     String?       @db.VarChar(255)
  certificateUrl String?       @db.VarChar(500)
  isVerified     Boolean       @default(false)
  verifiedAt     DateTime?
  verifiedById   String?
  externalId     String?       @db.VarChar(255)
  sourceSystem   String?       @db.VarChar(100)
  customFields   Json          @default("{}")
  createdAt      DateTime      @default(now())
  updatedAt      DateTime @updatedAt
  deletedAt      DateTime?
  createdById    String?
  updatedById    String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  tenant         Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([carrierId])
  @@index([expirationDate])
  @@index([externalId, sourceSystem])
  @@index([insuranceType])
  @@index([isExpired])
  @@index([tenantId])
}

model CarrierInvoiceSubmission {
  id                String            @id @default(uuid())
  tenantId          String
  carrierId         String
  userId            String
  loadId            String
  invoiceNumber     String            @db.VarChar(50)
  amount            Decimal           @db.Decimal(12, 2)
  invoiceDate       DateTime          @db.Date
  status            String            @default("SUBMITTED") @db.VarChar(50)
  reviewedBy        String?
  reviewedAt        DateTime?
  reviewNotes       String?
  settlementId      String?
  externalId        String?           @db.VarChar(255)
  sourceSystem      String?           @db.VarChar(100)
  customFields      Json              @default("{}")
  createdAt         DateTime          @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  load              Load?              @relation(fields: [loadId], references: [id], onDelete: Cascade)
  Settlement        Settlement?       @relation(fields: [settlementId], references: [id])
  tenant            Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  carrierPortalUser CarrierPortalUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([carrierId])
  @@index([externalId, sourceSystem])
  @@index([invoiceNumber])
  @@index([loadId])
  @@index([status])
  @@index([tenantId])
  @@index([userId])
}

model CarrierLoadView {
  id           String      @id @default(uuid())
  postingId    String
  carrierId    String
  viewedAt     DateTime    @default(now())
  source       String?     @db.VarChar(50)
  createdAt    DateTime    @default(now())
  createdById  String?
  customFields Json        @default("{}")
  deletedAt    DateTime?
  externalId   String?     @db.VarChar(255)
  sourceSystem String?     @db.VarChar(100)
  tenantId     String
  updatedAt    DateTime @updatedAt
  updatedById  String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  posting  LoadPosting @relation(fields: [postingId], references: [id], onDelete: Cascade)
  tenant       Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([postingId, carrierId])
  @@index([carrierId])
  @@index([externalId, sourceSystem])
  @@index([postingId])
  @@index([tenantId])
}

model CarrierPerformanceHistory {
  id                  String    @id @default(uuid())
  tenantId            String
  carrierId           String
  periodType          String    @db.VarChar(20)
  periodStart         DateTime
  periodEnd           DateTime
  loadsCompleted      Int       @default(0)
  loadsCancelled      Int       @default(0)
  onTimePickups       Int       @default(0)
  onTimeDeliveries    Int       @default(0)
  latePickups         Int       @default(0)
  lateDeliveries      Int       @default(0)
  claimsCount         Int       @default(0)
  claimsAmount        Decimal   @default(0) @db.Decimal(12, 2)
  onTimePickupRate    Decimal?  @db.Decimal(5, 2)
  onTimeDeliveryRate  Decimal?  @db.Decimal(5, 2)
  claimsRate          Decimal?  @db.Decimal(5, 2)
  totalPaid           Decimal   @default(0) @db.Decimal(14, 2)
  avgRatePerMile      Decimal?  @db.Decimal(8, 2)
  avgDispatcherRating Decimal?  @db.Decimal(3, 2)
  avgCustomerRating   Decimal?  @db.Decimal(3, 2)
  createdAt           DateTime  @default(now())
  createdById         String?
  customFields        Json      @default("{}")
  deletedAt           DateTime?
  externalId          String?   @db.VarChar(255)
  sourceSystem        String?   @db.VarChar(100)
  updatedAt           DateTime @updatedAt
  updatedById         String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([carrierId, periodType, periodStart])
  @@index([carrierId])
  @@index([periodStart])
  @@index([periodType])
  @@index([tenantId])
}

model CarrierPortalActivityLog {
  id                String            @id @default(uuid())
  tenantId          String
  userId            String
  action            String            @db.VarChar(100)
  entityType        String?           @db.VarChar(50)
  entityId          String?
  description       String?
  ipAddress         String?           @db.VarChar(45)
  userAgent         String?
  externalId        String?           @db.VarChar(255)
  sourceSystem      String?           @db.VarChar(100)
  customFields      Json              @default("{}")
  createdAt         DateTime          @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  carrierId         String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id])
  tenant            Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  carrierPortalUser CarrierPortalUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([action])
  @@index([createdAt])
  @@index([entityType, entityId])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
  @@index([userId])
}

model CarrierPortalDocument {
  id                String                @id @default(uuid())
  tenantId          String
  carrierId         String
  userId            String
  loadId            String?
  documentType      CarrierDocumentType   @default(POD)
  fileName          String                @db.VarChar(255)
  filePath          String                @db.VarChar(500)
  fileSize          Int
  mimeType          String                @db.VarChar(100)
  status            CarrierDocumentStatus @default(UPLOADED)
  reviewedBy        String?
  reviewedAt        DateTime?
  reviewNotes       String?
  rejectionNotes    String?
  externalId        String?               @db.VarChar(255)
  sourceSystem      String?               @db.VarChar(100)
  customFields      Json                  @default("{}")
  createdAt         DateTime              @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  load              Load?              @relation(fields: [loadId], references: [id])
  tenant            Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  carrierPortalUser CarrierPortalUser     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([carrierId])
  @@index([documentType])
  @@index([externalId, sourceSystem])
  @@index([loadId])
  @@index([status])
  @@index([tenantId])
  @@index([userId])
}

model CarrierPortalNotification {
  id                  String                        @id @default(uuid())
  tenantId            String
  carrierPortalUserId String
  notificationType    CarrierPortalNotificationType
  title               String                        @db.VarChar(255)
  message             String
  isRead              Boolean                       @default(false)
  readAt              DateTime?
  actionUrl           String?                       @db.VarChar(500)
  relatedEntityType   String?                       @db.VarChar(50)
  relatedEntityId     String?                       @db.VarChar(255)
  externalId          String?                       @db.VarChar(255)
  sourceSystem        String?                       @db.VarChar(100)
  customFields        Json                          @default("{}")
  createdAt           DateTime                      @default(now())
  updatedAt           DateTime @updatedAt
  deletedAt           DateTime?
  createdById         String?
  updatedById         String?
  carrierPortalUser   CarrierPortalUser             @relation(fields: [carrierPortalUserId], references: [id], onDelete: Cascade)
  tenant              Tenant                        @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([carrierPortalUserId])
  @@index([createdAt])
  @@index([externalId, sourceSystem])
  @@index([isRead])
  @@index([notificationType])
  @@index([relatedEntityType, relatedEntityId])
  @@index([tenantId])
}

model CarrierPortalSession {
  id                String            @id @default(uuid())
  tenantId          String
  userId            String
  refreshTokenHash  String            @db.VarChar(255)
  userAgent         String?
  ipAddress         String?           @db.VarChar(45)
  expiresAt         DateTime
  revokedAt         DateTime?
  externalId        String?           @db.VarChar(255)
  sourceSystem      String?           @db.VarChar(100)
  customFields      Json              @default("{}")
  createdAt         DateTime          @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  carrierId         String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id])
  tenant            Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  carrierPortalUser CarrierPortalUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([externalId, sourceSystem])
  @@index([refreshTokenHash])
  @@index([tenantId])
  @@index([userId])
}

model CarrierPortalUser {
  id                        String                      @id @default(uuid())
  tenantId                  String
  carrierId                 String
  email                     String                      @db.VarChar(255)
  password                  String                      @db.VarChar(255)
  firstName                 String                      @db.VarChar(100)
  lastName                  String                      @db.VarChar(100)
  phone                     String?                     @db.VarChar(20)
  role                      CarrierPortalUserRole       @default(DISPATCHER)
  status                    PortalUserStatus            @default(PENDING)
  emailVerified             Boolean                     @default(false)
  emailVerifiedAt           DateTime?
  verificationToken         String?                     @unique @db.VarChar(255)
  lastLoginAt               DateTime?
  language                  String                      @default("en") @db.VarChar(10)
  externalId                String?                     @db.VarChar(255)
  sourceSystem              String?                     @db.VarChar(100)
  customFields              Json                        @default("{}")
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime @updatedAt
  deletedAt                 DateTime?
  createdById               String?
  updatedById               String?
  CarrierInvoiceSubmission  CarrierInvoiceSubmission[]
  CarrierPortalActivityLog  CarrierPortalActivityLog[]
  CarrierPortalDocument     CarrierPortalDocument[]
  CarrierPortalNotification CarrierPortalNotification[]
  CarrierPortalSession      CarrierPortalSession[]
  carrier             Carrier?           @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  tenant                    Tenant                      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  CarrierQuickPayRequest    CarrierQuickPayRequest[]
  CarrierSavedLoad          CarrierSavedLoad[]

  @@unique([tenantId, email])
  @@index([carrierId])
  @@index([email])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId])
}

model CarrierQuickPayRequest {
  id                String            @id @default(uuid())
  tenantId          String
  carrierId         String
  userId            String
  loadId            String
  requestedAmount   Decimal           @db.Decimal(12, 2)
  feePercent        Decimal           @db.Decimal(5, 2)
  feeAmount         Decimal           @db.Decimal(12, 2)
  netAmount         Decimal           @db.Decimal(12, 2)
  status            QuickPayStatus    @default(REQUESTED)
  approvedBy        String?
  approvedAt        DateTime?
  rejectedAt        DateTime?
  rejectionReason   String?
  processedAt       DateTime?
  externalId        String?           @db.VarChar(255)
  sourceSystem      String?           @db.VarChar(100)
  customFields      Json              @default("{}")
  createdAt         DateTime          @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  load              Load?              @relation(fields: [loadId], references: [id], onDelete: Cascade)
  tenant            Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  carrierPortalUser CarrierPortalUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([carrierId])
  @@index([externalId, sourceSystem])
  @@index([loadId])
  @@index([status])
  @@index([tenantId])
  @@index([userId])
}

model CarrierSavedLoad {
  id                  String            @id @default(uuid())
  tenantId            String
  carrierPortalUserId String
  loadId              String?
  postingId           String?
  notes               String?
  reminderDate        DateTime?         @db.Date
  savedFrom           String?           @db.VarChar(100)
  externalId          String?           @db.VarChar(255)
  sourceSystem        String?           @db.VarChar(100)
  customFields        Json              @default("{}")
  createdAt           DateTime          @default(now())
  updatedAt           DateTime @updatedAt
  deletedAt           DateTime?
  createdById         String?
  updatedById         String?
  carrierPortalUser   CarrierPortalUser @relation(fields: [carrierPortalUserId], references: [id], onDelete: Cascade)
  load                Load?              @relation(fields: [loadId], references: [id])
  tenant              Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([carrierPortalUserId])
  @@index([externalId, sourceSystem])
  @@index([loadId])
  @@index([reminderDate])
  @@index([tenantId])
}

model CarrierWatchlist {
  id                  String    @id @default(uuid())
  tenantId            String
  carrierId           String
  reason              String
  riskLevel           String    @db.VarChar(50)
  isRestricted        Boolean   @default(false)
  restrictions        String?
  nextReviewDate      DateTime? @db.Date
  reviewFrequencyDays Int?
  isActive            Boolean   @default(true)
  resolvedAt          DateTime?
  resolvedById        String?
  resolutionNotes     String?
  externalId          String?   @db.VarChar(255)
  sourceSystem        String?   @db.VarChar(100)
  customFields        Json      @default("{}")
  createdAt           DateTime  @default(now())
  updatedAt           DateTime @updatedAt
  deletedAt           DateTime?
  createdById         String?
  updatedById         String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([carrierId])
  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([nextReviewDate])
  @@index([riskLevel])
  @@index([tenantId])
}

model ChangeHistory {
  id           String    @id @default(uuid())
  tenantId     String
  userId       String?
  entityType   String    @db.VarChar(50)
  entityId     String
  field        String    @db.VarChar(100)
  oldValue     String?
  newValue     String?
  externalId   String?   @db.VarChar(255)
  sourceSystem String?   @db.VarChar(100)
  customFields Json      @default("{}")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([entityType, entityId])
  @@index([externalId, sourceSystem])
  @@index([field])
  @@index([tenantId])
  @@index([userId])
}

model ChartOfAccount {
  id                                                     String               @id @default(uuid())
  tenantId                                               String
  accountNumber                                          String               @db.VarChar(20)
  accountName                                            String               @db.VarChar(255)
  accountType                                            String               @db.VarChar(50)
  accountSubType                                         String?              @db.VarChar(50)
  parentAccountId                                        String?
  description                                            String?
  normalBalance                                          String               @db.VarChar(10)
  isActive                                               Boolean              @default(true)
  isSystemAccount                                        Boolean              @default(false)
  balance                                                Decimal              @default(0) @db.Decimal(14, 2)
  quickbooksId                                           String?              @db.VarChar(50)
  externalId                                             String?              @db.VarChar(255)
  sourceSystem                                           String?              @db.VarChar(100)
  createdAt                                              DateTime             @default(now())
  updatedAt                                              DateTime @updatedAt
  parentAccount                                         ChartOfAccount?     @relation("ChartOfAccountToChartOfAccount", fields: [parentAccountId], references: [id])
  childAccounts                                   ChartOfAccount[]     @relation("ChartOfAccountToChartOfAccount")
  tenant                                                 Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  Invoice_Invoice_arAccountIdToChartOfAccount            Invoice[]            @relation("Invoice_arAccountIdToChartOfAccount")
  Invoice_Invoice_revenueAccountIdToChartOfAccount       Invoice[]            @relation("Invoice_revenueAccountIdToChartOfAccount")
  lineItems                                        InvoiceLineItem[]
  lines                                       JournalEntryLine[]
  PaymentMade                                            PaymentMade[]
  PaymentReceived                                        PaymentReceived[]
  Settlement_Settlement_apAccountIdToChartOfAccount      Settlement[]         @relation("Settlement_apAccountIdToChartOfAccount")
  Settlement_Settlement_expenseAccountIdToChartOfAccount Settlement[]         @relation("Settlement_expenseAccountIdToChartOfAccount")
  settlementLineItems                                     SettlementLineItem[]

  @@unique([tenantId, accountNumber])
  @@index([accountType])
  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([parentAccountId])
  @@index([tenantId])
}

model CheckCall {
  id             String    @id @default(uuid())
  tenantId       String
  loadId         String
  city           String?   @db.VarChar(100)
  state          String?   @db.VarChar(50)
  latitude       Decimal?  @db.Decimal(10, 7)
  longitude      Decimal?  @db.Decimal(10, 7)
  status         String?   @db.VarChar(30)
  notes          String?
  contacted      String?   @db.VarChar(50)
  contactMethod  String?   @db.VarChar(20)
  eta            DateTime?
  milesRemaining Int?
  source         String?   @db.VarChar(30)
  createdAt      DateTime  @default(now())
  createdById    String?
  customFields   Json      @default("{}")
  deletedAt      DateTime?
  externalId     String?   @db.VarChar(255)
  sourceSystem   String?   @db.VarChar(100)
  updatedAt      DateTime @updatedAt
  updatedById    String?
  load           Load?              @relation(fields: [loadId], references: [id], onDelete: Cascade)
  tenant         Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([externalId, sourceSystem])
  @@index([loadId])
  @@index([tenantId])
}

model CircuitBreakerStateRecord {
  id               String       @id @default(uuid())
  tenantId         String
  integrationId    String       @unique
  state            CircuitState @default(CLOSED)
  failureCount     Int          @default(0)
  lastFailureAt    DateTime?
  nextRetryAt      DateTime?
  halfOpenAttempts Int          @default(0)
  externalId       String?      @db.VarChar(255)
  sourceSystem     String?      @db.VarChar(100)
  customFields     Json         @default("{}")
  createdAt        DateTime     @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  createdById      String?
  updatedById      String?
  integration      Integration  @relation(fields: [integrationId], references: [id], onDelete: Cascade)
  tenant           Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([nextRetryAt])
  @@index([tenantId])
}

model Claim {
  id                 String              @id @default(uuid())
  tenantId           String
  loadId             String?
  orderId            String?
  carrierId          String?
  companyId          String?
  claimNumber        String              @unique @db.VarChar(50)
  claimType          ClaimType
  status             ClaimStatus         @default(DRAFT)
  disposition        ClaimDisposition?
  claimedAmount      Decimal             @db.Decimal(12, 2)
  approvedAmount     Decimal?            @db.Decimal(12, 2)
  paidAmount         Decimal             @default(0) @db.Decimal(12, 2)
  incidentDate       DateTime            @db.Date
  incidentLocation   String?             @db.VarChar(500)
  description        String
  claimantName       String              @db.VarChar(255)
  claimantCompany    String?             @db.VarChar(255)
  claimantEmail      String?             @db.VarChar(255)
  claimantPhone      String?             @db.VarChar(20)
  filedDate          DateTime            @default(now()) @db.Date
  receivedDate       DateTime?           @db.Date
  dueDate            DateTime?           @db.Date
  closedDate         DateTime?           @db.Date
  assignedToId       String?
  investigationNotes String?
  rootCause          String?
  preventionNotes    String?
  externalId         String?             @db.VarChar(255)
  sourceSystem       String?             @db.VarChar(100)
  customFields       Json                @default("{}")
  createdAt          DateTime            @default(now())
  updatedAt          DateTime @updatedAt
  deletedAt          DateTime?
  createdById        String?
  updatedById        String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id])
  company             Company?           @relation(fields: [companyId], references: [id])
  load               Load?              @relation(fields: [loadId], references: [id])
  order               Order?             @relation(fields: [orderId], references: [id])
  tenant             Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  ClaimAdjustment    ClaimAdjustment[]
  ClaimContact       ClaimContact[]
  documents ClaimDocument[]
  items ClaimItem[]
  notes ClaimNote[]
  timeline ClaimTimeline[]
  SubrogationRecord  SubrogationRecord[]

  @@index([carrierId])
  @@index([claimNumber])
  @@index([claimType])
  @@index([companyId])
  @@index([externalId, sourceSystem])
  @@index([incidentDate])
  @@index([loadId])
  @@index([orderId])
  @@index([status])
  @@index([tenantId])
}

model ClaimAdjustment {
  id             String    @id @default(uuid())
  tenantId       String
  claimId        String
  adjustmentType String    @db.VarChar(100)
  amount         Decimal   @db.Decimal(12, 2)
  reason         String
  approvedById   String?
  approvedAt     DateTime?
  externalId     String?   @db.VarChar(255)
  sourceSystem   String?   @db.VarChar(100)
  customFields   Json      @default("{}")
  createdAt      DateTime  @default(now())
  updatedAt      DateTime @updatedAt
  deletedAt      DateTime?
  createdById    String?
  updatedById    String?
  claim          Claim     @relation(fields: [claimId], references: [id], onDelete: Cascade)
  tenant         Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([adjustmentType])
  @@index([claimId])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
}

model ClaimContact {
  id           String    @id @default(uuid())
  tenantId     String
  claimId      String
  contactType  String    @db.VarChar(100)
  name         String    @db.VarChar(255)
  company      String?   @db.VarChar(255)
  title        String?   @db.VarChar(100)
  email        String?   @db.VarChar(255)
  phone        String?   @db.VarChar(20)
  address      String?
  notes        String?
  externalId   String?   @db.VarChar(255)
  sourceSystem String?   @db.VarChar(100)
  customFields Json      @default("{}")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  claim        Claim     @relation(fields: [claimId], references: [id], onDelete: Cascade)
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([claimId])
  @@index([contactType])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
}

model ClaimDocument {
  id           String    @id @default(uuid())
  tenantId     String
  claimId      String
  documentId   String
  documentType String    @db.VarChar(100)
  description  String?   @db.VarChar(500)
  externalId   String?   @db.VarChar(255)
  sourceSystem String?   @db.VarChar(100)
  customFields Json      @default("{}")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  claim        Claim     @relation(fields: [claimId], references: [id], onDelete: Cascade)
  document     Document  @relation(fields: [documentId], references: [id], onDelete: Cascade)
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([claimId])
  @@index([documentId])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
}

model ClaimItem {
  id           String    @id @default(uuid())
  tenantId     String
  claimId      String
  description  String    @db.VarChar(500)
  quantity     Int
  unitPrice    Decimal   @db.Decimal(10, 2)
  totalValue   Decimal   @db.Decimal(12, 2)
  damageType   String?   @db.VarChar(100)
  damageExtent String?   @db.VarChar(100)
  externalId   String?   @db.VarChar(255)
  sourceSystem String?   @db.VarChar(100)
  customFields Json      @default("{}")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  claim        Claim     @relation(fields: [claimId], references: [id], onDelete: Cascade)
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([claimId])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
}

model ClaimNote {
  id           String    @id @default(uuid())
  tenantId     String
  claimId      String
  note         String
  noteType     String?   @db.VarChar(50)
  isInternal   Boolean   @default(false)
  externalId   String?   @db.VarChar(255)
  sourceSystem String?   @db.VarChar(100)
  customFields Json      @default("{}")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  claim        Claim     @relation(fields: [claimId], references: [id], onDelete: Cascade)
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([claimId])
  @@index([createdAt])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
}

model ClaimTimeline {
  id           String    @id @default(uuid())
  tenantId     String
  claimId      String
  eventType    String    @db.VarChar(100)
  eventData    Json?
  description  String?   @db.VarChar(500)
  oldValue     String?   @db.VarChar(500)
  newValue     String?   @db.VarChar(500)
  externalId   String?   @db.VarChar(255)
  sourceSystem String?   @db.VarChar(100)
  customFields Json      @default("{}")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  claim        Claim     @relation(fields: [claimId], references: [id], onDelete: Cascade)
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([claimId])
  @@index([createdAt])
  @@index([eventType])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
}

model CollectionActivity {
  id                  String                 @id @default(uuid())
  tenantId            String
  companyId           String
  customerId          String?
  invoiceId           String?
  activityType        CollectionActivityType
  subject             String?                @db.VarChar(500)
  description         String?
  outcome             String?
  contactedName       String?                @db.VarChar(255)
  contactedTitle      String?                @db.VarChar(100)
  contactedPhone      String?                @db.VarChar(20)
  contactedEmail      String?                @db.VarChar(255)
  followUpDate        DateTime?
  followUpNotes       String?
  promisedPaymentDate DateTime?
  promisedAmount      Decimal?               @db.Decimal(12, 2)
  externalId          String?                @db.VarChar(255)
  sourceSystem        String?                @db.VarChar(100)
  customFields        Json                   @default("{}")
  createdAt           DateTime               @default(now())
  updatedAt           DateTime @updatedAt
  deletedAt           DateTime?
  createdById         String?
  updatedById         String?
  company             Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  Invoice             Invoice?               @relation(fields: [invoiceId], references: [id])
  tenant              Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([activityType])
  @@index([companyId])
  @@index([createdAt])
  @@index([externalId, sourceSystem])
  @@index([followUpDate])
  @@index([invoiceId])
  @@index([tenantId])
}

model CommissionEntry {
  id                    String            @id @default(uuid())
  tenantId              String
  userId                String
  loadId                String?
  orderId               String?
  entryType             String            @db.VarChar(50)
  planId                String?
  calculationBasis      String?           @db.VarChar(50)
  basisAmount           Decimal?          @db.Decimal(12, 2)
  rateApplied           Decimal?          @db.Decimal(5, 2)
  commissionAmount      Decimal           @db.Decimal(12, 2)
  isSplit               Boolean           @default(false)
  splitPercent          Decimal           @default(100) @db.Decimal(5, 2)
  parentEntryId         String?
  status                String            @default("PENDING") @db.VarChar(50)
  commissionPeriod      DateTime          @db.Date
  notes                 String?
  reversedAt            DateTime?
  reversedBy            String?
  reversalReason        String?
  payoutId              String?
  paidAt                DateTime?
  createdAt             DateTime          @default(now())
  updatedAt             DateTime @updatedAt
  createdById           String?
  customFields          Json              @default("{}")
  deletedAt             DateTime?
  externalId            String?           @db.VarChar(255)
  sourceSystem          String?           @db.VarChar(100)
  updatedById           String?
  load                  Load?              @relation(fields: [loadId], references: [id])
  order               Order?             @relation(fields: [orderId], references: [id])
  parentEntry       CommissionEntry?  @relation("CommissionEntryToCommissionEntry", fields: [parentEntryId], references: [id])
  splitEntries CommissionEntry[] @relation("CommissionEntryToCommissionEntry")
  payout      CommissionPayout? @relation(fields: [payoutId], references: [id])
  plan        CommissionPlan?   @relation(fields: [planId], references: [id])
  tenant                Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User?              @relation(fields: [userId], references: [id])

  @@index([externalId, sourceSystem])
  @@index([loadId])
  @@index([tenantId, commissionPeriod])
  @@index([tenantId, deletedAt])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([userId])
}

model CommissionPayout {
  id                                     String            @id @default(uuid())
  tenantId                               String
  payoutNumber                           String            @db.VarChar(50)
  payoutDate                             DateTime          @db.Date
  periodStart                            DateTime          @db.Date
  periodEnd                              DateTime          @db.Date
  userId                                 String
  grossCommission                        Decimal           @db.Decimal(12, 2)
  drawRecovery                           Decimal           @default(0) @db.Decimal(12, 2)
  adjustments                            Decimal           @default(0) @db.Decimal(12, 2)
  netPayout                              Decimal           @db.Decimal(12, 2)
  status                                 String            @default("PENDING") @db.VarChar(50)
  approvedBy                             String?
  approvedAt                             DateTime?
  paymentMethod                          String?           @db.VarChar(50)
  paymentReference                       String?           @db.VarChar(100)
  paidAt                                 DateTime?
  notes                                  String?
  createdAt                              DateTime          @default(now())
  updatedAt                              DateTime @updatedAt
  createdById                            String?
  customFields                           Json              @default("{}")
  deletedAt                              DateTime?
  externalId                             String?           @db.VarChar(255)
  sourceSystem                           String?           @db.VarChar(100)
  updatedById                            String?
  entries                        CommissionEntry[]
  approvedByUser User?             @relation("CommissionPayout_approvedByToUser", fields: [approvedBy], references: [id])
  tenant                                 Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user     User              @relation("CommissionPayout_userIdToUser", fields: [userId], references: [id])

  @@unique([tenantId, payoutNumber])
  @@index([externalId, sourceSystem])
  @@index([tenantId, deletedAt])
  @@index([tenantId])
  @@index([tenantId, paidAt])
  @@index([tenantId, periodStart])
  @@index([tenantId, status])
  @@index([userId])
}

model CommissionPlan {
  id                       String                     @id @default(uuid())
  tenantId                 String
  name                     String                     @db.VarChar(255)
  description              String?
  planType                 String                     @db.VarChar(50)
  status                   String                     @default("ACTIVE") @db.VarChar(50)
  isDefault                Boolean                    @default(false)
  effectiveDate            DateTime                   @db.Date
  endDate                  DateTime?                  @db.Date
  flatAmount               Decimal?                   @db.Decimal(10, 2)
  percentRate              Decimal?                   @db.Decimal(5, 2)
  calculationBasis         String?                    @db.VarChar(50)
  minimumMarginPercent     Decimal?                   @db.Decimal(5, 2)
  rules                    Json                       @default("{}")
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime @updatedAt
  createdById              String?
  customFields             Json                       @default("{}")
  deletedAt                DateTime?
  externalId               String?                    @db.VarChar(255)
  sourceSystem             String?                    @db.VarChar(100)
  updatedById              String?
  entries          CommissionEntry[]
  tenant                   Tenant                     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tiers       CommissionPlanTier[]
  assignments UserCommissionAssignment[]

  @@unique([tenantId, name, effectiveDate])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
  @@index([tenantId, status])
}

model CommissionPlanTier {
  id             String         @id @default(uuid())
  planId         String
  tierNumber     Int
  tierName       String?        @db.VarChar(100)
  thresholdType  String         @db.VarChar(50)
  thresholdMin   Decimal        @db.Decimal(14, 2)
  thresholdMax   Decimal?       @db.Decimal(14, 2)
  rateType       String         @db.VarChar(50)
  rateAmount     Decimal        @db.Decimal(10, 2)
  periodType     String?        @db.VarChar(50)
  createdAt      DateTime       @default(now())
  createdById    String?
  customFields   Json           @default("{}")
  deletedAt      DateTime?
  externalId     String?        @db.VarChar(255)
  sourceSystem   String?        @db.VarChar(100)
  updatedAt      DateTime @updatedAt
  updatedById    String?
  commissionPlan CommissionPlan @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@unique([planId, tierNumber])
  @@index([externalId, sourceSystem])
  @@index([planId])
}

model CommunicationLog {
  id                    String                 @id @default(uuid())
  tenantId              String
  channel               String                 @db.VarChar(50)
  templateId            String?
  templateCode          String?                @db.VarChar(100)
  recipientType         String?                @db.VarChar(50)
  recipientId           String?
  recipientEmail        String?                @db.VarChar(255)
  recipientPhone        String?                @db.VarChar(50)
  recipientName         String?                @db.VarChar(255)
  subject               String?                @db.VarChar(500)
  body                  String
  bodyHtml              String?
  language              String                 @default("en") @db.VarChar(10)
  attachments           Json?
  entityType            String?                @db.VarChar(50)
  entityId              String?
  status                String                 @default("PENDING") @db.VarChar(50)
  sentAt                DateTime?
  deliveredAt           DateTime?
  openedAt              DateTime?
  clickedAt             DateTime?
  failedAt              DateTime?
  provider              String?                @db.VarChar(50)
  providerMessageId     String?                @db.VarChar(255)
  errorMessage          String?
  retryCount            Int                    @default(0)
  lastRetryAt           DateTime?
  metadata              Json                   @default("{}")
  createdAt             DateTime               @default(now())
  createdById           String?
  customFields          Json                   @default("{}")
  deletedAt             DateTime?
  externalId            String?                @db.VarChar(255)
  sourceSystem          String?                @db.VarChar(100)
  updatedAt             DateTime @updatedAt
  updatedById           String?
  template CommunicationTemplate? @relation(fields: [templateId], references: [id])
  tenant                Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([channel])
  @@index([createdAt])
  @@index([entityType, entityId])
  @@index([externalId, sourceSystem])
  @@index([recipientType, recipientId])
  @@index([status])
  @@index([templateCode])
  @@index([tenantId])
}

model CommunicationTemplate {
  id               String             @id @default(uuid())
  tenantId         String
  name             String             @db.VarChar(255)
  code             String             @db.VarChar(100)
  description      String?
  category         String?            @db.VarChar(50)
  channel          String             @db.VarChar(50)
  subjectEn        String?            @db.VarChar(500)
  subjectEs        String?            @db.VarChar(500)
  bodyEn           String
  bodyEs           String?
  fromName         String?            @db.VarChar(255)
  fromEmail        String?            @db.VarChar(255)
  replyTo          String?            @db.VarChar(255)
  status           String             @default("ACTIVE") @db.VarChar(50)
  isSystem         Boolean            @default(false)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime @updatedAt
  createdById      String?
  customFields     Json               @default("{}")
  deletedAt        DateTime?
  externalId       String?            @db.VarChar(255)
  sourceSystem     String?            @db.VarChar(100)
  updatedById      String?
  CommunicationLog CommunicationLog[]
  tenant           Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, code, channel])
  @@index([category])
  @@index([channel])
  @@index([code])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
}

model Company {
  id                          String                       @id @default(uuid())
  tenantId                    String
  name                        String                       @db.VarChar(255)
  legalName                   String?                      @db.VarChar(255)
  dbaName                     String?                      @db.VarChar(255)
  companyType                 String                       @db.VarChar(50)
  status                      String                       @default("ACTIVE") @db.VarChar(50)
  industry                    String?                      @db.VarChar(100)
  segment                     String?                      @db.VarChar(50)
  tier                        String?                      @db.VarChar(20)
  website                     String?                      @db.VarChar(255)
  phone                       String?                      @db.VarChar(50)
  email                       String?                      @db.VarChar(255)
  addressLine1                String?                      @db.VarChar(255)
  addressLine2                String?                      @db.VarChar(255)
  city                        String?                      @db.VarChar(100)
  state                       String?                      @db.VarChar(50)
  postalCode                  String?                      @db.VarChar(20)
  country                     String                       @default("USA") @db.VarChar(3)
  creditLimit                 Decimal?                     @db.Decimal(12, 2)
  paymentTerms                String?                      @db.VarChar(50)
  taxId                       String?                      @db.VarChar(50)
  dunsNumber                  String?                      @db.VarChar(20)
  defaultPickupInstructions   String?
  defaultDeliveryInstructions String?
  requiresAppointment         Boolean                      @default(false)
  requiresLumper              Boolean                      @default(false)
  parentCompanyId             String?
  assignedUserId              String?
  hubspotId                   String?                      @db.VarChar(50)
  externalId                  String?                      @db.VarChar(255)
  sourceSystem                String?                      @db.VarChar(100)
  customFields                Json                         @default("{}")
  tags                        String[]                     @db.VarChar(100)
  createdAt                   DateTime                     @default(now())
  updatedAt                   DateTime @updatedAt
  deletedAt                   DateTime?
  createdById                 String?
  updatedById                 String?
  logoUrl                     String?                      @db.VarChar(500)
  activities                    Activity[]
  commissions             AgentCommission[]
  AgentCustomerAssignment     AgentCustomerAssignment[]
  AgentLead                   AgentLead[]
  Claim                       Claim[]
  CollectionActivity          CollectionActivity[]
  user                User?              @relation(fields: [assignedUserId], references: [id])
  company             Company?           @relation("CompanyToCompany", fields: [parentCompanyId], references: [id])
  other_Company               Company[]                    @relation("CompanyToCompany")
  tenant                      Tenant                       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  contacts Contact[]
  Contract                    Contract[]
  CreditApplication           CreditApplication[]
  CreditHold                  CreditHold[]
  CreditLimit                 CreditLimit[]
  CustomerCommissionOverride  CustomerCommissionOverride[]
  documents Document[]
  Invoice                     Invoice[]
  opportunities                 Opportunity[]
  orders               Order[]
  PaymentPlan                 PaymentPlan[]
  PaymentReceived             PaymentReceived[]
  PortalActivityLog           PortalActivityLog[]
  PortalBranding              PortalBranding?
  PortalPayment               PortalPayment[]
  PortalUser                  PortalUser[]
  Quote                       Quote[]
  QuoteRequest                QuoteRequest[]
  RateContract                RateContract[]

  @@unique([tenantId, name])
  @@index([assignedUserId])
  @@index([companyType])
  @@index([createdAt])
  @@index([externalId, sourceSystem])
  @@index([hubspotId])
  @@index([status])
  @@index([tenantId, companyType])
  @@index([tenantId, deletedAt])
  @@index([tenantId])
  @@index([tenantId, status])
}

model ComplianceCheckpoint {
  id             String           @id @default(uuid())
  tenantId       String
  checkpointName String           @db.VarChar(255)
  entityType     String           @db.VarChar(50)
  entityId       String           @db.VarChar(255)
  requirement    String
  status         ComplianceStatus @default(PENDING_VERIFICATION)
  verifiedBy     String?
  verifiedAt     DateTime?
  expiryDate     DateTime?        @db.Date
  externalId     String?          @db.VarChar(255)
  sourceSystem   String?          @db.VarChar(100)
  customFields   Json             @default("{}")
  createdAt      DateTime         @default(now())
  updatedAt      DateTime @updatedAt
  deletedAt      DateTime?
  createdById    String?
  updatedById    String?
  tenant         Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([entityType, entityId])
  @@index([expiryDate])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId])
}

model ConfigHistory {
  id           String   @id @default(uuid())
  tenantId     String
  configKey    String   @db.VarChar(255)
  oldValue     Json?
  newValue     Json
  changedBy    String?
  changeReason String?
  changedAt    DateTime @default(now())
  externalId   String?  @db.VarChar(255)
  sourceSystem String?  @db.VarChar(100)
  customFields Json     @default("{}")
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([changedAt])
  @@index([changedBy])
  @@index([configKey])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
}

model ConfigTemplate {
  id            String    @id @default(uuid())
  tenantId      String
  templateName  String    @db.VarChar(255)
  templateType  String    @db.VarChar(100)
  configSchema  Json      @default("{}")
  defaultValues Json      @default("{}")
  isSystem      Boolean   @default(false)
  externalId    String?   @db.VarChar(255)
  sourceSystem  String?   @db.VarChar(100)
  customFields  Json      @default("{}")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime @updatedAt
  deletedAt     DateTime?
  createdById   String?
  updatedById   String?
  tenant        Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([isSystem])
  @@index([templateType])
  @@index([tenantId])
}

model Contact {
  id                     String        @id @default(uuid())
  tenantId               String
  companyId              String?
  firstName              String        @db.VarChar(100)
  lastName               String        @db.VarChar(100)
  title                  String?       @db.VarChar(100)
  department             String?       @db.VarChar(100)
  roleType               String?       @db.VarChar(50)
  email                  String?       @db.VarChar(255)
  phone                  String?       @db.VarChar(50)
  mobile                 String?       @db.VarChar(50)
  fax                    String?       @db.VarChar(50)
  preferredContactMethod String?       @db.VarChar(20)
  language               String        @default("en") @db.VarChar(10)
  timezone               String?       @db.VarChar(50)
  status                 String        @default("ACTIVE") @db.VarChar(50)
  isPrimary              Boolean       @default(false)
  receivesInvoices       Boolean       @default(false)
  receivesTracking       Boolean       @default(false)
  hubspotId              String?       @db.VarChar(50)
  externalId             String?       @db.VarChar(255)
  sourceSystem           String?       @db.VarChar(100)
  customFields           Json          @default("{}")
  tags                   String[]      @db.VarChar(100)
  createdAt              DateTime      @default(now())
  updatedAt              DateTime @updatedAt
  deletedAt              DateTime?
  createdById            String?
  updatedById            String?
  activities               Activity[]
  company             Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tenant                 Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  opportunities            Opportunity[]
  orders               Order[]
  Quote                  Quote[]

  @@index([companyId])
  @@index([companyId, isPrimary])
  @@index([email])
  @@index([externalId, sourceSystem])
  @@index([hubspotId])
  @@index([isPrimary])
  @@index([tenantId, deletedAt])
  @@index([tenantId, email])
  @@index([tenantId])
}

model Contract {
  id                 String               @id @default(uuid())
  tenantId           String
  contractNumber     String               @unique @db.VarChar(50)
  contractType       ContractType
  customerId         String?
  carrierId          String?
  agentId            String?
  name               String               @db.VarChar(255)
  description        String?
  effectiveDate      DateTime             @db.Date
  expirationDate     DateTime?            @db.Date
  status             ContractStatus       @default(DRAFT)
  autoRenew          Boolean              @default(false)
  renewalTermDays    Int?
  noticeDays         Int?
  documentId         String?              @unique
  signedDocumentId   String?
  esignProvider      String?              @db.VarChar(50)
  esignEnvelopeId    String?              @db.VarChar(255)
  signedAt           DateTime?
  signedBy           String?
  minimumRevenue     Decimal?             @db.Decimal(12, 2)
  maximumRevenue     Decimal?             @db.Decimal(12, 2)
  externalId         String?              @db.VarChar(255)
  sourceSystem       String?              @db.VarChar(100)
  customFields       Json                 @default("{}")
  createdAt          DateTime             @default(now())
  updatedAt          DateTime @updatedAt
  deletedAt          DateTime?
  createdById        String?
  updatedById        String?
  Agent              Agent?               @relation(fields: [agentId], references: [id])
  carrier             Carrier?           @relation(fields: [carrierId], references: [id])
  company             Company?           @relation(fields: [customerId], references: [id])
  tenant             Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  ContractAmendment  ContractAmendment[]
  ContractMetric     ContractMetric[]
  ContractRateTable  ContractRateTable[]
  ContractSLA        ContractSLA[]
  FuelSurchargeTable FuelSurchargeTable[]
  VolumeCommitment   VolumeCommitment[]

  @@index([carrierId])
  @@index([contractNumber])
  @@index([contractType])
  @@index([customerId])
  @@index([effectiveDate])
  @@index([expirationDate])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId])
}

model ContractAmendment {
  id              String    @id @default(uuid())
  tenantId        String
  contractId      String
  amendmentNumber Int       @default(1)
  effectiveDate   DateTime  @db.Date
  description     String
  changedFields   Json      @default("[]")
  previousValues  Json      @default("{}")
  newValues       Json      @default("{}")
  changedBy       String?
  approvedBy      String?
  approvedAt      DateTime?
  documentId      String?
  externalId      String?   @db.VarChar(255)
  sourceSystem    String?   @db.VarChar(100)
  customFields    Json      @default("{}")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime @updatedAt
  deletedAt       DateTime?
  createdById     String?
  updatedById     String?
  contract        Contract?            @relation(fields: [contractId], references: [id], onDelete: Cascade)
  document        Document? @relation(fields: [documentId], references: [id])
  tenant          Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([amendmentNumber])
  @@index([contractId])
  @@index([effectiveDate])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
}

model ContractClause {
  id           String             @id @default(uuid())
  tenantId     String
  clauseName   String             @db.VarChar(255)
  clauseText   String
  clauseType   ContractClauseType
  isRequired   Boolean            @default(false)
  displayOrder Int                @default(0)
  isActive     Boolean            @default(true)
  externalId   String?            @db.VarChar(255)
  sourceSystem String?            @db.VarChar(100)
  customFields Json               @default("{}")
  createdAt    DateTime           @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  tenant       Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([clauseType])
  @@index([displayOrder])
  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([tenantId])
}

model ContractLaneRate {
  id                     String       @id @default(uuid())
  contractId             String
  originCity             String?      @db.VarChar(100)
  originState            String?      @db.VarChar(50)
  originZip              String?      @db.VarChar(20)
  originZone             String?      @db.VarChar(50)
  originRadiusMiles      Int?
  destinationCity        String?      @db.VarChar(100)
  destinationState       String?      @db.VarChar(50)
  destinationZip         String?      @db.VarChar(20)
  destinationZone        String?      @db.VarChar(50)
  destinationRadiusMiles Int?
  serviceType            String?      @db.VarChar(50)
  equipmentType          String?      @db.VarChar(50)
  rateType               String       @db.VarChar(50)
  rateAmount             Decimal      @db.Decimal(12, 2)
  minimumCharge          Decimal?     @db.Decimal(12, 2)
  fuelIncluded           Boolean      @default(false)
  fuelSurchargeType      String?      @db.VarChar(50)
  fuelSurchargePercent   Decimal?     @db.Decimal(5, 2)
  volumeMin              Int?
  volumeMax              Int?
  effectiveDate          DateTime?
  expirationDate         DateTime?
  notes                  String?
  createdAt              DateTime     @default(now())
  updatedAt              DateTime @updatedAt
  createdById            String?
  customFields           Json         @default("{}")
  deletedAt              DateTime?
  externalId             String?      @db.VarChar(255)
  sourceSystem           String?      @db.VarChar(100)
  tenantId               String
  updatedById            String?
  rateContract           RateContract @relation(fields: [contractId], references: [id], onDelete: Cascade)
  tenant                 Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([contractId])
  @@index([destinationState, destinationCity])
  @@index([originState, originCity])
}

model ContractMetric {
  id           String     @id @default(uuid())
  tenantId     String
  contractId   String
  metricType   MetricType
  metricName   String?    @db.VarChar(255)
  periodStart  DateTime   @db.Date
  periodEnd    DateTime   @db.Date
  targetValue  Decimal    @db.Decimal(15, 2)
  actualValue  Decimal?   @db.Decimal(15, 2)
  unit         String?    @db.VarChar(50)
  isMet        Boolean?
  variance     Decimal?   @db.Decimal(15, 2)
  externalId   String?    @db.VarChar(255)
  sourceSystem String?    @db.VarChar(100)
  customFields Json       @default("{}")
  createdAt    DateTime   @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  contract     Contract?            @relation(fields: [contractId], references: [id], onDelete: Cascade)
  tenant       Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([contractId])
  @@index([externalId, sourceSystem])
  @@index([metricType])
  @@index([periodEnd])
  @@index([periodStart])
  @@index([tenantId])
}

model ContractRateLane {
  id                   String              @id @default(uuid())
  tenantId             String
  rateTableId          String
  originCity           String              @db.VarChar(100)
  originState          String              @db.VarChar(2)
  originZip            String?             @db.VarChar(10)
  destCity             String              @db.VarChar(100)
  destState            String              @db.VarChar(2)
  destZip              String?             @db.VarChar(10)
  equipmentType        String              @db.VarChar(50)
  rateType             RateType
  rateAmount           Decimal             @db.Decimal(10, 2)
  currency             String              @default("USD") @db.VarChar(3)
  fuelSurchargeTableId String?
  externalId           String?             @db.VarChar(255)
  sourceSystem         String?             @db.VarChar(100)
  customFields         Json                @default("{}")
  createdAt            DateTime            @default(now())
  updatedAt            DateTime @updatedAt
  deletedAt            DateTime?
  createdById          String?
  updatedById          String?
  fuelSurchargeTable   FuelSurchargeTable? @relation(fields: [fuelSurchargeTableId], references: [id])
  contractRateTable    ContractRateTable   @relation(fields: [rateTableId], references: [id], onDelete: Cascade)
  tenant               Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([destState])
  @@index([equipmentType])
  @@index([externalId, sourceSystem])
  @@index([originState])
  @@index([rateTableId])
  @@index([tenantId])
}

model ContractRateTable {
  id               String             @id @default(uuid())
  tenantId         String
  contractId       String
  tableName        String             @db.VarChar(255)
  effectiveDate    DateTime           @db.Date
  expirationDate   DateTime?          @db.Date
  isActive         Boolean            @default(true)
  externalId       String?            @db.VarChar(255)
  sourceSystem     String?            @db.VarChar(100)
  customFields     Json               @default("{}")
  createdAt        DateTime           @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  createdById      String?
  updatedById      String?
  ContractRateLane ContractRateLane[]
  contract         Contract?            @relation(fields: [contractId], references: [id], onDelete: Cascade)
  tenant           Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([contractId])
  @@index([effectiveDate])
  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([tenantId])
}

model ContractSLA {
  id                String    @id @default(uuid())
  tenantId          String
  contractId        String
  slaType           SLAType
  targetPercent     Decimal   @db.Decimal(5, 2)
  measurementPeriod String    @db.VarChar(50)
  penaltyAmount     Decimal?  @db.Decimal(12, 2)
  penaltyPercent    Decimal?  @db.Decimal(5, 2)
  status            String    @default("ACTIVE") @db.VarChar(50)
  externalId        String?   @db.VarChar(255)
  sourceSystem      String?   @db.VarChar(100)
  customFields      Json      @default("{}")
  createdAt         DateTime  @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  contract          Contract?            @relation(fields: [contractId], references: [id], onDelete: Cascade)
  tenant            Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([contractId])
  @@index([externalId, sourceSystem])
  @@index([slaType])
  @@index([tenantId])
}

model ContractTemplate {
  id              String       @id @default(uuid())
  tenantId        String
  templateName    String       @db.VarChar(255)
  contractType    ContractType
  templateContent String
  defaultTerms    String?
  isActive        Boolean      @default(true)
  version         Int          @default(1)
  externalId      String?      @db.VarChar(255)
  sourceSystem    String?      @db.VarChar(100)
  customFields    Json         @default("{}")
  createdAt       DateTime     @default(now())
  updatedAt       DateTime @updatedAt
  deletedAt       DateTime?
  createdById     String?
  updatedById     String?
  tenant          Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([contractType])
  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([tenantId])
}

model CreditApplication {
  id                String                  @id @default(uuid())
  tenantId          String
  companyId         String
  customerId        String?
  applicationNumber String                  @unique @db.VarChar(50)
  status            CreditApplicationStatus @default(PENDING)
  requestedLimit    Decimal                 @db.Decimal(12, 2)
  approvedLimit     Decimal?                @db.Decimal(12, 2)
  businessName      String                  @db.VarChar(255)
  dbaName           String?                 @db.VarChar(255)
  federalTaxId      String?                 @db.VarChar(20)
  dunsNumber        String?                 @db.VarChar(20)
  yearsInBusiness   Int?
  businessType      String?                 @db.VarChar(100)
  annualRevenue     Decimal?                @db.Decimal(15, 2)
  bankName          String?                 @db.VarChar(255)
  bankAccountNumber String?                 @db.VarChar(100)
  bankContactName   String?                 @db.VarChar(255)
  bankContactPhone  String?                 @db.VarChar(20)
  tradeReferences   Json?
  ownerName         String?                 @db.VarChar(255)
  ownerSSN          String?                 @db.VarChar(20)
  ownerAddress      String?
  creditScore       Int?
  creditCheckDate   DateTime?
  creditReportUrl   String?                 @db.VarChar(500)
  reviewedById      String?
  reviewedAt        DateTime?
  denialReason      String?
  conditions        String?
  approvedAt        DateTime?
  expiresAt         DateTime?
  externalId        String?                 @db.VarChar(255)
  sourceSystem      String?                 @db.VarChar(100)
  customFields      Json                    @default("{}")
  createdAt         DateTime                @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  company             Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tenant            Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([applicationNumber])
  @@index([companyId])
  @@index([createdAt])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId])
}

model CreditHold {
  id              String           @id @default(uuid())
  tenantId        String
  companyId       String
  customerId      String?
  reason          CreditHoldReason
  description     String?
  amountHeld      Decimal?         @db.Decimal(12, 2)
  isActive        Boolean          @default(true)
  resolvedById    String?
  resolvedAt      DateTime?
  resolutionNotes String?
  externalId      String?          @db.VarChar(255)
  sourceSystem    String?          @db.VarChar(100)
  customFields    Json             @default("{}")
  createdAt       DateTime         @default(now())
  updatedAt       DateTime @updatedAt
  deletedAt       DateTime?
  createdById     String?
  updatedById     String?
  company             Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tenant          Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([createdAt])
  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([reason])
  @@index([tenantId])
}

model CreditLimit {
  id                  String            @id @default(uuid())
  tenantId            String
  companyId           String
  customerId          String?
  creditLimit         Decimal           @db.Decimal(12, 2)
  availableCredit     Decimal           @db.Decimal(12, 2)
  usedCredit          Decimal           @default(0) @db.Decimal(12, 2)
  status              CreditLimitStatus @default(ACTIVE)
  paymentTerms        String?           @db.VarChar(100)
  gracePeriodDays     Int               @default(0)
  singleLoadLimit     Decimal?          @db.Decimal(12, 2)
  monthlyLimit        Decimal?          @db.Decimal(12, 2)
  lastReviewDate      DateTime?
  nextReviewDate      DateTime?
  reviewFrequencyDays Int               @default(90)
  approvedById        String?
  approvedAt          DateTime?
  expiresAt           DateTime?
  externalId          String?           @db.VarChar(255)
  sourceSystem        String?           @db.VarChar(100)
  customFields        Json              @default("{}")
  createdAt           DateTime          @default(now())
  updatedAt           DateTime @updatedAt
  deletedAt           DateTime?
  createdById         String?
  updatedById         String?
  company             Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tenant              Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, companyId])
  @@index([companyId])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId])
}

model CsaScore {
  id                 String              @id @default(uuid())
  tenantId           String
  carrierId          String
  fmcsaRecordId      String?
  basicType          CSABasicType
  score              Decimal?            @db.Decimal(5, 2)
  percentile         Int?
  threshold          Int?
  isAboveThreshold   Boolean             @default(false)
  isAlert            Boolean             @default(false)
  inspectionCount    Int                 @default(0)
  violationCount     Int                 @default(0)
  oosViolationCount  Int                 @default(0)
  measurementPeriod  String?             @db.VarChar(50)
  asOfDate           DateTime            @db.Date
  externalId         String?             @db.VarChar(255)
  sourceSystem       String?             @db.VarChar(100)
  customFields       Json                @default("{}")
  createdAt          DateTime            @default(now())
  updatedAt          DateTime @updatedAt
  deletedAt          DateTime?
  createdById        String?
  updatedById        String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  fmcsaRecord FmcsaCarrierRecord? @relation(fields: [fmcsaRecordId], references: [id])
  tenant             Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, carrierId, basicType, asOfDate])
  @@index([asOfDate])
  @@index([basicType])
  @@index([carrierId])
  @@index([externalId, sourceSystem])
  @@index([isAlert])
  @@index([tenantId])
}

model CustomerCommissionOverride {
  id               String    @id @default(uuid())
  tenantId         String
  companyId        String
  userId           String
  rateType         String    @db.VarChar(50)
  rateAmount       Decimal   @db.Decimal(10, 2)
  calculationBasis String?   @db.VarChar(50)
  effectiveDate    DateTime  @db.Date
  endDate          DateTime? @db.Date
  notes            String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime @updatedAt
  createdById      String?
  customFields     Json      @default("{}")
  deletedAt        DateTime?
  externalId       String?   @db.VarChar(255)
  sourceSystem     String?   @db.VarChar(100)
  updatedById      String?
  company             Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tenant           Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User?              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([tenantId, companyId, userId, effectiveDate])
  @@index([companyId])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
  @@index([userId])
}

model Dashboard {
  id              String            @id @default(uuid())
  tenantId        String
  name            String            @db.VarChar(255)
  description     String?
  isPublic        Boolean           @default(false)
  ownerId         String?
  layout          Json              @default("{}")
  status          String            @default("ACTIVE") @db.VarChar(50)
  externalId      String?           @db.VarChar(255)
  sourceSystem    String?           @db.VarChar(100)
  customFields    Json              @default("{}")
  createdAt       DateTime          @default(now())
  updatedAt       DateTime @updatedAt
  deletedAt       DateTime?
  createdById     String?
  updatedById     String?
  tenant          Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  dashboardWidgets DashboardWidget[]

  @@index([externalId, sourceSystem])
  @@index([ownerId])
  @@index([status])
  @@index([tenantId])
}

model DashboardWidget {
  id              String         @id @default(uuid())
  tenantId        String
  dashboardId     String
  kpiDefinitionId String?
  widgetType      String         @db.VarChar(50)
  title           String?        @db.VarChar(255)
  position        Int            @default(0)
  width           Int            @default(12)
  height          Int            @default(4)
  configuration   Json           @default("{}")
  refreshInterval Int?
  externalId      String?        @db.VarChar(255)
  sourceSystem    String?        @db.VarChar(100)
  customFields    Json           @default("{}")
  createdAt       DateTime       @default(now())
  updatedAt       DateTime @updatedAt
  deletedAt       DateTime?
  createdById     String?
  updatedById     String?
  dashboard       Dashboard      @relation(fields: [dashboardId], references: [id], onDelete: Cascade)
  kpiDefinition   KPIDefinition? @relation(fields: [kpiDefinitionId], references: [id])
  tenant          Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([dashboardId])
  @@index([externalId, sourceSystem])
  @@index([kpiDefinitionId])
  @@index([position])
  @@index([tenantId])
}

model Department {
  id                 String              @id @default(uuid())
  tenantId           String
  code               String              @unique @db.VarChar(50)
  name               String              @db.VarChar(255)
  description        String?
  parentDepartmentId String?
  status             String              @default("ACTIVE") @db.VarChar(50)
  externalId         String?             @db.VarChar(255)
  sourceSystem       String?             @db.VarChar(100)
  customFields       Json                @default("{}")
  createdAt          DateTime            @default(now())
  updatedAt          DateTime @updatedAt
  deletedAt          DateTime?
  createdById        String?
  updatedById        String?
  department         Department?         @relation("DepartmentToDepartment", fields: [parentDepartmentId], references: [id])
  other_Department   Department[]        @relation("DepartmentToDepartment")
  tenant             Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  Employee           Employee[]
  EmploymentHistory  EmploymentHistory[]

  @@unique([tenantId, code])
  @@index([externalId, sourceSystem])
  @@index([parentDepartmentId])
  @@index([status])
  @@index([tenantId])
}

model DistributedLock {
  id           String    @id @default(uuid())
  tenantId     String?
  lockKey      String    @db.VarChar(200)
  holderId     String    @db.VarChar(100)
  acquiredAt   DateTime
  expiresAt    DateTime
  releasedAt   DateTime?
  purpose      String?
  externalId   String?   @db.VarChar(255)
  sourceSystem String?   @db.VarChar(100)
  customFields Json      @default("{}")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  Tenant       Tenant?   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([lockKey, acquiredAt])
  @@index([tenantId])
}

model Document {
  id                    String                  @id @default(uuid())
  tenantId              String
  externalId            String?                 @db.VarChar(100)
  sourceSystem          String?                 @db.VarChar(50)
  name                  String                  @db.VarChar(255)
  description           String?
  documentType          String                  @db.VarChar(50)
  fileName              String                  @db.VarChar(255)
  filePath              String                  @db.VarChar(500)
  fileSize              Int
  mimeType              String                  @db.VarChar(100)
  fileExtension         String?                 @db.VarChar(20)
  storageProvider       String                  @default("S3") @db.VarChar(50)
  bucketName            String?                 @db.VarChar(100)
  entityType            String?                 @db.VarChar(50)
  entityId              String?
  loadId                String?
  orderId               String?
  carrierId             String?
  companyId             String?
  status                String                  @default("ACTIVE") @db.VarChar(50)
  ocrProcessed          Boolean                 @default(false)
  ocrText               String?
  ocrProcessedAt        DateTime?
  metadata              Json                    @default("{}")
  tags                  String[]                @db.VarChar(100)
  version               Int                     @default(1)
  parentDocumentId      String?
  isLatestVersion       Boolean                 @default(true)
  isPublic              Boolean                 @default(false)
  accessToken           String?                 @db.VarChar(100)
  accessExpiresAt       DateTime?
  retentionDate         DateTime?               @db.Date
  uploadedBy            String?
  createdAt             DateTime                @default(now())
  updatedAt             DateTime @updatedAt
  deletedAt             DateTime?
  createdById           String?
  customFields          Json                    @default("{}")
  updatedById           String?
  AgentPayout           AgentPayout[]
  documents ClaimDocument[]
  ContractAmendment     ContractAmendment[]
  carrier             Carrier?           @relation(fields: [carrierId], references: [id])
  company             Company?           @relation(fields: [companyId], references: [id])
  load                  Load?              @relation(fields: [loadId], references: [id])
  order               Order?             @relation(fields: [orderId], references: [id])
  parentDocument              Document?               @relation("DocumentToDocument", fields: [parentDocumentId], references: [id])
  childDocuments Document[]              @relation("DocumentToDocument")
  tenant                Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  uploader                User?              @relation(fields: [uploadedBy], references: [id])
  DocumentShare         DocumentShare[]
  FactoringVerification FactoringVerification[]
  FolderDocument        FolderDocument[]
  GeneratedDocument     GeneratedDocument[]

  @@index([carrierId])
  @@index([companyId])
  @@index([createdAt])
  @@index([entityType, entityId])
  @@index([externalId, sourceSystem])
  @@index([loadId])
  @@index([tenantId, deletedAt])
  @@index([tenantId, documentType])
  @@index([tenantId])
}

model DocumentFolder {
  id                   String           @id @default(uuid())
  tenantId             String
  name                 String           @db.VarChar(255)
  description          String?
  parentFolderId       String?
  path                 String?          @db.VarChar(1000)
  entityType           String?          @db.VarChar(50)
  entityId             String?
  isSystem             Boolean          @default(false)
  createdAt            DateTime         @default(now())
  updatedAt            DateTime @updatedAt
  createdById          String?
  customFields         Json             @default("{}")
  deletedAt            DateTime?
  externalId           String?          @db.VarChar(255)
  sourceSystem         String?          @db.VarChar(100)
  updatedById          String?
  user                User?              @relation(fields: [createdById], references: [id])
  parentFolder       DocumentFolder?  @relation("DocumentFolderToDocumentFolder", fields: [parentFolderId], references: [id], onDelete: Cascade)
  childFolders DocumentFolder[] @relation("DocumentFolderToDocumentFolder")
  tenant               Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  folderDocuments       FolderDocument[]

  @@unique([tenantId, parentFolderId, name])
  @@index([entityType, entityId])
  @@index([externalId, sourceSystem])
  @@index([parentFolderId])
  @@index([tenantId])
}

model DocumentShare {
  id             String    @id @default(uuid())
  documentId     String
  shareType      String    @db.VarChar(50)
  accessToken    String    @unique @db.VarChar(100)
  accessPassword String?   @db.VarChar(255)
  expiresAt      DateTime?
  maxViews       Int?
  maxDownloads   Int?
  allowDownload  Boolean   @default(true)
  viewCount      Int       @default(0)
  downloadCount  Int       @default(0)
  lastAccessedAt DateTime?
  recipientEmail String?   @db.VarChar(255)
  recipientName  String?   @db.VarChar(255)
  status         String    @default("ACTIVE") @db.VarChar(50)
  createdAt      DateTime  @default(now())
  createdById    String?
  customFields   Json      @default("{}")
  deletedAt      DateTime?
  externalId     String?   @db.VarChar(255)
  sourceSystem   String?   @db.VarChar(100)
  updatedAt      DateTime @updatedAt
  updatedById    String?
  user                User?              @relation(fields: [createdById], references: [id])
  document       Document  @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@index([accessToken])
  @@index([documentId])
  @@index([externalId, sourceSystem])
}

model DocumentTemplate {
  id                String              @id @default(uuid())
  tenantId          String
  name              String              @db.VarChar(255)
  description       String?
  templateType      String              @db.VarChar(50)
  templateFormat    String              @db.VarChar(50)
  templateContent   String?
  templateFilePath  String?             @db.VarChar(500)
  paperSize         String              @default("LETTER") @db.VarChar(20)
  orientation       String              @default("PORTRAIT") @db.VarChar(20)
  margins           Json                @default("{\"top\": 1, \"left\": 1, \"right\": 1, \"bottom\": 1}")
  includeLogo       Boolean             @default(true)
  logoPosition      String              @default("TOP_LEFT") @db.VarChar(20)
  headerContent     String?
  footerContent     String?
  status            String              @default("ACTIVE") @db.VarChar(50)
  isDefault         Boolean             @default(false)
  language          String              @default("en") @db.VarChar(10)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime @updatedAt
  createdById       String?
  customFields      Json                @default("{}")
  deletedAt         DateTime?
  externalId        String?             @db.VarChar(255)
  sourceSystem      String?             @db.VarChar(100)
  updatedById       String?
  user                User?              @relation(fields: [createdById], references: [id])
  tenant            Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  GeneratedDocument GeneratedDocument[]

  @@unique([tenantId, name, templateType])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
  @@index([tenantId, templateType])
}

model Driver {
  id                      String                    @id @default(uuid())
  tenantId                String
  carrierId               String
  firstName               String                    @db.VarChar(100)
  lastName                String                    @db.VarChar(100)
  email                   String?                   @db.VarChar(255)
  phone                   String?                   @db.VarChar(50)
  cdlNumber               String?                   @db.VarChar(50)
  cdlState                String?                   @db.VarChar(3)
  cdlExpiration           DateTime?
  cdlClass                String?                   @db.VarChar(5)
  endorsements            String[]                  @db.VarChar(20)
  status                  String                    @default("ACTIVE") @db.VarChar(50)
  currentLocationLat      Decimal?                  @db.Decimal(10, 7)
  currentLocationLng      Decimal?                  @db.Decimal(10, 7)
  locationUpdatedAt       DateTime?
  totalLoads              Int                       @default(0)
  onTimeRate              Decimal?                  @db.Decimal(5, 2)
  avgRating               Decimal?                  @db.Decimal(3, 2)
  preferredLanguage       String                    @default("en") @db.VarChar(10)
  appUserId               String?
  eldProvider             String?                   @db.VarChar(50)
  eldDriverId             String?                   @db.VarChar(100)
  externalId              String?                   @db.VarChar(255)
  sourceSystem            String?                   @db.VarChar(100)
  customFields            Json                      @default("{}")
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime @updatedAt
  deletedAt               DateTime?
  createdById             String?
  updatedById             String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  tenant                  Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  DriverQualificationFile DriverQualificationFile[]
  SafetyIncident          SafetyIncident[]
  SafetyInspection        SafetyInspection[]

  @@unique([tenantId, carrierId, cdlNumber])
  @@index([carrierId])
  @@index([cdlExpiration])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId, deletedAt])
  @@index([tenantId])
  @@index([tenantId, status])
}

model DriverQualificationFile {
  id                  String          @id @default(uuid())
  tenantId            String
  driverId            String
  documentType        DQFDocumentType
  documentNumber      String?         @db.VarChar(100)
  documentUrl         String?         @db.VarChar(500)
  issueDate           DateTime?       @db.Date
  expirationDate      DateTime?       @db.Date
  isExpired           Boolean         @default(false)
  isVerified          Boolean         @default(false)
  verifiedAt          DateTime?
  verifiedById        String?
  clearinghouseStatus String?         @db.VarChar(50)
  lastQueryDate       DateTime?
  externalId          String?         @db.VarChar(255)
  sourceSystem        String?         @db.VarChar(100)
  customFields        Json            @default("{}")
  createdAt           DateTime        @default(now())
  updatedAt           DateTime @updatedAt
  deletedAt           DateTime?
  createdById         String?
  updatedById         String?
  driver              Driver          @relation(fields: [driverId], references: [id], onDelete: Cascade)
  tenant              Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([documentType])
  @@index([driverId])
  @@index([expirationDate])
  @@index([externalId, sourceSystem])
  @@index([isExpired])
  @@index([tenantId])
}

model EdiAcknowledgment {
  id                String     @id @default(uuid())
  tenantId          String
  originalMessageId String
  ackControlNumber  String     @db.VarChar(9)
  ackStatus         String     @db.VarChar(50)
  errorCodes        Json?
  receivedAt        DateTime
  externalId        String?    @db.VarChar(255)
  sourceSystem      String?    @db.VarChar(100)
  customFields      Json       @default("{}")
  createdAt         DateTime   @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  ediMessage        EdiMessage @relation(fields: [originalMessageId], references: [id], onDelete: Cascade)
  tenant            Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, ackControlNumber])
  @@index([ackStatus])
  @@index([externalId, sourceSystem])
  @@index([originalMessageId])
  @@index([receivedAt])
  @@index([tenantId])
}

model EdiBatch {
  id              String            @id @default(uuid())
  tenantId        String
  batchNumber     String            @unique @db.VarChar(50)
  batchType       String            @db.VarChar(50)
  messageCount    Int               @default(0)
  processedCount  Int               @default(0)
  errorCount      Int               @default(0)
  startedAt       DateTime?
  completedAt     DateTime?
  status          String            @db.VarChar(50)
  externalId      String?           @db.VarChar(255)
  sourceSystem    String?           @db.VarChar(100)
  customFields    Json              @default("{}")
  createdAt       DateTime          @default(now())
  updatedAt       DateTime @updatedAt
  deletedAt       DateTime?
  createdById     String?
  updatedById     String?
  tenant          Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  EdiBatchMessage EdiBatchMessage[]

  @@index([batchNumber])
  @@index([createdAt])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId])
}

model EdiBatchMessage {
  id           String     @id @default(uuid())
  tenantId     String
  batchId      String
  messageId    String
  externalId   String?    @db.VarChar(255)
  sourceSystem String?    @db.VarChar(100)
  customFields Json       @default("{}")
  createdAt    DateTime   @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  ediBatch     EdiBatch   @relation(fields: [batchId], references: [id], onDelete: Cascade)
  ediMessage   EdiMessage @relation(fields: [messageId], references: [id], onDelete: Cascade)
  tenant       Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([batchId, messageId])
  @@index([batchId])
  @@index([externalId, sourceSystem])
  @@index([messageId])
  @@index([tenantId])
}

model EdiCodeList {
  id               String              @id @default(uuid())
  tenantId         String
  listName         String              @db.VarChar(100)
  ediCode          String              @db.VarChar(50)
  internalCode     String              @db.VarChar(50)
  description      String?             @db.VarChar(500)
  isActive         Boolean             @default(true)
  tradingPartnerId String?
  transactionType  EdiTransactionType?
  externalId       String?             @db.VarChar(255)
  sourceSystem     String?             @db.VarChar(100)
  customFields     Json                @default("{}")
  createdAt        DateTime            @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  createdById      String?
  updatedById      String?
  tenant           Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, listName, ediCode, tradingPartnerId])
  @@index([ediCode])
  @@index([externalId, sourceSystem])
  @@index([internalCode])
  @@index([isActive])
  @@index([listName])
  @@index([tenantId])
}

model EdiCommunicationLog {
  id                String                   @id @default(uuid())
  tenantId          String
  tradingPartnerId  String
  direction         EdiDirection
  protocol          EdiCommunicationProtocol
  action            String                   @db.VarChar(50)
  status            String                   @db.VarChar(50)
  fileName          String?                  @db.VarChar(500)
  fileSize          Int?
  messageCount      Int?
  responseCode      String?                  @db.VarChar(50)
  errorMessage      String?
  startedAt         DateTime
  completedAt       DateTime?
  durationMs        Int?
  externalId        String?                  @db.VarChar(255)
  sourceSystem      String?                  @db.VarChar(100)
  customFields      Json                     @default("{}")
  createdAt         DateTime                 @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  tenant            Tenant                   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tradingPartner EdiTradingPartner        @relation(fields: [tradingPartnerId], references: [id], onDelete: Cascade)

  @@index([direction])
  @@index([externalId, sourceSystem])
  @@index([startedAt])
  @@index([status])
  @@index([tenantId])
  @@index([tradingPartnerId])
}

model EdiControlNumber {
  id               String              @id @default(uuid())
  tenantId         String
  controlType      String              @db.VarChar(10)
  currentNumber    Int                 @default(0)
  prefix           String?             @db.VarChar(10)
  suffix           String?             @db.VarChar(10)
  minValue         Int                 @default(1)
  maxValue         Int                 @default(999999999)
  tradingPartnerId String?
  transactionType  EdiTransactionType?
  externalId       String?             @db.VarChar(255)
  sourceSystem     String?             @db.VarChar(100)
  customFields     Json                @default("{}")
  createdAt        DateTime            @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  createdById      String?
  updatedById      String?
  tenant           Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, controlType, tradingPartnerId, transactionType])
  @@index([controlType])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
}

model EdiError {
  id           String     @id @default(uuid())
  tenantId     String
  messageId    String
  errorType    String     @db.VarChar(100)
  errorCode    String?    @db.VarChar(50)
  errorMessage String
  segment      String?    @db.VarChar(10)
  elementPath  String?    @db.VarChar(255)
  severity     String     @db.VarChar(20)
  externalId   String?    @db.VarChar(255)
  sourceSystem String?    @db.VarChar(100)
  customFields Json       @default("{}")
  createdAt    DateTime   @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  ediMessage   EdiMessage @relation(fields: [messageId], references: [id], onDelete: Cascade)
  tenant       Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([errorType])
  @@index([externalId, sourceSystem])
  @@index([messageId])
  @@index([severity])
  @@index([tenantId])
}

model EdiEventTrigger {
  id              String             @id @default(uuid())
  tenantId        String
  triggerName     String             @db.VarChar(255)
  eventType       String             @db.VarChar(100)
  transactionType EdiTransactionType
  isActive        Boolean            @default(true)
  conditions      Json?
  targetPartners  Json?
  messageTemplate String?
  externalId      String?            @db.VarChar(255)
  sourceSystem    String?            @db.VarChar(100)
  customFields    Json               @default("{}")
  createdAt       DateTime           @default(now())
  updatedAt       DateTime @updatedAt
  deletedAt       DateTime?
  createdById     String?
  updatedById     String?
  tenant          Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([eventType])
  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([tenantId])
  @@index([transactionType])
}

model EdiMessage {
  id                String               @id @default(uuid())
  tenantId          String
  tradingPartnerId  String
  messageId         String               @unique @db.VarChar(100)
  transactionType   EdiTransactionType
  direction         EdiDirection
  status            EdiMessageStatus     @default(PENDING)
  isaControlNumber  String               @db.VarChar(9)
  gsControlNumber   String               @db.VarChar(9)
  stControlNumber   String               @db.VarChar(9)
  entityType        String?              @db.VarChar(50)
  entityId          String?
  rawContent        String
  parsedContent     Json?
  processedAt       DateTime?
  validationStatus  EdiValidationStatus?
  validationErrors  Json?
  retryCount        Int                  @default(0)
  lastRetryAt       DateTime?
  functionalAckId   String?
  externalId        String?              @db.VarChar(255)
  sourceSystem      String?              @db.VarChar(100)
  customFields      Json                 @default("{}")
  createdAt         DateTime             @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  EdiAcknowledgment EdiAcknowledgment[]
  EdiBatchMessage   EdiBatchMessage[]
  EdiError          EdiError[]
  tenant            Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tradingPartner EdiTradingPartner    @relation(fields: [tradingPartnerId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([direction])
  @@index([entityType, entityId])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId])
  @@index([tradingPartnerId])
  @@index([transactionType])
}

model EdiTradingPartner {
  id                    String                   @id @default(uuid())
  tenantId              String
  partnerName           String                   @db.VarChar(255)
  partnerType           String                   @db.VarChar(50)
  isActive              Boolean                  @default(true)
  isaId                 String                   @unique @db.VarChar(15)
  gsId                  String?                  @db.VarChar(15)
  duns                  String?                  @db.VarChar(9)
  scac                  String?                  @db.VarChar(4)
  protocol              EdiCommunicationProtocol
  ftpHost               String?                  @db.VarChar(255)
  ftpPort               Int?
  ftpUsername           String?                  @db.VarChar(100)
  ftpPassword           String?                  @db.VarChar(500)
  ftpInboundPath        String?                  @db.VarChar(500)
  ftpOutboundPath       String?                  @db.VarChar(500)
  as2Url                String?                  @db.VarChar(500)
  as2Identifier         String?                  @db.VarChar(255)
  vanMailbox            String?                  @db.VarChar(100)
  sendFunctionalAck     Boolean                  @default(true)
  requireFunctionalAck  Boolean                  @default(true)
  testMode              Boolean                  @default(false)
  fieldMappings         Json?
  externalId            String?                  @db.VarChar(255)
  sourceSystem          String?                  @db.VarChar(100)
  customFields          Json                     @default("{}")
  createdAt             DateTime                 @default(now())
  updatedAt             DateTime @updatedAt
  deletedAt             DateTime?
  createdById           String?
  updatedById           String?
  EdiCommunicationLog   EdiCommunicationLog[]
  EdiMessage            EdiMessage[]
  tenant                Tenant                   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  EdiTransactionMapping EdiTransactionMapping[]

  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([isaId])
  @@index([partnerType])
  @@index([tenantId])
}

model EdiTransactionMapping {
  id                String             @id @default(uuid())
  tenantId          String
  tradingPartnerId  String
  transactionType   EdiTransactionType
  fieldMappings     Json
  defaultValues     Json?
  transformRules    Json?
  validationRules   Json?
  isActive          Boolean            @default(true)
  externalId        String?            @db.VarChar(255)
  sourceSystem      String?            @db.VarChar(100)
  customFields      Json               @default("{}")
  createdAt         DateTime           @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  tenant            Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tradingPartner EdiTradingPartner  @relation(fields: [tradingPartnerId], references: [id], onDelete: Cascade)

  @@unique([tenantId, tradingPartnerId, transactionType])
  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([tenantId])
  @@index([tradingPartnerId])
  @@index([transactionType])
}

model Employee {
  id                String              @id @default(uuid())
  tenantId          String
  userId            String?             @unique
  employeeNumber    String              @unique @db.VarChar(50)
  firstName         String              @db.VarChar(100)
  lastName          String              @db.VarChar(100)
  email             String              @db.VarChar(255)
  phone             String?             @db.VarChar(20)
  employmentType    EmploymentType
  employmentStatus  EmploymentStatus    @default(ACTIVE)
  departmentId      String?
  positionId        String?
  managerId         String?
  hireDate          DateTime            @db.Date
  terminationDate   DateTime?           @db.Date
  annualSalary      Decimal?            @db.Decimal(12, 2)
  hourlyRate        Decimal?            @db.Decimal(10, 2)
  ptoBalance        Decimal             @default(0) @db.Decimal(6, 2)
  sickBalance       Decimal             @default(0) @db.Decimal(6, 2)
  externalId        String?             @db.VarChar(255)
  sourceSystem      String?             @db.VarChar(100)
  customFields      Json                @default("{}")
  createdAt         DateTime            @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  locationId        String?
  department        Department?         @relation(fields: [departmentId], references: [id])
  location          Location?           @relation(fields: [locationId], references: [id])
  manager          Employee?           @relation("EmployeeToEmployee", fields: [managerId], references: [id])
  directReports    Employee[]          @relation("EmployeeToEmployee")
  position          Position?           @relation(fields: [positionId], references: [id])
  tenant            Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User?              @relation(fields: [userId], references: [id])
  EmploymentHistory EmploymentHistory[]
  OnboardingTask    OnboardingTask[]
  TimeEntry         TimeEntry[]
  TimeOffBalance    TimeOffBalance[]
  TimeOffRequest    TimeOffRequest[]

  @@unique([tenantId, employeeNumber])
  @@index([departmentId])
  @@index([employmentStatus])
  @@index([externalId, sourceSystem])
  @@index([managerId])
  @@index([tenantId])
  @@index([userId])
}

model EmploymentHistory {
  id           String        @id @default(uuid())
  tenantId     String
  employeeId   String
  positionId   String
  departmentId String
  startDate    DateTime      @db.Date
  endDate      DateTime?     @db.Date
  changeReason ChangeReason?
  salaryAtTime Decimal?      @db.Decimal(12, 2)
  notes        String?
  externalId   String?       @db.VarChar(255)
  sourceSystem String?       @db.VarChar(100)
  customFields Json          @default("{}")
  createdAt    DateTime      @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  department   Department    @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  employee     Employee      @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  position     Position      @relation(fields: [positionId], references: [id], onDelete: Cascade)
  tenant       Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([departmentId])
  @@index([employeeId])
  @@index([endDate])
  @@index([externalId, sourceSystem])
  @@index([positionId])
  @@index([startDate])
  @@index([tenantId])
}

model EscalationRule {
  id             String    @id @default(uuid())
  tenantId       String
  name           String    @db.VarChar(100)
  description    String?
  triggerType    String    @db.VarChar(30)
  triggerMinutes Int?
  conditions     Json?
  actionType     String    @db.VarChar(30)
  actionConfig   Json
  isActive       Boolean   @default(true)
  externalId     String?   @db.VarChar(255)
  sourceSystem   String?   @db.VarChar(100)
  customFields   Json      @default("{}")
  createdAt      DateTime  @default(now())
  updatedAt      DateTime @updatedAt
  deletedAt      DateTime?
  createdById    String?
  updatedById    String?
  tenant         Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([tenantId])
  @@index([triggerType])
}

model FactoredPayment {
  id                 String           @id @default(uuid())
  tenantId           String
  settlementId       String
  factoringCompanyId String
  paymentAmount      Decimal          @db.Decimal(12, 2)
  paymentDate        DateTime         @db.Date
  paymentMethod      PaymentMethod
  verificationCode   String?          @db.VarChar(100)
  notes              String?
  externalId         String?          @db.VarChar(255)
  sourceSystem       String?          @db.VarChar(100)
  customFields       Json             @default("{}")
  createdAt          DateTime         @default(now())
  updatedAt          DateTime @updatedAt
  deletedAt          DateTime?
  createdById        String?
  updatedById        String?
  factoringCompany   FactoringCompany @relation(fields: [factoringCompanyId], references: [id], onDelete: Cascade)
  settlement         Settlement       @relation(fields: [settlementId], references: [id], onDelete: Cascade)
  tenant             Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([factoringCompanyId])
  @@index([paymentDate])
  @@index([settlementId])
  @@index([tenantId])
}

model FactoringCompany {
  id                     String                   @id @default(uuid())
  tenantId               String
  companyCode            String                   @unique @db.VarChar(50)
  name                   String                   @db.VarChar(255)
  email                  String?                  @db.VarChar(255)
  phone                  String?                  @db.VarChar(20)
  fax                    String?                  @db.VarChar(20)
  address                String?
  verificationMethod     String                   @db.VarChar(50)
  apiEndpoint            String?                  @db.VarChar(500)
  apiKey                 String?                  @db.VarChar(255)
  verificationSLAHours   Int                      @default(24)
  status                 String                   @default("ACTIVE") @db.VarChar(50)
  externalId             String?                  @db.VarChar(255)
  sourceSystem           String?                  @db.VarChar(100)
  customFields           Json                     @default("{}")
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime @updatedAt
  deletedAt              DateTime?
  createdById            String?
  updatedById            String?
  CarrierFactoringStatus CarrierFactoringStatus[]
  FactoredPayment        FactoredPayment[]
  tenant                 Tenant                   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  NOARecord              NOARecord[]

  @@index([companyCode])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId])
}

model FactoringVerification {
  id                     String             @id @default(uuid())
  tenantId               String
  noaRecordId            String
  verificationDate       DateTime           @db.Date
  verificationMethod     VerificationMethod
  contactedPerson        String?            @db.VarChar(255)
  verificationStatus     VerificationStatus
  verificationDocumentId String?
  notes                  String?
  nextVerificationDate   DateTime?          @db.Date
  externalId             String?            @db.VarChar(255)
  sourceSystem           String?            @db.VarChar(100)
  customFields           Json               @default("{}")
  createdAt              DateTime           @default(now())
  updatedAt              DateTime @updatedAt
  deletedAt              DateTime?
  createdById            String?
  updatedById            String?
  noaRecord              NOARecord          @relation(fields: [noaRecordId], references: [id], onDelete: Cascade)
  tenant                 Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  document               Document?          @relation(fields: [verificationDocumentId], references: [id])

  @@index([externalId, sourceSystem])
  @@index([nextVerificationDate])
  @@index([noaRecordId])
  @@index([tenantId])
  @@index([verificationDate])
  @@index([verificationStatus])
}

model FeatureFlag {
  id                  String                @id @default(uuid())
  key                 String                @unique @db.VarChar(100)
  name                String                @db.VarChar(255)
  description         String?
  status              FeatureFlagStatus     @default(ACTIVE)
  enabled             Boolean               @default(false)
  rolloutPercent      Int                   @default(0)
  tenantIds           String[]
  userIds             String[]
  externalId          String?               @db.VarChar(255)
  sourceSystem        String?               @db.VarChar(100)
  customFields        Json                  @default("{}")
  createdAt           DateTime              @default(now())
  updatedAt           DateTime @updatedAt
  deletedAt           DateTime?
  createdById         String?
  updatedById         String?
  FeatureFlagOverride FeatureFlagOverride[]

  @@index([enabled])
  @@index([externalId, sourceSystem])
  @@index([key])
  @@index([status])
}

model FeatureFlagOverride {
  id            String      @id @default(uuid())
  featureFlagId String
  tenantId      String?
  userId        String?
  overrideValue Boolean
  expiresAt     DateTime?   @db.Timestamp(6)
  externalId    String?     @db.VarChar(255)
  sourceSystem  String?     @db.VarChar(100)
  customFields  Json        @default("{}")
  createdAt     DateTime    @default(now())
  updatedAt     DateTime @updatedAt
  deletedAt     DateTime?
  createdById   String?
  updatedById   String?
  featureFlag   FeatureFlag @relation(fields: [featureFlagId], references: [id], onDelete: Cascade)
  Tenant        Tenant?     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User?              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([externalId, sourceSystem])
  @@index([featureFlagId])
  @@index([tenantId])
  @@index([userId])
}

model FeatureRequest {
  id                    String                  @id @default(uuid())
  tenantId              String
  title                 String                  @db.VarChar(500)
  description           String
  submitterId           String?
  submitterName         String?                 @db.VarChar(255)
  submitterEmail        String?                 @db.VarChar(255)
  status                FeatureRequestStatus    @default(SUBMITTED)
  voteCount             Int                     @default(0)
  implementedAt         DateTime?
  releaseNotes          String?
  externalId            String?                 @db.VarChar(255)
  sourceSystem          String?                 @db.VarChar(100)
  customFields          Json                    @default("{}")
  createdAt             DateTime                @default(now())
  updatedAt             DateTime @updatedAt
  deletedAt             DateTime?
  createdById           String?
  updatedById           String?
  tenant                Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  FeatureRequestComment FeatureRequestComment[]
  FeatureRequestVote    FeatureRequestVote[]

  @@index([createdAt])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId])
  @@index([voteCount])
}

model FeatureRequestComment {
  id             String         @id @default(uuid())
  requestId      String
  authorType     String         @db.VarChar(20)
  authorUserId   String?
  authorName     String         @db.VarChar(200)
  content        String
  isOfficial     Boolean        @default(false)
  externalId     String?        @db.VarChar(255)
  sourceSystem   String?        @db.VarChar(100)
  customFields   Json           @default("{}")
  createdAt      DateTime       @default(now())
  updatedAt      DateTime @updatedAt
  deletedAt      DateTime?
  createdById    String?
  updatedById    String?
  featureRequest FeatureRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)

  @@index([authorUserId])
  @@index([createdAt])
  @@index([externalId, sourceSystem])
  @@index([requestId])
}

model FeatureRequestVote {
  id             String         @id @default(uuid())
  requestId      String
  userId         String?
  voterEmail     String?        @db.VarChar(255)
  voteWeight     Int            @default(1)
  externalId     String?        @db.VarChar(255)
  sourceSystem   String?        @db.VarChar(100)
  customFields   Json           @default("{}")
  createdAt      DateTime       @default(now())
  updatedAt      DateTime @updatedAt
  deletedAt      DateTime?
  createdById    String?
  updatedById    String?
  featureRequest FeatureRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)

  @@unique([requestId, userId])
  @@index([externalId, sourceSystem])
  @@index([requestId])
  @@index([userId])
}

model FeedbackWidget {
  id              String    @id @default(uuid())
  tenantId        String
  name            String    @db.VarChar(200)
  description     String?
  placement       String    @db.VarChar(50)
  pages           Json?
  widgetType      String    @db.VarChar(30)
  config          Json
  triggerRules    Json?
  isActive        Boolean   @default(true)
  impressionCount Int       @default(0)
  responseCount   Int       @default(0)
  externalId      String?   @db.VarChar(255)
  sourceSystem    String?   @db.VarChar(100)
  customFields    Json      @default("{}")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime @updatedAt
  deletedAt       DateTime?
  createdById     String?
  updatedById     String?
  tenant          Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([tenantId])
}

model FmcsaCarrierRecord {
  id                String           @id @default(uuid())
  tenantId          String
  carrierId         String           @unique
  dotNumber         String?          @db.VarChar(20)
  mcNumber          String?          @db.VarChar(20)
  legalName         String?          @db.VarChar(255)
  dbaName           String?          @db.VarChar(255)
  operatingStatus   SaferDataStatus?
  outOfServiceDate  DateTime?
  commonAuthority   Boolean          @default(false)
  contractAuthority Boolean          @default(false)
  brokerAuthority   Boolean          @default(false)
  physicalAddress   String?
  physicalCity      String?          @db.VarChar(100)
  physicalState     String?          @db.VarChar(2)
  physicalZip       String?          @db.VarChar(10)
  mailingAddress    String?
  mailingCity       String?          @db.VarChar(100)
  mailingState      String?          @db.VarChar(2)
  mailingZip        String?          @db.VarChar(10)
  phone             String?          @db.VarChar(20)
  powerUnitCount    Int?
  driverCount       Int?
  saferDataJson     Json?
  lastSyncedAt      DateTime?
  externalId        String?          @db.VarChar(255)
  sourceSystem      String?          @db.VarChar(100)
  customFields      Json             @default("{}")
  createdAt         DateTime         @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  CsaScore          CsaScore[]
  carrier             Carrier?           @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  tenant            Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([carrierId])
  @@index([dotNumber])
  @@index([externalId, sourceSystem])
  @@index([mcNumber])
  @@index([operatingStatus])
  @@index([tenantId])
}

model FmcsaComplianceLog {
  id                   String    @id @default(uuid())
  tenantId             String
  carrierId            String
  checkedAt            DateTime  @default(now())
  dotNumber            String?   @db.VarChar(20)
  mcNumber             String?   @db.VarChar(20)
  authorityStatus      String?   @db.VarChar(50)
  commonAuthority      Boolean?
  contractAuthority    Boolean?
  brokerAuthority      Boolean?
  safetyRating         String?   @db.VarChar(50)
  outOfService         Boolean?
  driverInspections    Int?
  driverOosRate        Decimal?  @db.Decimal(5, 2)
  vehicleInspections   Int?
  vehicleOosRate       Decimal?  @db.Decimal(5, 2)
  fmcsaInsuranceOnFile Boolean?
  fmcsaInsuranceAmount Decimal?  @db.Decimal(14, 2)
  changesDetected      Json      @default("[]")
  rawResponse          Json?
  createdAt            DateTime  @default(now())
  createdById          String?
  customFields         Json      @default("{}")
  deletedAt            DateTime?
  externalId           String?   @db.VarChar(255)
  sourceSystem         String?   @db.VarChar(100)
  updatedAt            DateTime @updatedAt
  updatedById          String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  tenant               Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([carrierId])
  @@index([checkedAt])
  @@index([dotNumber])
  @@index([externalId, sourceSystem])
  @@index([mcNumber])
  @@index([tenantId])
}

model FolderDocument {
  folderId       String
  documentId     String
  addedAt        DateTime       @default(now())
  addedBy        String?
  createdById    String?
  customFields   Json           @default("{}")
  deletedAt      DateTime?
  externalId     String?        @db.VarChar(255)
  sourceSystem   String?        @db.VarChar(100)
  updatedAt      DateTime @updatedAt
  updatedById    String?
  user                User?              @relation(fields: [addedBy], references: [id])
  document       Document       @relation(fields: [documentId], references: [id], onDelete: Cascade)
  folder DocumentFolder @relation(fields: [folderId], references: [id], onDelete: Cascade)

  @@id([folderId, documentId])
}

model FuelSurchargeTable {
  id                String              @id @default(uuid())
  tenantId          String
  contractId        String?
  name              String              @db.VarChar(255)
  description       String?
  basePrice         Decimal             @db.Decimal(5, 3)
  isDefault         Boolean             @default(false)
  effectiveDate     DateTime            @db.Date
  expirationDate    DateTime?           @db.Date
  status            String              @default("ACTIVE") @db.VarChar(50)
  externalId        String?             @db.VarChar(255)
  sourceSystem      String?             @db.VarChar(100)
  customFields      Json                @default("{}")
  createdAt         DateTime            @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  ContractRateLane  ContractRateLane[]
  contract          Contract?            @relation(fields: [contractId], references: [id])
  tenant            Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tiers FuelSurchargeTier[]

  @@index([contractId])
  @@index([effectiveDate])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId])
}

model FuelSurchargeTier {
  id                 String             @id @default(uuid())
  tableId            String
  tierNumber         Int
  priceMin           Decimal            @db.Decimal(5, 3)
  priceMax           Decimal?           @db.Decimal(5, 3)
  surchargePercent   Decimal            @db.Decimal(5, 2)
  externalId         String?            @db.VarChar(255)
  sourceSystem       String?            @db.VarChar(100)
  customFields       Json               @default("{}")
  createdAt          DateTime           @default(now())
  updatedAt          DateTime @updatedAt
  deletedAt          DateTime?
  createdById        String?
  updatedById        String?
  table FuelSurchargeTable @relation(fields: [tableId], references: [id], onDelete: Cascade)

  @@unique([tableId, tierNumber])
  @@index([externalId, sourceSystem])
  @@index([tableId])
}

model GeneratedDocument {
  id               String           @id @default(uuid())
  tenantId         String
  templateId       String
  documentId       String?
  entityType       String           @db.VarChar(50)
  entityId         String
  dataSnapshot     Json
  status           String           @default("PENDING") @db.VarChar(50)
  errorMessage     String?
  requestedAt      DateTime         @default(now())
  completedAt      DateTime?
  requestedBy      String?
  createdById      String?
  customFields     Json             @default("{}")
  deletedAt        DateTime?
  externalId       String?          @db.VarChar(255)
  sourceSystem     String?          @db.VarChar(100)
  updatedAt        DateTime @updatedAt
  updatedById      String?
  document         Document?        @relation(fields: [documentId], references: [id])
  user                User?              @relation(fields: [requestedBy], references: [id])
  documentTemplate DocumentTemplate @relation(fields: [templateId], references: [id])
  tenant           Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([entityType, entityId])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId])
}

model Holiday {
  id           String    @id @default(uuid())
  tenantId     String
  holidayName  String    @db.VarChar(255)
  holidayDate  DateTime  @db.Date
  isRecurring  Boolean   @default(false)
  countryCode  String?   @db.VarChar(2)
  externalId   String?   @db.VarChar(255)
  sourceSystem String?   @db.VarChar(100)
  customFields Json      @default("{}")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([countryCode])
  @@index([externalId, sourceSystem])
  @@index([holidayDate])
  @@index([tenantId])
}

model HubspotSyncLog {
  id              String   @id @default(uuid())
  tenantId        String
  entityType      String   @db.VarChar(50)
  entityId        String
  hubspotId       String   @db.VarChar(50)
  syncDirection   String   @db.VarChar(20)
  syncStatus      String   @db.VarChar(20)
  payloadSent     Json?
  payloadReceived Json?
  errorMessage    String?
  syncedAt        DateTime @default(now())
  createdAt       DateTime @default(now())
  externalId      String?  @db.VarChar(255)
  sourceSystem    String?  @db.VarChar(100)
  updatedAt       DateTime @updatedAt
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([entityType, entityId])
  @@index([hubspotId])
  @@index([syncStatus])
  @@index([syncedAt])
  @@index([tenantId])
}

model InAppNotification {
  id           String    @id @default(uuid())
  tenantId     String
  userId       String
  type         String    @db.VarChar(50)
  title        String    @db.VarChar(255)
  message      String
  icon         String?   @db.VarChar(50)
  actionUrl    String?   @db.VarChar(500)
  entityType   String?   @db.VarChar(50)
  entityId     String?
  isRead       Boolean   @default(false)
  readAt       DateTime?
  expiresAt    DateTime?
  createdAt    DateTime  @default(now())
  createdById  String?
  customFields Json      @default("{}")
  deletedAt    DateTime?
  externalId   String?   @db.VarChar(255)
  sourceSystem String?   @db.VarChar(100)
  updatedAt    DateTime @updatedAt
  updatedById  String?
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User?              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([externalId, sourceSystem])
  @@index([isRead])
  @@index([tenantId])
  @@index([type])
  @@index([userId])
}

model InsuranceCertificate {
  id                    String    @id @default(uuid())
  tenantId              String
  carrierId             String
  insuranceType         String    @db.VarChar(50)
  policyNumber          String?   @db.VarChar(100)
  insuranceCompany      String    @db.VarChar(255)
  coverageAmount        Decimal   @db.Decimal(14, 2)
  deductible            Decimal?  @db.Decimal(12, 2)
  effectiveDate         DateTime
  expirationDate        DateTime
  certificateHolderName String?   @db.VarChar(255)
  additionalInsured     Boolean   @default(false)
  documentUrl           String?   @db.VarChar(500)
  status                String    @default("ACTIVE") @db.VarChar(50)
  verified              Boolean   @default(false)
  verifiedById          String?
  verifiedAt            DateTime?
  expirationNotified30  Boolean   @default(false)
  expirationNotified14  Boolean   @default(false)
  expirationNotified7   Boolean   @default(false)
  createdAt             DateTime  @default(now())
  updatedAt             DateTime @updatedAt
  createdById           String?
  customFields          Json      @default("{}")
  deletedAt             DateTime?
  externalId            String?   @db.VarChar(255)
  sourceSystem          String?   @db.VarChar(100)
  updatedById           String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  tenant                Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([carrierId, insuranceType, policyNumber])
  @@index([carrierId])
  @@index([expirationDate])
  @@index([externalId, sourceSystem])
  @@index([insuranceType])
  @@index([status])
  @@index([tenantId])
}

model Integration {
  id                        String                     @id @default(uuid())
  tenantId                  String
  name                      String                     @db.VarChar(255)
  description               String?
  category                  IntegrationCategory
  provider                  String                     @db.VarChar(100)
  authType                  AuthType
  apiKey                    String?                    @db.VarChar(500)
  apiSecret                 String?                    @db.VarChar(500)
  oauthTokens               Json?
  config                    Json                       @default("{}")
  syncFrequency             SyncFrequency
  lastSyncAt                DateTime?
  nextSyncAt                DateTime?
  status                    String                     @default("ACTIVE") @db.VarChar(50)
  externalId                String?                    @db.VarChar(255)
  sourceSystem              String?                    @db.VarChar(100)
  customFields              Json                       @default("{}")
  createdAt                 DateTime                   @default(now())
  updatedAt                 DateTime @updatedAt
  deletedAt                 DateTime?
  createdById               String?
  updatedById               String?
  APIRequestLog             APIRequestLog[]
  CircuitBreakerStateRecord CircuitBreakerStateRecord?
  tenant                    Tenant                     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  SyncJob                   SyncJob[]
  WebhookDelivery           WebhookDelivery[]

  @@index([category])
  @@index([externalId, sourceSystem])
  @@index([provider])
  @@index([status])
  @@index([tenantId, category])
  @@index([tenantId, deletedAt])
  @@index([tenantId])
  @@index([tenantId, status])
}

model IntegrationProviderConfig {
  id               String    @id @default(uuid())
  tenantId         String
  providerName     String    @db.VarChar(255)
  category         String    @db.VarChar(100)
  authType         String    @db.VarChar(50)
  baseUrl          String?   @db.VarChar(500)
  documentationUrl String?   @db.VarChar(500)
  logoUrl          String?   @db.VarChar(500)
  isActive         Boolean   @default(true)
  externalId       String?   @db.VarChar(255)
  sourceSystem     String?   @db.VarChar(100)
  customFields     Json      @default("{}")
  createdAt        DateTime  @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  createdById      String?
  updatedById      String?
  tenant           Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([tenantId])
}

model Invoice {
  id                                                      String               @id @default(uuid())
  tenantId                                                String
  invoiceNumber                                           String               @db.VarChar(50)
  companyId                                               String
  orderId                                                 String?
  loadId                                                  String?
  externalId                                              String?              @db.VarChar(255)
  sourceSystem                                            String?              @db.VarChar(100)
  quickbooksId                                            String?              @db.VarChar(50)
  invoiceDate                                             DateTime
  dueDate                                                 DateTime
  sentAt                                                  DateTime?
  subtotal                                                Decimal              @db.Decimal(12, 2)
  taxAmount                                               Decimal              @default(0) @db.Decimal(12, 2)
  totalAmount                                             Decimal              @db.Decimal(12, 2)
  amountPaid                                              Decimal              @default(0) @db.Decimal(12, 2)
  balanceDue                                              Decimal              @db.Decimal(12, 2)
  currency                                                String               @default("USD") @db.VarChar(3)
  status                                                  String               @default("DRAFT") @db.VarChar(50)
  paymentTerms                                            String?              @db.VarChar(50)
  notes                                                   String?
  internalNotes                                           String?
  daysOutstanding                                         Int?
  agingBucket                                             String?              @db.VarChar(20)
  lastReminderDate                                        DateTime?
  reminderCount                                           Int                  @default(0)
  collectionStatus                                        String?              @db.VarChar(50)
  revenueAccountId                                        String?
  arAccountId                                             String?
  createdAt                                               DateTime             @default(now())
  updatedAt                                               DateTime @updatedAt
  createdById                                             String?
  updatedById                                             String?
  voidedAt                                                DateTime?
  voidedById                                              String?
  voidReason                                              String?
  customFields                                            Json                 @default("{}")
  commissions                                         AgentCommission[]
  CollectionActivity                                      CollectionActivity[]
  ChartOfAccount_Invoice_arAccountIdToChartOfAccount      ChartOfAccount?      @relation("Invoice_arAccountIdToChartOfAccount", fields: [arAccountId], references: [id])
  company             Company?           @relation(fields: [companyId], references: [id])
  load                                                    Load?              @relation(fields: [loadId], references: [id])
  order               Order?             @relation(fields: [orderId], references: [id])
  ChartOfAccount_Invoice_revenueAccountIdToChartOfAccount ChartOfAccount?      @relation("Invoice_revenueAccountIdToChartOfAccount", fields: [revenueAccountId], references: [id])
  tenant                                                  Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  lineItems                                         InvoiceLineItem[]
  applications                                      PaymentApplication[]

  @@unique([tenantId, invoiceNumber])
  @@index([companyId])
  @@index([createdAt])
  @@index([dueDate])
  @@index([externalId, sourceSystem])
  @@index([invoiceDate])
  @@index([loadId])
  @@index([orderId])
  @@index([status])
  @@index([tenantId, companyId])
  @@index([tenantId, dueDate])
  @@index([tenantId])
  @@index([tenantId, status, dueDate])
  @@index([tenantId, status])
}

model InvoiceLineItem {
  id               String          @id @default(uuid())
  invoiceId        String
  loadId           String?
  orderId          String?
  lineNumber       Int
  description      String          @db.VarChar(500)
  itemType         String?         @db.VarChar(50)
  quantity         Decimal         @default(1) @db.Decimal(10, 2)
  unitPrice        Decimal         @db.Decimal(12, 2)
  amount           Decimal         @db.Decimal(12, 2)
  revenueAccountId String?
  createdAt        DateTime        @default(now())
  createdById      String?
  customFields     Json            @default("{}")
  deletedAt        DateTime?
  externalId       String?         @db.VarChar(255)
  sourceSystem     String?         @db.VarChar(100)
  tenantId         String
  updatedAt        DateTime @updatedAt
  updatedById      String?
  invoice          Invoice         @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  load             Load?              @relation(fields: [loadId], references: [id])
  order               Order?             @relation(fields: [orderId], references: [id])
  parentAccount   ChartOfAccount?     @relation(fields: [revenueAccountId], references: [id])
  tenant           Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([invoiceId, lineNumber])
  @@index([externalId, sourceSystem])
  @@index([invoiceId])
  @@index([loadId])
  @@index([orderId])
  @@index([tenantId])
}

model JobAlert {
  id                   String       @id @default(uuid())
  jobId                String
  alertType            String       @db.VarChar(50)
  thresholdValue       Int?
  notificationChannels Json
  recipients           Json
  isEnabled            Boolean      @default(true)
  createdAt            DateTime     @default(now())
  scheduledJob         ScheduledJob @relation(fields: [jobId], references: [id], onDelete: Cascade)
}

model JobDependency {
  id                                                      String       @id @default(uuid())
  jobId                                                   String
  dependsOnJobId                                          String
  dependencyType                                          String       @default("SUCCESS") @db.VarChar(20)
  createdAt                                               DateTime     @default(now())
  ScheduledJob_JobDependency_dependsOnJobIdToScheduledJob ScheduledJob @relation("JobDependency_dependsOnJobIdToScheduledJob", fields: [dependsOnJobId], references: [id], onDelete: Cascade)
  ScheduledJob_JobDependency_jobIdToScheduledJob          ScheduledJob @relation("JobDependency_jobIdToScheduledJob", fields: [jobId], references: [id], onDelete: Cascade)

  @@unique([jobId, dependsOnJobId])
}

model JobExecution {
  id              String             @id @default(uuid())
  jobId           String
  status          JobExecutionStatus @default(PENDING)
  startedAt       DateTime?
  completedAt     DateTime?
  result          Json?
  errorMessage    String?
  externalId      String?            @db.VarChar(255)
  sourceSystem    String?            @db.VarChar(100)
  customFields    Json               @default("{}")
  createdAt       DateTime           @default(now())
  updatedAt       DateTime @updatedAt
  deletedAt       DateTime?
  createdById     String?
  updatedById     String?
  attemptNumber   Int                @default(1)
  durationMs      Int?
  executionNumber Int                @default(1)
  parameters      Json?
  progressMessage String?
  progressPercent Int                @default(0)
  retryOf         String?
  scheduledAt     DateTime?
  tenantId        String?
  willRetry       Boolean            @default(false)
  workerHostname  String?            @db.VarChar(255)
  workerId        String?            @db.VarChar(100)
  scheduledJob    ScheduledJob       @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([jobId, createdAt])
  @@index([retryOf])
  @@index([status, scheduledAt])
  @@index([tenantId, createdAt])
}

model JobLock {
  id            String       @id @default(uuid())
  jobId         String       @unique
  tenantId      String?
  workerId      String       @db.VarChar(100)
  lockedAt      DateTime
  expiresAt     DateTime
  lastHeartbeat DateTime?
  scheduledJob  ScheduledJob @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
}

model JobTemplate {
  id                   String   @id @default(uuid())
  code                 String   @unique @db.VarChar(100)
  name                 String
  description          String?
  category             String?  @db.VarChar(100)
  handler              String
  defaultSchedule      String?
  defaultParameters    Json     @default("{}")
  isSystemRequired     Boolean  @default(false)
  isTenantConfigurable Boolean  @default(true)
  createdAt            DateTime @default(now())
}

model JournalEntry {
  id               String             @id @default(uuid())
  tenantId         String
  entryNumber      String             @db.VarChar(50)
  externalId       String?            @db.VarChar(255)
  sourceSystem     String?            @db.VarChar(100)
  quickbooksId     String?            @db.VarChar(50)
  entryDate        DateTime
  description      String?
  referenceType    String?            @db.VarChar(50)
  referenceId      String?
  status           String             @default("DRAFT") @db.VarChar(50)
  totalDebit       Decimal            @db.Decimal(14, 2)
  totalCredit      Decimal            @db.Decimal(14, 2)
  postedById       String?
  postedAt         DateTime?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime @updatedAt
  createdById      String?
  tenant           Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  lines JournalEntryLine[]

  @@unique([tenantId, entryNumber])
  @@index([entryDate])
  @@index([referenceType, referenceId])
  @@index([status])
  @@index([tenantId])
}

model JournalEntryLine {
  id             String         @id @default(uuid())
  journalEntryId String
  lineNumber     Int
  accountId      String
  description    String?        @db.VarChar(255)
  debitAmount    Decimal        @default(0) @db.Decimal(14, 2)
  creditAmount   Decimal        @default(0) @db.Decimal(14, 2)
  customerId     String?
  carrierId      String?
  loadId         String?
  createdAt      DateTime       @default(now())
  createdById    String?
  customFields   Json           @default("{}")
  deletedAt      DateTime?
  externalId     String?        @db.VarChar(255)
  sourceSystem   String?        @db.VarChar(100)
  tenantId       String
  updatedAt      DateTime @updatedAt
  updatedById    String?
  account        ChartOfAccount?     @relation(fields: [accountId], references: [id])
  journalEntry   JournalEntry   @relation(fields: [journalEntryId], references: [id], onDelete: Cascade)
  tenant         Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([journalEntryId, lineNumber])
  @@index([accountId])
  @@index([externalId, sourceSystem])
  @@index([journalEntryId])
  @@index([tenantId])
}

model KBArticle {
  id             String    @id @default(uuid())
  tenantId       String
  title          String    @db.VarChar(500)
  content        String
  summary        String?   @db.VarChar(1000)
  categoryId     String?
  slug           String    @db.VarChar(500)
  keywords       String?
  isPublished    Boolean   @default(false)
  publishedAt    DateTime?
  viewCount      Int       @default(0)
  helpfulCount   Int       @default(0)
  unhelpfulCount Int       @default(0)
  externalId     String?   @db.VarChar(255)
  sourceSystem   String?   @db.VarChar(100)
  customFields   Json      @default("{}")
  createdAt      DateTime  @default(now())
  updatedAt      DateTime @updatedAt
  deletedAt      DateTime?
  createdById    String?
  updatedById    String?
  tenant         Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, slug])
  @@index([categoryId])
  @@index([externalId, sourceSystem])
  @@index([isPublished])
  @@index([tenantId])
}

model KPIAlert {
  id              String         @id @default(uuid())
  tenantId        String
  kpiDefinitionId String
  alertName       String         @db.VarChar(255)
  alertCondition  AlertCondition
  thresholdValue  Decimal        @db.Decimal(15, 2)
  notifyUsers     Json           @default("[]")
  isActive        Boolean        @default(true)
  lastTriggeredAt DateTime?
  externalId      String?        @db.VarChar(255)
  sourceSystem    String?        @db.VarChar(100)
  customFields    Json           @default("{}")
  createdAt       DateTime       @default(now())
  updatedAt       DateTime @updatedAt
  deletedAt       DateTime?
  createdById     String?
  updatedById     String?
  kpiDefinition   KPIDefinition  @relation(fields: [kpiDefinitionId], references: [id], onDelete: Cascade)
  tenant          Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([kpiDefinitionId])
  @@index([lastTriggeredAt])
  @@index([tenantId])
}

model KPIDefinition {
  id              String            @id @default(uuid())
  tenantId        String
  code            String            @unique @db.VarChar(100)
  name            String            @db.VarChar(255)
  description     String?
  category        KPICategory
  aggregationType AggregationType
  sourceQuery     String
  unit            String?           @db.VarChar(50)
  format          String?           @db.VarChar(50)
  targetValue     Decimal?          @db.Decimal(14, 4)
  warningValue    Decimal?          @db.Decimal(14, 4)
  criticalValue   Decimal?          @db.Decimal(14, 4)
  status          String            @default("ACTIVE") @db.VarChar(50)
  externalId      String?           @db.VarChar(255)
  sourceSystem    String?           @db.VarChar(100)
  customFields    Json              @default("{}")
  createdAt       DateTime          @default(now())
  updatedAt       DateTime @updatedAt
  deletedAt       DateTime?
  createdById     String?
  updatedById     String?
  dashboardWidgets DashboardWidget[]
  KPIAlert        KPIAlert[]
  tenant          Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  KPISnapshot     KPISnapshot[]

  @@unique([tenantId, code])
  @@index([category])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId])
}

model KPISnapshot {
  id              String          @id @default(uuid())
  tenantId        String
  kpiDefinitionId String
  snapshotDate    DateTime        @db.Date
  value           Decimal         @db.Decimal(15, 2)
  comparisonValue Decimal?        @db.Decimal(15, 2)
  trendDirection  TrendDirection?
  metadata        Json            @default("{}")
  externalId      String?         @db.VarChar(255)
  sourceSystem    String?         @db.VarChar(100)
  customFields    Json            @default("{}")
  createdAt       DateTime        @default(now())
  updatedAt       DateTime @updatedAt
  deletedAt       DateTime?
  createdById     String?
  updatedById     String?
  kpiDefinition   KPIDefinition   @relation(fields: [kpiDefinitionId], references: [id], onDelete: Cascade)
  tenant          Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([kpiDefinitionId])
  @@index([snapshotDate])
  @@index([tenantId])
}

model LaneAnalytics {
  id               String    @id @default(uuid())
  tenantId         String
  originState      String    @db.VarChar(2)
  destState        String    @db.VarChar(2)
  equipmentType    String    @db.VarChar(50)
  totalLoads       Int       @default(0)
  avgRate          Decimal   @db.Decimal(10, 2)
  avgMargin        Decimal   @db.Decimal(5, 2)
  avgTransitDays   Decimal   @db.Decimal(4, 1)
  onTimePercent    Decimal   @db.Decimal(5, 2)
  datAvgRate       Decimal?  @db.Decimal(10, 2)
  truckstopAvgRate Decimal?  @db.Decimal(10, 2)
  vsMarketPercent  Decimal?  @db.Decimal(5, 2)
  periodType       String    @db.VarChar(20)
  periodStart      DateTime  @db.Date
  periodEnd        DateTime  @db.Date
  externalId       String?   @db.VarChar(255)
  sourceSystem     String?   @db.VarChar(100)
  customFields     Json      @default("{}")
  createdAt        DateTime  @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  createdById      String?
  updatedById      String?
  tenant           Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, originState, destState, equipmentType, periodType, periodStart])
  @@index([destState])
  @@index([equipmentType])
  @@index([externalId, sourceSystem])
  @@index([originState])
  @@index([periodStart])
  @@index([periodType])
  @@index([tenantId])
}

model Load {
  id                       String                     @id @default(uuid())
  tenantId                 String
  loadNumber               String                     @db.VarChar(50)
  orderId                  String
  carrierId                String?
  driverName               String?                    @db.VarChar(100)
  driverPhone              String?                    @db.VarChar(20)
  truckNumber              String?                    @db.VarChar(20)
  trailerNumber            String?                    @db.VarChar(20)
  status                   String                     @default("PENDING") @db.VarChar(30)
  carrierRate              Decimal?                   @db.Decimal(10, 2)
  accessorialCosts         Decimal                    @default(0) @db.Decimal(10, 2)
  fuelAdvance              Decimal                    @default(0) @db.Decimal(10, 2)
  totalCost                Decimal?                   @db.Decimal(10, 2)
  currentLocationLat       Decimal?                   @db.Decimal(10, 7)
  currentLocationLng       Decimal?                   @db.Decimal(10, 7)
  currentCity              String?                    @db.VarChar(100)
  currentState             String?                    @db.VarChar(50)
  lastTrackingUpdate       DateTime?
  eta                      DateTime?
  equipmentType            String?                    @db.VarChar(30)
  equipmentLength          Int?
  equipmentWeightLimit     Int?
  dispatchedAt             DateTime?
  pickedUpAt               DateTime?
  deliveredAt              DateTime?
  rateConfirmationSent     Boolean                    @default(false)
  rateConfirmationSigned   Boolean                    @default(false)
  dispatchNotes            String?
  externalId               String?                    @db.VarChar(255)
  sourceSystem             String?                    @db.VarChar(100)
  customFields             Json                       @default("{}")
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime @updatedAt
  createdById              String?
  updatedById              String?
  deletedAt                DateTime?
  commissions          AgentCommission[]
  CarrierInvoiceSubmission CarrierInvoiceSubmission[]
  CarrierPortalDocument    CarrierPortalDocument[]
  CarrierQuickPayRequest   CarrierQuickPayRequest[]
  CarrierSavedLoad         CarrierSavedLoad[]
  checkCalls               CheckCall[]
  Claim                    Claim[]
  CommissionEntry          CommissionEntry[]
  documents Document[]
  Invoice                  Invoice[]
  lineItems          InvoiceLineItem[]
  carrier             Carrier?           @relation(fields: [carrierId], references: [id])
  order               Order?             @relation(fields: [orderId], references: [id], onDelete: Cascade)
  tenant                   Tenant                     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  LoadBid                  LoadBid[]
  LoadPost                 LoadPost[]
  LoadPosting              LoadPosting[]
  LoadTender               LoadTender[]
  SafetyIncident           SafetyIncident[]
  settlementLineItems       SettlementLineItem[]
  StatusHistory            StatusHistory[]
  stops               Stop[]

  @@unique([tenantId, loadNumber])
  @@index([carrierId])
  @@index([createdAt])
  @@index([externalId, sourceSystem])
  @@index([orderId])
  @@index([status])
  @@index([tenantId, carrierId])
  @@index([tenantId, deletedAt])
  @@index([tenantId])
  @@index([tenantId, status])
}

model LoadBid {
  id              String      @id @default(uuid())
  tenantId        String
  postingId       String
  loadId          String
  carrierId       String
  bidAmount       Decimal     @db.Decimal(12, 2)
  rateType        String?     @db.VarChar(50)
  notes           String?
  truckNumber     String?     @db.VarChar(50)
  driverName      String?     @db.VarChar(255)
  driverPhone     String?     @db.VarChar(50)
  status          String      @default("PENDING") @db.VarChar(50)
  counterAmount   Decimal?    @db.Decimal(12, 2)
  counterNotes    String?
  counterAt       DateTime?
  acceptedAt      DateTime?
  rejectedAt      DateTime?
  rejectionReason String?
  submittedAt     DateTime    @default(now())
  expiresAt       DateTime?
  source          String?     @db.VarChar(50)
  createdAt       DateTime    @default(now())
  updatedAt       DateTime @updatedAt
  createdById     String?
  customFields    Json        @default("{}")
  deletedAt       DateTime?
  externalId      String?     @db.VarChar(255)
  sourceSystem    String?     @db.VarChar(100)
  updatedById     String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  load            Load?              @relation(fields: [loadId], references: [id], onDelete: Cascade)
  posting     LoadPosting @relation(fields: [postingId], references: [id], onDelete: Cascade)
  tenant          Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([carrierId])
  @@index([carrierId, status])
  @@index([externalId, sourceSystem])
  @@index([postingId])
  @@index([postingId, status])
  @@index([status])
  @@index([tenantId, deletedAt])
  @@index([tenantId])
  @@index([tenantId, status])
}

model LoadBoardAccount {
  id                String            @id @default(uuid())
  tenantId          String
  providerId        String
  accountName       String            @db.VarChar(255)
  accountNumber     String?           @db.VarChar(100)
  accountUsername   String?           @db.VarChar(255)
  accountPassword   String?           @db.VarChar(500)
  accountApiKey     String?           @db.VarChar(500)
  isActive          Boolean           @default(true)
  isVerified        Boolean           @default(false)
  lastVerifiedAt    DateTime?
  postsThisMonth    Int               @default(0)
  totalPosts        Int               @default(0)
  externalId        String?           @db.VarChar(255)
  sourceSystem      String?           @db.VarChar(100)
  customFields      Json              @default("{}")
  createdAt         DateTime          @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  provider LoadBoardProvider @relation(fields: [providerId], references: [id], onDelete: Cascade)
  tenant            Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  posts          LoadPost[]

  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([providerId])
  @@index([tenantId])
}

model LoadBoardProvider {
  id               String                @id @default(uuid())
  tenantId         String
  providerType     LoadBoardProviderType @unique
  apiKey           String?               @db.VarChar(500)
  apiSecret        String?               @db.VarChar(500)
  apiEndpoint      String?               @db.VarChar(500)
  username         String?               @db.VarChar(255)
  password         String?               @db.VarChar(500)
  isActive         Boolean               @default(true)
  autoPost         Boolean               @default(false)
  postingRules     Json?
  postsPerDay      Int?
  postsThisMonth   Int                   @default(0)
  lastPostAt       DateTime?
  totalPosts       Int                   @default(0)
  externalId       String?               @db.VarChar(255)
  sourceSystem     String?               @db.VarChar(100)
  customFields     Json                  @default("{}")
  createdAt        DateTime              @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  createdById      String?
  updatedById      String?
  LoadBoardAccount LoadBoardAccount[]
  tenant           Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([providerType])
  @@index([tenantId])
}

model LoadHistory {
  id                       String                   @id @default(uuid())
  tenantId                 String
  loadPlannerQuoteId       String?
  inlandQuoteId            String?
  quoteNumber              String?                  @db.VarChar(50)
  customerName             String?                  @db.VarChar(255)
  customerCompany          String?                  @db.VarChar(255)
  carrierId                String?
  driverId                 String?
  truckId                  String?
  originCity               String?                  @db.VarChar(100)
  originState              String?                  @db.VarChar(2)
  originZip                String?                  @db.VarChar(10)
  destinationCity          String?                  @db.VarChar(100)
  destinationState         String?                  @db.VarChar(2)
  destinationZip           String?                  @db.VarChar(10)
  totalMiles               Decimal?                 @db.Decimal(8, 2)
  cargoDescription         String?
  pieces                   Int?
  totalLengthIn            Decimal?                 @db.Decimal(8, 2)
  totalWidthIn             Decimal?                 @db.Decimal(8, 2)
  totalHeightIn            Decimal?                 @db.Decimal(8, 2)
  totalWeightLbs           Decimal?                 @db.Decimal(10, 2)
  isOversize               Boolean                  @default(false)
  isOverweight             Boolean                  @default(false)
  equipmentTypeUsed        String?                  @db.VarChar(100)
  customerRateCents        Int
  carrierRateCents         Int
  marginCents              Int                      @default(0)
  marginPercentage         Decimal                  @default(0) @db.Decimal(5, 2)
  ratePerMileCustomerCents Int                      @default(0)
  ratePerMileCarrierCents  Int                      @default(0)
  quoteDate                DateTime?                @db.Date
  bookedDate               DateTime?                @db.Date
  pickupDate               DateTime?                @db.Date
  deliveryDate             DateTime?                @db.Date
  invoiceDate              DateTime?                @db.Date
  paidDate                 DateTime?                @db.Date
  status                   String                   @default("BOOKED") @db.VarChar(50)
  notes                    String?
  isActive                 Boolean                  @default(true)
  externalId               String?                  @db.VarChar(255)
  sourceSystem             String?                  @db.VarChar(100)
  customFields             Json                     @default("{}")
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime @updatedAt
  deletedAt                DateTime?
  createdById              String?
  updatedById              String?
  carrier                  OperationsCarrier?       @relation(fields: [carrierId], references: [id])
  driver                   OperationsCarrierDriver? @relation(fields: [driverId], references: [id])
  loadPlannerQuote         LoadPlannerQuote?        @relation(fields: [loadPlannerQuoteId], references: [id])
  tenant                   Tenant                   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  truck                    OperationsCarrierTruck?  @relation(fields: [truckId], references: [id])

  @@index([carrierId])
  @@index([deliveryDate])
  @@index([driverId])
  @@index([isActive])
  @@index([loadPlannerQuoteId])
  @@index([originState, destinationState])
  @@index([pickupDate])
  @@index([quoteNumber])
  @@index([status])
  @@index([tenantId])
  @@index([truckId])
}

model LoadPlannerAccessorial {
  id                String           @id @default(uuid())
  quoteId           String
  accessorialTypeId String           @db.VarChar(100)
  name              String           @db.VarChar(255)
  billingUnit       String           @db.VarChar(50)
  rateCents         Int
  quantity          Decimal          @default(1) @db.Decimal(10, 2)
  totalCents        Int
  notes             String?
  sortOrder         Int              @default(0)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  LoadPlannerQuote  LoadPlannerQuote @relation(fields: [quoteId], references: [id], onDelete: Cascade)

  @@unique([quoteId, sortOrder])
  @@index([accessorialTypeId])
  @@index([quoteId])
}

model LoadPlannerCargoItem {
  id                 String           @id @default(uuid())
  quoteId            String
  description        String           @db.VarChar(500)
  sku                String?          @db.VarChar(100)
  quantity           Int              @default(1)
  lengthIn           Decimal          @db.Decimal(8, 2)
  widthIn            Decimal          @db.Decimal(8, 2)
  heightIn           Decimal          @db.Decimal(8, 2)
  weightLbs          Decimal          @db.Decimal(10, 2)
  stackable          Boolean          @default(false)
  bottomOnly         Boolean          @default(false)
  maxLayers          Int?
  fragile            Boolean          @default(false)
  hazmat             Boolean          @default(false)
  orientation        String?          @db.VarChar(20)
  geometryType       String?          @db.VarChar(50)
  geometryData       Json?
  equipmentMakeId    String?          @db.VarChar(100)
  equipmentModelId   String?          @db.VarChar(100)
  dimensionsSource   String?          @db.VarChar(50)
  imageUrl1          String?          @db.VarChar(500)
  imageUrl2          String?          @db.VarChar(500)
  imageUrl3          String?          @db.VarChar(500)
  imageUrl4          String?          @db.VarChar(500)
  assignedTruckIndex Int?
  placementX         Decimal?         @db.Decimal(8, 2)
  placementY         Decimal?         @db.Decimal(8, 2)
  placementZ         Decimal?         @db.Decimal(8, 2)
  rotation           Decimal?         @db.Decimal(5, 2)
  sortOrder          Int              @default(0)
  createdAt          DateTime         @default(now())
  updatedAt          DateTime @updatedAt
  deletedAt          DateTime?
  LoadPlannerQuote   LoadPlannerQuote @relation(fields: [quoteId], references: [id], onDelete: Cascade)

  @@unique([quoteId, sortOrder])
  @@index([assignedTruckIndex])
  @@index([quoteId])
}

model LoadPlannerPermit {
  id                          String           @id @default(uuid())
  quoteId                     String
  stateCode                   String           @db.VarChar(2)
  stateName                   String           @db.VarChar(100)
  calculatedPermitFeeCents    Int
  calculatedEscortFeeCents    Int
  calculatedPoleCarFeeCents   Int
  calculatedSuperLoadFeeCents Int
  calculatedTotalCents        Int
  permitFeeCents              Int?
  escortFeeCents              Int?
  poleCarFeeCents             Int?
  superLoadFeeCents           Int?
  totalCents                  Int?
  distanceMiles               Decimal          @db.Decimal(8, 2)
  escortCount                 Int              @default(0)
  poleCarRequired             Boolean          @default(false)
  createdAt                   DateTime         @default(now())
  updatedAt                   DateTime @updatedAt
  deletedAt                   DateTime?
  LoadPlannerQuote            LoadPlannerQuote @relation(fields: [quoteId], references: [id], onDelete: Cascade)

  @@unique([quoteId, stateCode])
  @@index([quoteId])
  @@index([stateCode])
}

model LoadPlannerQuote {
  id                     String                   @id @default(uuid())
  tenantId               String
  quoteNumber            String                   @unique @db.VarChar(50)
  publicToken            String                   @unique
  status                 String                   @default("DRAFT") @db.VarChar(20)
  isActive               Boolean                  @default(true)
  customerName           String                   @db.VarChar(255)
  customerEmail          String?                  @db.VarChar(255)
  customerPhone          String?                  @db.VarChar(20)
  customerCompany        String?                  @db.VarChar(255)
  pickupAddress          String                   @db.VarChar(500)
  pickupCity             String                   @db.VarChar(100)
  pickupState            String                   @db.VarChar(2)
  pickupZip              String                   @db.VarChar(10)
  pickupLat              Decimal                  @db.Decimal(10, 8)
  pickupLng              Decimal                  @db.Decimal(11, 8)
  dropoffAddress         String                   @db.VarChar(500)
  dropoffCity            String                   @db.VarChar(100)
  dropoffState           String                   @db.VarChar(2)
  dropoffZip             String                   @db.VarChar(10)
  dropoffLat             Decimal                  @db.Decimal(10, 8)
  dropoffLng             Decimal                  @db.Decimal(11, 8)
  distanceMiles          Decimal                  @db.Decimal(8, 2)
  durationMinutes        Int
  routePolyline          String?
  subtotalCents          Int                      @default(0)
  totalCents             Int                      @default(0)
  sentAt                 DateTime?
  viewedAt               DateTime?
  expiresAt              DateTime?
  externalId             String?                  @db.VarChar(255)
  sourceSystem           String?                  @db.VarChar(100)
  customFields           Json                     @default("{}")
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime @updatedAt
  deletedAt              DateTime?
  createdById            String?
  updatedById            String?
  loadHistory            LoadHistory[]
  accessorials           LoadPlannerAccessorial[]
  cargoItems             LoadPlannerCargoItem[]
  permits                LoadPlannerPermit[]
  tenant                 Tenant                   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  serviceItems           LoadPlannerServiceItem[]
  trucks                 LoadPlannerTruck[]

  @@index([createdAt])
  @@index([dropoffState])
  @@index([isActive])
  @@index([pickupState])
  @@index([publicToken])
  @@index([quoteNumber])
  @@index([status])
  @@index([tenantId])
}

model LoadPlannerServiceItem {
  id               String           @id @default(uuid())
  quoteId          String
  serviceTypeId    String           @db.VarChar(100)
  name             String           @db.VarChar(255)
  rateCents        Int
  quantity         Decimal          @default(1) @db.Decimal(10, 2)
  totalCents       Int
  truckIndex       Int?
  sortOrder        Int              @default(0)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  quote            LoadPlannerQuote @relation(fields: [quoteId], references: [id], onDelete: Cascade)

  @@unique([quoteId, sortOrder])
  @@index([quoteId])
  @@index([serviceTypeId])
}

model LoadPlannerTruck {
  id                String           @id @default(uuid())
  quoteId           String
  truckIndex        Int              @default(0)
  truckTypeId       String?
  truckName         String           @db.VarChar(100)
  truckCategory     String           @db.VarChar(50)
  deckLengthFt      Decimal          @db.Decimal(5, 2)
  deckWidthFt       Decimal          @db.Decimal(5, 2)
  deckHeightFt      Decimal          @db.Decimal(5, 2)
  wellLengthFt      Decimal          @default(0) @db.Decimal(5, 2)
  maxCargoWeightLbs Int
  totalWeightLbs    Decimal          @default(0) @db.Decimal(10, 2)
  totalItems        Int              @default(0)
  isLegal           Boolean          @default(true)
  permitsRequired   Json             @default("[]")
  warnings          Json             @default("[]")
  truckScore        Int              @default(100)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  quote             LoadPlannerQuote @relation(fields: [quoteId], references: [id], onDelete: Cascade)
  truckType         TruckType?       @relation(fields: [truckTypeId], references: [id])

  @@unique([quoteId, truckIndex])
  @@index([quoteId])
  @@index([truckTypeId])
}

model LoadPost {
  id               String           @id @default(uuid())
  tenantId         String
  accountId        String
  loadId           String?
  orderId          String?
  postNumber       String           @unique @db.VarChar(50)
  externalPostId   String?          @db.VarChar(100)
  status           LoadPostStatus   @default(DRAFT)
  originCity       String           @db.VarChar(100)
  originState      String           @db.VarChar(2)
  originZip        String?          @db.VarChar(10)
  destCity         String           @db.VarChar(100)
  destState        String           @db.VarChar(2)
  destZip          String?          @db.VarChar(10)
  pickupDate       DateTime         @db.Date
  deliveryDate     DateTime?        @db.Date
  equipmentType    String           @db.VarChar(50)
  length           Int?
  weight           Int?
  commodity        String?          @db.VarChar(255)
  postedRate       Decimal          @db.Decimal(10, 2)
  currency         String           @default("USD") @db.VarChar(3)
  contactName      String?          @db.VarChar(255)
  contactPhone     String?          @db.VarChar(20)
  contactEmail     String?          @db.VarChar(255)
  postedAt         DateTime?
  expiresAt        DateTime?
  removedAt        DateTime?
  views            Int              @default(0)
  clicks           Int              @default(0)
  leadCount        Int              @default(0)
  externalId       String?          @db.VarChar(255)
  sourceSystem     String?          @db.VarChar(100)
  customFields     Json             @default("{}")
  createdAt        DateTime         @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  createdById      String?
  updatedById      String?
  account LoadBoardAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)
  load             Load?              @relation(fields: [loadId], references: [id])
  order               Order?             @relation(fields: [orderId], references: [id])
  tenant           Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  leads         PostLead[]
  RateData         RateData[]

  @@index([accountId])
  @@index([destState])
  @@index([externalId, sourceSystem])
  @@index([loadId])
  @@index([orderId])
  @@index([originState])
  @@index([pickupDate])
  @@index([postNumber])
  @@index([postedAt])
  @@index([status])
  @@index([tenantId])
}

model LoadPosting {
  id                 String            @id @default(uuid())
  tenantId           String
  loadId             String
  postingType        String            @db.VarChar(50)
  visibility         String            @default("ALL_CARRIERS") @db.VarChar(50)
  status             String            @default("ACTIVE") @db.VarChar(50)
  showRate           Boolean           @default(false)
  rateType           String?           @db.VarChar(50)
  postedRate         Decimal?          @db.Decimal(12, 2)
  rateMin            Decimal?          @db.Decimal(12, 2)
  rateMax            Decimal?          @db.Decimal(12, 2)
  originCity         String?           @db.VarChar(100)
  originState        String?           @db.VarChar(50)
  originZip          String?           @db.VarChar(20)
  originLat          Decimal?          @db.Decimal(10, 7)
  originLng          Decimal?          @db.Decimal(10, 7)
  destCity           String?           @db.VarChar(100)
  destState          String?           @db.VarChar(50)
  destZip            String?           @db.VarChar(20)
  destLat            Decimal?          @db.Decimal(10, 7)
  destLng            Decimal?          @db.Decimal(10, 7)
  equipmentType      String?           @db.VarChar(50)
  totalMiles         Decimal?          @db.Decimal(10, 2)
  weightLbs          Decimal?          @db.Decimal(10, 2)
  pickupDate         DateTime?
  deliveryDate       DateTime?
  datPostingId       String?           @db.VarChar(100)
  truckstopPostingId String?           @db.VarChar(100)
  postedAt           DateTime          @default(now())
  expiresAt          DateTime?
  autoRefresh        Boolean           @default(true)
  refreshInterval    Int               @default(4)
  lastRefreshedAt    DateTime?
  viewCount          Int               @default(0)
  inquiryCount       Int               @default(0)
  carrierIds         String[]
  createdById        String?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime @updatedAt
  customFields       Json              @default("{}")
  deletedAt          DateTime?
  externalId         String?           @db.VarChar(255)
  sourceSystem       String?           @db.VarChar(100)
  updatedById        String?
  views    CarrierLoadView[]
  bids            LoadBid[]
  load               Load?              @relation(fields: [loadId], references: [id], onDelete: Cascade)
  tenant             Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([destState, destCity])
  @@index([equipmentType])
  @@index([externalId, sourceSystem])
  @@index([loadId])
  @@index([originState, destState])
  @@index([originState, originCity])
  @@index([pickupDate])
  @@index([status, expiresAt])
  @@index([status])
  @@index([status, originState, expiresAt])
  @@index([tenantId, deletedAt])
  @@index([tenantId])
  @@index([tenantId, status])
}

model LoadTender {
  id                      String            @id @default(uuid())
  tenantId                String
  loadId                  String
  tenderType              String            @db.VarChar(50)
  tenderRate              Decimal           @db.Decimal(12, 2)
  status                  String            @default("ACTIVE") @db.VarChar(50)
  createdAt               DateTime          @default(now())
  expiresAt               DateTime?
  waterfallTimeoutMinutes Int               @default(30)
  currentPosition         Int               @default(0)
  acceptedByCarrierId     String?
  acceptedAt              DateTime?
  createdById             String?
  customFields            Json              @default("{}")
  deletedAt               DateTime?
  externalId              String?           @db.VarChar(255)
  sourceSystem            String?           @db.VarChar(100)
  updatedAt               DateTime @updatedAt
  updatedById             String?
  carrier             Carrier?           @relation(fields: [acceptedByCarrierId], references: [id])
  load                    Load?              @relation(fields: [loadId], references: [id], onDelete: Cascade)
  tenant                  Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  recipients         TenderRecipient[]

  @@index([externalId, sourceSystem])
  @@index([loadId])
  @@index([status])
  @@index([tenantId])
  @@index([tenantId, status])
}

model Location {
  id             String          @id @default(uuid())
  tenantId       String
  locationCode   String          @unique @db.VarChar(50)
  name           String          @db.VarChar(255)
  address        String?         @db.VarChar(255)
  city           String?         @db.VarChar(100)
  state          String?         @db.VarChar(2)
  zip            String?         @db.VarChar(10)
  country        String?         @default("US") @db.VarChar(2)
  phone          String?         @db.VarChar(20)
  isHeadquarters Boolean         @default(false)
  timezone       String?         @db.VarChar(50)
  externalId     String?         @db.VarChar(255)
  sourceSystem   String?         @db.VarChar(100)
  customFields   Json            @default("{}")
  createdAt      DateTime        @default(now())
  updatedAt      DateTime @updatedAt
  deletedAt      DateTime?
  createdById    String?
  updatedById    String?
  BusinessHours  BusinessHours[]
  Employee       Employee[]
  tenant         Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  TimeEntry      TimeEntry[]

  @@index([externalId, sourceSystem])
  @@index([isHeadquarters])
  @@index([locationCode])
  @@index([tenantId, city, state])
  @@index([tenantId, deletedAt])
  @@index([tenantId])
  @@index([tenantId, zip])
}

model LoginAudit {
  id            String      @id @default(uuid())
  tenantId      String?
  userId        String?
  email         String      @db.VarChar(255)
  loginMethod   LoginMethod
  success       Boolean
  failureReason String?
  ipAddress     String?     @db.VarChar(45)
  userAgent     String?
  mfaUsed       Boolean     @default(false)
  sessionId     String?     @db.VarChar(255)
  timestamp     DateTime    @default(now())
  Tenant        Tenant?     @relation(fields: [tenantId], references: [id])
  user                User?              @relation(fields: [userId], references: [id])

  @@index([email])
  @@index([success])
  @@index([tenantId])
  @@index([timestamp])
  @@index([userId])
}

model NOARecord {
  id                    String                  @id @default(uuid())
  tenantId              String
  carrierId             String
  factoringCompanyId    String
  noaNumber             String                  @unique @db.VarChar(50)
  noaDocument           String?                 @db.VarChar(500)
  receivedDate          DateTime                @db.Date
  effectiveDate         DateTime                @db.Date
  expirationDate        DateTime?               @db.Date
  verifiedBy            String?
  verifiedAt            DateTime?
  verifiedMethod        String?                 @db.VarChar(50)
  status                NOAStatus               @default(PENDING)
  releasedBy            String?
  releasedAt            DateTime?
  releaseReason         String?
  externalId            String?                 @db.VarChar(255)
  sourceSystem          String?                 @db.VarChar(100)
  customFields          Json                    @default("{}")
  createdAt             DateTime                @default(now())
  updatedAt             DateTime @updatedAt
  deletedAt             DateTime?
  createdById           String?
  updatedById           String?
  FactoringVerification FactoringVerification[]
  carrier             Carrier?           @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  factoringCompany      FactoringCompany        @relation(fields: [factoringCompanyId], references: [id], onDelete: Cascade)
  tenant                Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([carrierId])
  @@index([effectiveDate])
  @@index([externalId, sourceSystem])
  @@index([factoringCompanyId])
  @@index([noaNumber])
  @@index([status])
  @@index([tenantId])
}

model NPSResponse {
  id               String      @id @default(uuid())
  tenantId         String
  surveyId         String
  respondentType   String?     @db.VarChar(50)
  respondentId     String?
  respondentEmail  String?     @db.VarChar(255)
  score            Int
  category         NPSCategory
  feedback         String?
  followUpResponse String?
  externalId       String?     @db.VarChar(255)
  sourceSystem     String?     @db.VarChar(100)
  customFields     Json        @default("{}")
  createdAt        DateTime    @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  createdById      String?
  updatedById      String?
  survey        NPSSurvey   @relation(fields: [surveyId], references: [id], onDelete: Cascade)
  tenant           Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([createdAt])
  @@index([externalId, sourceSystem])
  @@index([score])
  @@index([surveyId])
  @@index([tenantId])
}

model NPSSurvey {
  id               String        @id @default(uuid())
  tenantId         String
  surveyNumber     String        @unique @db.VarChar(50)
  question         String
  followUpQuestion String?
  targetType       String        @db.VarChar(50)
  scheduledAt      DateTime?     @db.Date
  expiresAt        DateTime?     @db.Date
  status           String        @default("DRAFT") @db.VarChar(50)
  responseCount    Int           @default(0)
  npsScore         Int?
  externalId       String?       @db.VarChar(255)
  sourceSystem     String?       @db.VarChar(100)
  customFields     Json          @default("{}")
  createdAt        DateTime      @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  createdById      String?
  updatedById      String?
  NPSResponse      NPSResponse[]
  tenant           Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([scheduledAt])
  @@index([status])
  @@index([tenantId])
}

model NotificationPreference {
  id                 String    @id @default(uuid())
  tenantId           String
  userId             String    @unique
  loadAssigned       Boolean   @default(true)
  loadStatusChange   Boolean   @default(true)
  documentReceived   Boolean   @default(true)
  invoiceCreated     Boolean   @default(true)
  paymentReceived    Boolean   @default(true)
  claimFiled         Boolean   @default(true)
  carrierExpiring    Boolean   @default(true)
  emailEnabled       Boolean   @default(true)
  smsEnabled         Boolean   @default(false)
  pushEnabled        Boolean   @default(true)
  inAppEnabled       Boolean   @default(true)
  quietHoursEnabled  Boolean   @default(false)
  quietHoursStart    String?   @db.VarChar(5)
  quietHoursEnd      String?   @db.VarChar(5)
  quietHoursTimezone String?   @db.VarChar(50)
  createdAt          DateTime  @default(now())
  updatedAt          DateTime @updatedAt
  createdById        String?
  customFields       Json      @default("{}")
  deletedAt          DateTime?
  externalId         String?   @db.VarChar(255)
  sourceSystem       String?   @db.VarChar(100)
  updatedById        String?
  tenant             Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User?              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([tenantId, userId])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
  @@index([userId])
}

model NumberSequence {
  id             String         @id @default(uuid())
  tenantId       String
  sequenceName   String         @db.VarChar(255)
  prefix         String?        @db.VarChar(20)
  currentNumber  Int            @default(1)
  increment      Int            @default(1)
  padding        Int            @default(4)
  resetFrequency ResetFrequency @default(NEVER)
  lastResetAt    DateTime?      @db.Date
  externalId     String?        @db.VarChar(255)
  sourceSystem   String?        @db.VarChar(100)
  customFields   Json           @default("{}")
  createdAt      DateTime       @default(now())
  updatedAt      DateTime @updatedAt
  deletedAt      DateTime?
  createdById    String?
  updatedById    String?
  tenant         Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, sequenceName])
  @@index([externalId, sourceSystem])
  @@index([sequenceName])
  @@index([tenantId])
}

model OnboardingChecklist {
  id             String           @id @default(uuid())
  tenantId       String
  positionId     String?
  checklistName  String           @db.VarChar(255)
  description    String?
  isActive       Boolean          @default(true)
  externalId     String?          @db.VarChar(255)
  sourceSystem   String?          @db.VarChar(100)
  customFields   Json             @default("{}")
  createdAt      DateTime         @default(now())
  updatedAt      DateTime @updatedAt
  deletedAt      DateTime?
  createdById    String?
  updatedById    String?
  position       Position?        @relation(fields: [positionId], references: [id])
  tenant         Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  OnboardingTask OnboardingTask[]

  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([positionId])
  @@index([tenantId])
}

model OnboardingTask {
  id                  String              @id @default(uuid())
  tenantId            String
  checklistId         String
  employeeId          String?
  taskName            String              @db.VarChar(255)
  description         String?
  dueDaysFromStart    Int                 @default(7)
  dueDate             DateTime?           @db.Date
  completedDate       DateTime?           @db.Date
  assignedTo          String?
  externalId          String?             @db.VarChar(255)
  sourceSystem        String?             @db.VarChar(100)
  customFields        Json                @default("{}")
  createdAt           DateTime            @default(now())
  updatedAt           DateTime @updatedAt
  deletedAt           DateTime?
  createdById         String?
  updatedById         String?
  checklist OnboardingChecklist @relation(fields: [checklistId], references: [id], onDelete: Cascade)
  employee            Employee?           @relation(fields: [employeeId], references: [id])
  tenant              Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([checklistId])
  @@index([completedDate])
  @@index([dueDate])
  @@index([employeeId])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
}

model OperationsCarrier {
  id                       String                    @id @default(uuid())
  tenantId                 String
  carrierType              String                    @db.VarChar(50)
  companyName              String                    @db.VarChar(255)
  mcNumber                 String?                   @db.VarChar(20)
  dotNumber                String?                   @db.VarChar(20)
  einTaxId                 String?                   @db.VarChar(20)
  address                  String?                   @db.VarChar(500)
  city                     String?                   @db.VarChar(100)
  state                    String?                   @db.VarChar(2)
  zip                      String?                   @db.VarChar(10)
  phone                    String?                   @db.VarChar(20)
  phoneSecondary           String?                   @db.VarChar(20)
  email                    String?                   @db.VarChar(255)
  website                  String?                   @db.VarChar(255)
  billingEmail             String?                   @db.VarChar(255)
  paymentTermsDays         Int                       @default(30)
  preferredPaymentMethod   String?                   @db.VarChar(50)
  factoringCompanyName     String?                   @db.VarChar(255)
  factoringCompanyPhone    String?                   @db.VarChar(20)
  factoringCompanyEmail    String?                   @db.VarChar(255)
  insuranceCompany         String?                   @db.VarChar(255)
  insurancePolicyNumber    String?                   @db.VarChar(100)
  insuranceExpiryDate      DateTime?                 @db.Date
  cargoInsuranceLimitCents Int?
  status                   String                    @default("ACTIVE") @db.VarChar(50)
  notes                    String?
  isActive                 Boolean                   @default(true)
  externalId               String?                   @db.VarChar(255)
  sourceSystem             String?                   @db.VarChar(100)
  customFields             Json                      @default("{}")
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime @updatedAt
  deletedAt                DateTime?
  createdById              String?
  updatedById              String?
  LoadHistory              LoadHistory[]
  tenant                   Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  drivers                  OperationsCarrierDriver[]
  trucks                   OperationsCarrierTruck[]

  @@index([dotNumber])
  @@index([isActive])
  @@index([mcNumber])
  @@index([status])
  @@index([tenantId])
}

model OperationsCarrierDriver {
  id                     String                   @id @default(uuid())
  carrierId              String
  firstName              String                   @db.VarChar(100)
  lastName               String                   @db.VarChar(100)
  nickname               String?                  @db.VarChar(100)
  isOwner                Boolean                  @default(false)
  phone                  String?                  @db.VarChar(20)
  phoneSecondary         String?                  @db.VarChar(20)
  email                  String?                  @db.VarChar(255)
  address                String?                  @db.VarChar(500)
  city                   String?                  @db.VarChar(100)
  state                  String?                  @db.VarChar(2)
  zip                    String?                  @db.VarChar(10)
  cdlNumber              String?                  @db.VarChar(50)
  cdlState               String?                  @db.VarChar(2)
  cdlClass               String?                  @db.VarChar(10)
  cdlExpiry              DateTime?                @db.Date
  cdlEndorsements        String?                  @db.VarChar(100)
  medicalCardExpiry      DateTime?                @db.Date
  emergencyContactName   String?                  @db.VarChar(255)
  emergencyContactPhone  String?                  @db.VarChar(20)
  status                 String                   @default("ACTIVE") @db.VarChar(50)
  notes                  String?
  isActive               Boolean                  @default(true)
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime @updatedAt
  deletedAt              DateTime?
  LoadHistory            LoadHistory[]
  carrier                OperationsCarrier        @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  trucks                 OperationsCarrierTruck[]

  @@index([carrierId])
  @@index([cdlNumber])
  @@index([isActive])
  @@index([status])
}

model OperationsCarrierTruck {
  id                      String                   @id @default(uuid())
  carrierId               String
  unitNumber              String                   @db.VarChar(50)
  vin                     String?                  @db.VarChar(17)
  licensePlate            String?                  @db.VarChar(20)
  licensePlateState       String?                  @db.VarChar(2)
  year                    Int?
  make                    String?                  @db.VarChar(100)
  model                   String?                  @db.VarChar(100)
  truckTypeId             String?
  category                String                   @db.VarChar(50)
  customTypeDescription   String?                  @db.VarChar(255)
  deckLengthFt            Decimal?                 @db.Decimal(5, 2)
  deckWidthFt             Decimal?                 @db.Decimal(5, 2)
  deckHeightFt            Decimal?                 @db.Decimal(5, 2)
  maxCargoWeightLbs       Int?
  axleCount               Int?
  hasTarps                Boolean                  @default(false)
  hasChains               Boolean                  @default(false)
  hasStraps               Boolean                  @default(false)
  coilRacks               Boolean                  @default(false)
  loadBars                Boolean                  @default(false)
  ramps                   Boolean                  @default(false)
  registrationExpiry      DateTime?                @db.Date
  annualInspectionDate    DateTime?                @db.Date
  status                  String                   @default("ACTIVE") @db.VarChar(50)
  assignedDriverId        String?
  notes                   String?
  isActive                Boolean                  @default(true)
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime @updatedAt
  deletedAt               DateTime?
  LoadHistory             LoadHistory[]
  assignedDriver          OperationsCarrierDriver? @relation(fields: [assignedDriverId], references: [id])
  carrier                 OperationsCarrier        @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  truckType               TruckType?               @relation(fields: [truckTypeId], references: [id])

  @@index([assignedDriverId])
  @@index([carrierId])
  @@index([isActive])
  @@index([status])
  @@index([truckTypeId])
  @@index([unitNumber])
  @@index([vin])
}

model Opportunity {
  id                     String     @id @default(uuid())
  tenantId               String
  companyId              String
  name                   String     @db.VarChar(255)
  description            String?
  stage                  String     @db.VarChar(50)
  probability            Int        @default(0)
  estimatedValue         Decimal?   @db.Decimal(12, 2)
  estimatedLoadsPerMonth Int?
  avgLoadValue           Decimal?   @db.Decimal(10, 2)
  expectedCloseDate      DateTime?
  actualCloseDate        DateTime?
  serviceTypes           String[]   @db.VarChar(50)
  lanes                  Json       @default("[]")
  competition            String?
  winReason              String?
  lossReason             String?
  primaryContactId       String?
  ownerId                String
  hubspotDealId          String?    @db.VarChar(50)
  externalId             String?    @db.VarChar(255)
  sourceSystem           String?    @db.VarChar(100)
  customFields           Json       @default("{}")
  tags                   String[]   @db.VarChar(100)
  createdAt              DateTime   @default(now())
  updatedAt              DateTime @updatedAt
  deletedAt              DateTime?
  createdById            String?
  updatedById            String?
  activities               Activity[]
  company             Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  owner                User?              @relation(fields: [ownerId], references: [id])
  primaryContact                Contact?   @relation(fields: [primaryContactId], references: [id])
  tenant                 Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([expectedCloseDate])
  @@index([externalId, sourceSystem])
  @@index([hubspotDealId])
  @@index([ownerId])
  @@index([stage])
  @@index([tenantId])
}

model Order {
  id                   String            @id @default(uuid())
  tenantId             String
  orderNumber          String            @db.VarChar(50)
  customerReference    String?           @db.VarChar(100)
  poNumber             String?           @db.VarChar(100)
  bolNumber            String?           @db.VarChar(100)
  customerId           String
  customerContactId    String?
  quoteId              String?
  salesRepId           String?
  status               String            @default("PENDING") @db.VarChar(30)
  customerRate         Decimal?          @db.Decimal(10, 2)
  accessorialCharges   Decimal           @default(0) @db.Decimal(10, 2)
  fuelSurcharge        Decimal           @default(0) @db.Decimal(10, 2)
  totalCharges         Decimal?          @db.Decimal(10, 2)
  currency             String            @default("USD") @db.VarChar(3)
  commodity            String?           @db.VarChar(255)
  commodityClass       String?           @db.VarChar(10)
  weightLbs            Decimal?          @db.Decimal(10, 2)
  pieceCount           Int?
  palletCount          Int?
  equipmentType        String?           @db.VarChar(30)
  isHazmat             Boolean           @default(false)
  hazmatClass          String?           @db.VarChar(20)
  temperatureMin       Decimal?          @db.Decimal(5, 2)
  temperatureMax       Decimal?          @db.Decimal(5, 2)
  orderDate            DateTime          @default(now())
  requiredDeliveryDate DateTime?
  actualDeliveryDate   DateTime?
  specialInstructions  String?
  internalNotes        String?
  isHot                Boolean           @default(false)
  isTeam               Boolean           @default(false)
  isExpedited          Boolean           @default(false)
  externalId           String?           @db.VarChar(255)
  sourceSystem         String?           @db.VarChar(100)
  customFields         Json              @default("{}")
  createdAt            DateTime          @default(now())
  updatedAt            DateTime @updatedAt
  deletedAt            DateTime?
  createdById          String?
  updatedById          String?
  commissions      AgentCommission[]
  Claim                Claim[]
  CommissionEntry      CommissionEntry[]
  documents Document[]
  Invoice              Invoice[]
  lineItems      InvoiceLineItem[]
  loads Load[]
  LoadPost             LoadPost[]
  contact              Contact?          @relation(fields: [customerContactId], references: [id])
  customer             Company?           @relation(fields: [customerId], references: [id])
  quote                Quote?            @relation(fields: [quoteId], references: [id])
  salesRep                User?              @relation(fields: [salesRepId], references: [id])
  tenant               Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  items                OrderItem[]
  StatusHistory        StatusHistory[]
  stops               Stop[]

  @@unique([tenantId, orderNumber])
  @@index([customerId])
  @@index([externalId, sourceSystem])
  @@index([orderDate])
  @@index([status])
  @@index([tenantId])
}

model OrderItem {
  id               String    @id @default(uuid())
  tenantId         String
  orderId          String
  stopId           String?
  description      String    @db.VarChar(255)
  quantity         Int       @default(1)
  quantityType     String?   @db.VarChar(20)
  weightLbs        Decimal?  @db.Decimal(10, 2)
  dimensionsLength Int?
  dimensionsWidth  Int?
  dimensionsHeight Int?
  commodityClass   String?   @db.VarChar(10)
  nmfcCode         String?   @db.VarChar(20)
  isHazmat         Boolean   @default(false)
  hazmatClass      String?   @db.VarChar(20)
  unNumber         String?   @db.VarChar(20)
  sku              String?   @db.VarChar(100)
  lotNumber        String?   @db.VarChar(100)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime @updatedAt
  createdById      String?
  customFields     Json      @default("{}")
  deletedAt        DateTime?
  externalId       String?   @db.VarChar(255)
  sourceSystem     String?   @db.VarChar(100)
  updatedById      String?
  order               Order?             @relation(fields: [orderId], references: [id], onDelete: Cascade)
  stop             Stop?     @relation(fields: [stopId], references: [id])
  tenant           Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([orderId])
  @@index([stopId])
  @@index([tenantId])
}

model PasswordResetToken {
  id           String    @id @default(uuid())
  userId       String
  tokenHash    String    @db.VarChar(255)
  expiresAt    DateTime
  usedAt       DateTime?
  createdAt    DateTime  @default(now())
  externalId   String?   @db.VarChar(255)
  sourceSystem String?   @db.VarChar(100)
  tenantId     String?
  updatedAt    DateTime? @updatedAt
  Tenant       Tenant?   @relation(fields: [tenantId], references: [id])
  user                User?              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([tokenHash])
  @@index([userId])
}

model PaymentApplication {
  id              String          @id @default(uuid())
  paymentId       String
  invoiceId       String
  amount          Decimal         @db.Decimal(12, 2)
  createdAt       DateTime        @default(now())
  createdById     String?
  customFields    Json            @default("{}")
  deletedAt       DateTime?
  externalId      String?         @db.VarChar(255)
  sourceSystem    String?         @db.VarChar(100)
  tenantId        String
  updatedAt       DateTime @updatedAt
  updatedById     String?
  invoice         Invoice         @relation(fields: [invoiceId], references: [id])
  payment PaymentReceived @relation(fields: [paymentId], references: [id], onDelete: Cascade)
  tenant          Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([invoiceId])
  @@index([paymentId])
  @@index([tenantId])
}

model PaymentMade {
  id              String          @id @default(uuid())
  tenantId        String
  paymentNumber   String          @db.VarChar(50)
  carrierId       String
  externalId      String?         @db.VarChar(255)
  sourceSystem    String?         @db.VarChar(100)
  quickbooksId    String?         @db.VarChar(50)
  paymentDate     DateTime
  paymentMethod   String          @db.VarChar(50)
  amount          Decimal         @db.Decimal(12, 2)
  currency        String          @default("USD") @db.VarChar(3)
  referenceNumber String?         @db.VarChar(100)
  bankAccountId   String?
  status          String          @default("PENDING") @db.VarChar(50)
  achBatchId      String?         @db.VarChar(100)
  achTraceNumber  String?         @db.VarChar(100)
  notes           String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime @updatedAt
  createdById     String?
  deletedAt       DateTime?
  updatedById     String?
  bankAccount  ChartOfAccount?     @relation(fields: [bankAccountId], references: [id])
  carrier             Carrier?           @relation(fields: [carrierId], references: [id])
  tenant          Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, paymentNumber])
  @@index([carrierId])
  @@index([externalId, sourceSystem])
  @@index([paymentDate])
  @@index([status])
  @@index([tenantId])
}

model PaymentPlan {
  id                 String            @id @default(uuid())
  tenantId           String
  companyId          String
  customerId         String?
  planNumber         String            @unique @db.VarChar(50)
  totalAmount        Decimal           @db.Decimal(12, 2)
  amountPaid         Decimal           @default(0) @db.Decimal(12, 2)
  remainingBalance   Decimal           @db.Decimal(12, 2)
  installmentAmount  Decimal           @db.Decimal(12, 2)
  installmentCount   Int
  installmentsPaid   Int               @default(0)
  status             PaymentPlanStatus @default(ACTIVE)
  firstPaymentDate   DateTime          @db.Date
  frequency          String            @db.VarChar(50)
  nextPaymentDate    DateTime?         @db.Date
  interestRate       Decimal?          @db.Decimal(5, 2)
  lateFeePct         Decimal?          @db.Decimal(5, 2)
  lateFeeFixed       Decimal?          @db.Decimal(10, 2)
  invoiceIds         Json?
  approvedById       String?
  approvedAt         DateTime?
  completedAt        DateTime?
  defaultedAt        DateTime?
  cancelledAt        DateTime?
  cancellationReason String?
  externalId         String?           @db.VarChar(255)
  sourceSystem       String?           @db.VarChar(100)
  customFields       Json              @default("{}")
  createdAt          DateTime          @default(now())
  updatedAt          DateTime @updatedAt
  deletedAt          DateTime?
  createdById        String?
  updatedById        String?
  company             Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tenant             Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([externalId, sourceSystem])
  @@index([nextPaymentDate])
  @@index([planNumber])
  @@index([status])
  @@index([tenantId])
}

model PaymentReceived {
  id                 String               @id @default(uuid())
  tenantId           String
  paymentNumber      String               @db.VarChar(50)
  companyId          String
  externalId         String?              @db.VarChar(255)
  sourceSystem       String?              @db.VarChar(100)
  quickbooksId       String?              @db.VarChar(50)
  paymentDate        DateTime
  paymentMethod      String               @db.VarChar(50)
  amount             Decimal              @db.Decimal(12, 2)
  unappliedAmount    Decimal              @default(0) @db.Decimal(12, 2)
  currency           String               @default("USD") @db.VarChar(3)
  referenceNumber    String?              @db.VarChar(100)
  bankAccountId      String?
  depositDate        DateTime?
  status             String               @default("RECEIVED") @db.VarChar(50)
  notes              String?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime @updatedAt
  createdById        String?
  deletedAt          DateTime?
  updatedById        String?
  applications PaymentApplication[]
  bankAccount     ChartOfAccount?     @relation(fields: [bankAccountId], references: [id])
  company             Company?           @relation(fields: [companyId], references: [id])
  tenant             Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, paymentNumber])
  @@index([companyId])
  @@index([externalId, sourceSystem])
  @@index([paymentDate])
  @@index([status])
  @@index([tenantId])
}

model PortalActivityLog {
  id           String     @id @default(uuid())
  tenantId     String
  userId       String
  action       String     @db.VarChar(100)
  entityType   String?    @db.VarChar(50)
  entityId     String?
  description  String?
  ipAddress    String?    @db.VarChar(45)
  userAgent    String?
  externalId   String?    @db.VarChar(255)
  sourceSystem String?    @db.VarChar(100)
  customFields Json       @default("{}")
  createdAt    DateTime   @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  companyId    String?
  company             Company?           @relation(fields: [companyId], references: [id])
  tenant       Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  portalUser   PortalUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([action])
  @@index([createdAt])
  @@index([entityType, entityId])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
  @@index([userId])
}

model PortalBranding {
  id             String    @id @default(uuid())
  tenantId       String
  companyId      String    @unique
  logoUrl        String?   @db.VarChar(500)
  faviconUrl     String?   @db.VarChar(500)
  primaryColor   String?   @db.VarChar(7)
  secondaryColor String?   @db.VarChar(7)
  accentColor    String?   @db.VarChar(7)
  customCss      String?
  customJs       String?
  headerHtml     String?
  footerHtml     String?
  welcomeMessage String?
  customDomain   String?   @db.VarChar(255)
  externalId     String?   @db.VarChar(255)
  sourceSystem   String?   @db.VarChar(100)
  customFields   Json      @default("{}")
  createdAt      DateTime  @default(now())
  updatedAt      DateTime @updatedAt
  deletedAt      DateTime?
  createdById    String?
  updatedById    String?
  company             Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tenant         Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([customDomain])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
}

model PortalNotification {
  id                String                 @id @default(uuid())
  tenantId          String
  portalUserId      String
  notificationType  PortalNotificationType
  title             String                 @db.VarChar(255)
  message           String
  isRead            Boolean                @default(false)
  readAt            DateTime?
  actionUrl         String?                @db.VarChar(500)
  relatedEntityType String?                @db.VarChar(50)
  relatedEntityId   String?                @db.VarChar(255)
  externalId        String?                @db.VarChar(255)
  sourceSystem      String?                @db.VarChar(100)
  customFields      Json                   @default("{}")
  createdAt         DateTime               @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  portalUser        PortalUser             @relation(fields: [portalUserId], references: [id], onDelete: Cascade)
  tenant            Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([externalId, sourceSystem])
  @@index([isRead])
  @@index([notificationType])
  @@index([portalUserId])
  @@index([relatedEntityType, relatedEntityId])
  @@index([tenantId])
}

model PortalPayment {
  id                     String              @id @default(uuid())
  tenantId               String
  companyId              String
  userId                 String
  paymentNumber          String              @unique @db.VarChar(50)
  amount                 Decimal             @db.Decimal(12, 2)
  currency               String              @default("USD") @db.VarChar(3)
  status                 PortalPaymentStatus @default(PENDING)
  paymentMethod          String              @db.VarChar(50)
  lastFourDigits         String?             @db.VarChar(4)
  processorTransactionId String?             @db.VarChar(255)
  processorResponse      Json?
  invoiceIds             String[]
  processedAt            DateTime?
  externalId             String?             @db.VarChar(255)
  sourceSystem           String?             @db.VarChar(100)
  customFields           Json                @default("{}")
  createdAt              DateTime            @default(now())
  updatedAt              DateTime @updatedAt
  deletedAt              DateTime?
  createdById            String?
  updatedById            String?
  company             Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tenant                 Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  portalUser             PortalUser          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([externalId, sourceSystem])
  @@index([paymentNumber])
  @@index([status])
  @@index([tenantId])
  @@index([userId])
}

model PortalSavedPaymentMethod {
  id                String     @id @default(uuid())
  tenantId          String
  portalUserId      String
  paymentMethodType String     @db.VarChar(50)
  lastFourDigits    String?    @db.VarChar(4)
  cardBrand         String?    @db.VarChar(50)
  expirationMonth   Int?
  expirationYear    Int?
  billingName       String?    @db.VarChar(255)
  billingAddress    String?    @db.VarChar(255)
  billingCity       String?    @db.VarChar(100)
  billingState      String?    @db.VarChar(2)
  billingZip        String?    @db.VarChar(10)
  isDefault         Boolean    @default(false)
  isActive          Boolean    @default(true)
  externalToken     String?    @db.VarChar(255)
  externalId        String?    @db.VarChar(255)
  sourceSystem      String?    @db.VarChar(100)
  customFields      Json       @default("{}")
  createdAt         DateTime   @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  portalUser        PortalUser @relation(fields: [portalUserId], references: [id], onDelete: Cascade)
  tenant            Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([isDefault])
  @@index([portalUserId])
  @@index([tenantId])
}

model PortalSession {
  id               String     @id @default(uuid())
  tenantId         String
  userId           String
  refreshTokenHash String     @db.VarChar(255)
  userAgent        String?
  ipAddress        String?    @db.VarChar(45)
  expiresAt        DateTime
  revokedAt        DateTime?
  externalId       String?    @db.VarChar(255)
  sourceSystem     String?    @db.VarChar(100)
  customFields     Json       @default("{}")
  createdAt        DateTime   @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  createdById      String?
  updatedById      String?
  tenant           Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  portalUser       PortalUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([externalId, sourceSystem])
  @@index([refreshTokenHash])
  @@index([tenantId])
  @@index([userId])
}

model PortalUser {
  id                       String                     @id @default(uuid())
  tenantId                 String
  companyId                String
  email                    String                     @db.VarChar(255)
  password                 String                     @db.VarChar(255)
  firstName                String                     @db.VarChar(100)
  lastName                 String                     @db.VarChar(100)
  phone                    String?                    @db.VarChar(20)
  role                     PortalUserRole             @default(USER)
  status                   PortalUserStatus           @default(PENDING)
  emailVerified            Boolean                    @default(false)
  emailVerifiedAt          DateTime?
  verificationToken        String?                    @unique @db.VarChar(255)
  lastLoginAt              DateTime?
  language                 String                     @default("en") @db.VarChar(10)
  externalId               String?                    @db.VarChar(255)
  sourceSystem             String?                    @db.VarChar(100)
  customFields             Json                       @default("{}")
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime @updatedAt
  deletedAt                DateTime?
  createdById              String?
  updatedById              String?
  PortalActivityLog        PortalActivityLog[]
  PortalNotification       PortalNotification[]
  PortalPayment            PortalPayment[]
  PortalSavedPaymentMethod PortalSavedPaymentMethod[]
  PortalSession            PortalSession[]
  company             Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tenant                   Tenant                     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  QuoteRequest             QuoteRequest[]

  @@unique([tenantId, email])
  @@index([companyId])
  @@index([email])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId])
}

model Position {
  id                  String                @id @default(uuid())
  tenantId            String
  code                String                @unique @db.VarChar(50)
  title               String                @db.VarChar(255)
  description         String?
  minSalary           Decimal?              @db.Decimal(12, 2)
  maxSalary           Decimal?              @db.Decimal(12, 2)
  status              String                @default("ACTIVE") @db.VarChar(50)
  externalId          String?               @db.VarChar(255)
  sourceSystem        String?               @db.VarChar(100)
  customFields        Json                  @default("{}")
  createdAt           DateTime              @default(now())
  updatedAt           DateTime @updatedAt
  deletedAt           DateTime?
  createdById         String?
  updatedById         String?
  Employee            Employee[]
  EmploymentHistory   EmploymentHistory[]
  OnboardingChecklist OnboardingChecklist[]
  tenant              Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, code])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId])
}

model PostLead {
  id              String         @id @default(uuid())
  tenantId        String
  postId          String
  carrierId       String?
  carrierName     String         @db.VarChar(255)
  carrierMC       String?        @db.VarChar(20)
  carrierDOT      String?        @db.VarChar(20)
  contactName     String         @db.VarChar(255)
  contactPhone    String         @db.VarChar(20)
  contactEmail    String?        @db.VarChar(255)
  quotedRate      Decimal?       @db.Decimal(10, 2)
  availableDate   DateTime?      @db.Date
  equipmentInfo   String?
  notes           String?
  status          PostLeadStatus @default(NEW)
  contactedAt     DateTime?
  lastContactedAt DateTime?
  nextFollowUpAt  DateTime?
  acceptedAt      DateTime?
  declinedAt      DateTime?
  declinedReason  String?
  externalId      String?        @db.VarChar(255)
  sourceSystem    String?        @db.VarChar(100)
  customFields    Json           @default("{}")
  createdAt       DateTime       @default(now())
  updatedAt       DateTime @updatedAt
  deletedAt       DateTime?
  createdById     String?
  updatedById     String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id])
  post        LoadPost       @relation(fields: [postId], references: [id], onDelete: Cascade)
  tenant          Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([carrierId])
  @@index([createdAt])
  @@index([externalId, sourceSystem])
  @@index([nextFollowUpAt])
  @@index([postId])
  @@index([status])
  @@index([tenantId])
}

model PostingRule {
  id              String           @id @default(uuid())
  tenantId        String
  accountId       String?
  ruleName        String           @db.VarChar(255)
  isActive        Boolean          @default(true)
  conditions      Json
  frequency       PostingFrequency
  scheduleTime    String?          @db.VarChar(10)
  expirationHours Int?
  rulesMatched    Int              @default(0)
  postsCreated    Int              @default(0)
  lastTriggeredAt DateTime?
  externalId      String?          @db.VarChar(255)
  sourceSystem    String?          @db.VarChar(100)
  customFields    Json             @default("{}")
  createdAt       DateTime         @default(now())
  updatedAt       DateTime @updatedAt
  deletedAt       DateTime?
  createdById     String?
  updatedById     String?
  tenant          Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([accountId])
  @@index([externalId, sourceSystem])
  @@index([frequency])
  @@index([isActive])
  @@index([tenantId])
}

model PostingSchedule {
  id           String    @id @default(uuid())
  tenantId     String
  postId       String?
  ruleId       String?
  scheduledFor DateTime
  status       String    @default("PENDING") @db.VarChar(50)
  executedAt   DateTime?
  errorMessage String?
  externalId   String?   @db.VarChar(255)
  sourceSystem String?   @db.VarChar(100)
  customFields Json      @default("{}")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([postId])
  @@index([ruleId])
  @@index([scheduledFor])
  @@index([status])
  @@index([tenantId])
}

model QuickbooksSyncLog {
  id              String    @id @default(uuid())
  tenantId        String
  entityType      String    @db.VarChar(50)
  entityId        String
  quickbooksId    String?   @db.VarChar(50)
  syncDirection   String    @db.VarChar(20)
  syncStatus      String    @db.VarChar(20)
  payloadSent     Json?
  payloadReceived Json?
  errorMessage    String?
  syncedAt        DateTime  @default(now())
  createdAt       DateTime  @default(now())
  createdById     String?
  customFields    Json      @default("{}")
  deletedAt       DateTime?
  externalId      String?   @db.VarChar(255)
  sourceSystem    String?   @db.VarChar(100)
  updatedAt       DateTime @updatedAt
  updatedById     String?
  tenant          Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([entityType, entityId])
  @@index([externalId, sourceSystem])
  @@index([syncStatus])
  @@index([tenantId])
}

model Quote {
  id                  String             @id @default(uuid())
  tenantId            String
  quoteNumber         String             @db.VarChar(50)
  version             Int                @default(1)
  parentQuoteId       String?
  companyId           String?
  contactId           String?
  customerName        String?            @db.VarChar(255)
  customerEmail       String?            @db.VarChar(255)
  customerPhone       String?            @db.VarChar(50)
  status              String             @default("DRAFT") @db.VarChar(50)
  serviceType         String             @db.VarChar(50)
  equipmentType       String?            @db.VarChar(50)
  pickupDate          DateTime?
  pickupWindowStart   String?            @db.VarChar(10)
  pickupWindowEnd     String?            @db.VarChar(10)
  deliveryDate        DateTime?
  deliveryWindowStart String?            @db.VarChar(10)
  deliveryWindowEnd   String?            @db.VarChar(10)
  isFlexibleDates     Boolean            @default(false)
  commodity           String?            @db.VarChar(255)
  weightLbs           Decimal?           @db.Decimal(10, 2)
  pieces              Int?
  pallets             Int?
  dimensions          Json?
  isHazmat            Boolean            @default(false)
  hazmatClass         String?            @db.VarChar(20)
  temperatureMin      Decimal?           @db.Decimal(5, 2)
  temperatureMax      Decimal?           @db.Decimal(5, 2)
  totalMiles          Decimal?           @db.Decimal(10, 2)
  linehaulRate        Decimal?           @db.Decimal(12, 2)
  fuelSurcharge       Decimal?           @db.Decimal(12, 2)
  accessorialsTotal   Decimal?           @db.Decimal(12, 2)
  totalAmount         Decimal            @db.Decimal(12, 2)
  marginAmount        Decimal?           @db.Decimal(12, 2)
  marginPercent       Decimal?           @db.Decimal(5, 2)
  currency            String             @default("USD") @db.VarChar(3)
  rateSource          String?            @db.VarChar(50)
  marketRateLow       Decimal?           @db.Decimal(12, 2)
  marketRateAvg       Decimal?           @db.Decimal(12, 2)
  marketRateHigh      Decimal?           @db.Decimal(12, 2)
  validFrom           DateTime           @default(now())
  validUntil          DateTime?
  convertedOrderId    String?
  convertedAt         DateTime?
  sentAt              DateTime?
  viewedAt            DateTime?
  respondedAt         DateTime?
  rejectionReason     String?
  internalNotes       String?
  customerNotes       String?
  specialInstructions String?
  salesRepId          String?
  externalId          String?            @db.VarChar(255)
  sourceSystem        String?            @db.VarChar(100)
  customFields        Json               @default("{}")
  tags                String[]           @db.VarChar(100)
  createdAt           DateTime           @default(now())
  updatedAt           DateTime @updatedAt
  deletedAt           DateTime?
  createdById         String?
  updatedById         String?
  orders               Order[]
  company             Company?           @relation(fields: [companyId], references: [id])
  contact             Contact?           @relation(fields: [contactId], references: [id])
  parentQuote          Quote?             @relation("QuoteToQuote", fields: [parentQuoteId], references: [id])
  childQuotes          Quote[]            @relation("QuoteToQuote")
  salesRep             User?              @relation(fields: [salesRepId], references: [id])
  tenant               Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  accessorials         QuoteAccessorial[]
  request              QuoteRequest?
  stops                QuoteStop[]

  @@unique([tenantId, quoteNumber, version])
  @@index([companyId])
  @@index([externalId, sourceSystem])
  @@index([pickupDate])
  @@index([salesRepId])
  @@index([status])
  @@index([tenantId])
}

model QuoteAccessorial {
  id              String    @id @default(uuid())
  quoteId         String
  accessorialType String    @db.VarChar(50)
  description     String?   @db.VarChar(255)
  quantity        Decimal   @default(1) @db.Decimal(10, 2)
  unitRate        Decimal   @db.Decimal(10, 2)
  totalAmount     Decimal   @db.Decimal(12, 2)
  isBillable      Boolean   @default(true)
  createdAt       DateTime  @default(now())
  createdById     String?
  customFields    Json      @default("{}")
  deletedAt       DateTime?
  externalId      String?   @db.VarChar(255)
  sourceSystem    String?   @db.VarChar(100)
  tenantId        String
  updatedAt       DateTime @updatedAt
  updatedById     String?
  Quote           Quote     @relation(fields: [quoteId], references: [id], onDelete: Cascade)
  tenant          Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([quoteId])
}

model QuoteRequest {
  id                      String             @id @default(uuid())
  tenantId                String
  companyId               String
  userId                  String
  requestNumber           String             @unique @db.VarChar(50)
  subject                 String?            @db.VarChar(255)
  description             String?
  originCity              String?            @db.VarChar(100)
  originState             String?            @db.VarChar(50)
  originZip               String?            @db.VarChar(20)
  destCity                String?            @db.VarChar(100)
  destState               String?            @db.VarChar(50)
  destZip                 String?            @db.VarChar(20)
  pickupDate              DateTime?          @db.Date
  deliveryDate            DateTime?          @db.Date
  equipmentType           String?            @db.VarChar(50)
  commodity               String?            @db.VarChar(255)
  weightLbs               Decimal?           @db.Decimal(10, 2)
  palletCount             Int?
  isHazmat                Boolean            @default(false)
  isTemperatureControlled Boolean            @default(false)
  tempRange               String?            @db.VarChar(50)
  status                  QuoteRequestStatus @default(SUBMITTED)
  quoteId                 String?            @unique
  quotedAmount            Decimal?           @db.Decimal(12, 2)
  quotedAt                DateTime?
  quotedBy                String?
  quoteExpiresAt          DateTime?
  acceptedAt              DateTime?
  declinedAt              DateTime?
  declineReason           String?
  externalId              String?            @db.VarChar(255)
  sourceSystem            String?            @db.VarChar(100)
  customFields            Json               @default("{}")
  createdAt               DateTime           @default(now())
  updatedAt               DateTime @updatedAt
  deletedAt               DateTime?
  createdById             String?
  updatedById             String?
  company             Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  quote                   Quote?             @relation(fields: [quoteId], references: [id])
  tenant                  Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  portalUser              PortalUser         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([externalId, sourceSystem])
  @@index([requestNumber])
  @@index([status])
  @@index([tenantId])
  @@index([userId])
}

model QuoteStop {
  id                  String    @id @default(uuid())
  quoteId             String
  stopSequence        Int
  stopType            String    @db.VarChar(20)
  facilityName        String?   @db.VarChar(255)
  addressLine1        String    @db.VarChar(255)
  addressLine2        String?   @db.VarChar(255)
  city                String    @db.VarChar(100)
  state               String    @db.VarChar(50)
  postalCode          String    @db.VarChar(20)
  country             String    @default("USA") @db.VarChar(3)
  latitude            Decimal?  @db.Decimal(10, 7)
  longitude           Decimal?  @db.Decimal(10, 7)
  contactName         String?   @db.VarChar(255)
  contactPhone        String?   @db.VarChar(50)
  contactEmail        String?   @db.VarChar(255)
  appointmentRequired Boolean   @default(false)
  earliestTime        String?   @db.VarChar(10)
  latestTime          String?   @db.VarChar(10)
  instructions        String?
  milesToNext         Decimal?  @db.Decimal(10, 2)
  createdAt           DateTime  @default(now())
  updatedAt           DateTime @updatedAt
  createdById         String?
  customFields        Json      @default("{}")
  deletedAt           DateTime?
  externalId          String?   @db.VarChar(255)
  sourceSystem        String?   @db.VarChar(100)
  tenantId            String
  updatedById         String?
  Quote               Quote     @relation(fields: [quoteId], references: [id], onDelete: Cascade)
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([quoteId, stopSequence])
  @@index([quoteId])
}

model RateAlert {
  id               String             @id @default(uuid())
  tenantId         String
  laneDescription  String             @db.VarChar(500)
  originCity       String?            @db.VarChar(100)
  originState      String             @db.VarChar(2)
  destCity         String?            @db.VarChar(100)
  destState        String             @db.VarChar(2)
  equipmentType    String             @db.VarChar(50)
  condition        AlertCondition
  thresholdValue   Decimal            @db.Decimal(10, 2)
  comparisonPeriod String             @db.VarChar(50)
  notifyUserIds    Json?
  notifyEmails     Json?
  isActive         Boolean            @default(true)
  lastTriggeredAt  DateTime?
  externalId       String?            @db.VarChar(255)
  sourceSystem     String?            @db.VarChar(100)
  customFields     Json               @default("{}")
  createdAt        DateTime           @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  createdById      String?
  updatedById      String?
  tenant           Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  RateAlertHistory RateAlertHistory[]

  @@index([destState])
  @@index([equipmentType])
  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([originState])
  @@index([tenantId])
}

model RateAlertHistory {
  id               String    @id @default(uuid())
  tenantId         String
  alertId          String
  triggeredAt      DateTime
  oldRate          Decimal   @db.Decimal(10, 2)
  newRate          Decimal   @db.Decimal(10, 2)
  changePercent    Decimal   @db.Decimal(5, 2)
  notificationSent Boolean   @default(false)
  notifiedUserIds  Json?
  externalId       String?   @db.VarChar(255)
  sourceSystem     String?   @db.VarChar(100)
  customFields     Json      @default("{}")
  createdAt        DateTime  @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  createdById      String?
  updatedById      String?
  alert        RateAlert @relation(fields: [alertId], references: [id], onDelete: Cascade)
  tenant           Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([alertId])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
  @@index([triggeredAt])
}

model RateContract {
  id                          String             @id @default(uuid())
  tenantId                    String
  contractNumber              String             @db.VarChar(50)
  name                        String             @db.VarChar(255)
  companyId                   String
  status                      String             @default("ACTIVE") @db.VarChar(50)
  effectiveDate               DateTime
  expirationDate              DateTime
  paymentTerms                String?            @db.VarChar(50)
  autoRenew                   Boolean            @default(false)
  renewalNoticeDays           Int                @default(30)
  defaultFuelSurchargeType    String?            @db.VarChar(50)
  defaultFuelSurchargePercent Decimal?           @db.Decimal(5, 2)
  minimumMarginPercent        Decimal?           @db.Decimal(5, 2)
  notes                       String?
  externalId                  String?            @db.VarChar(255)
  sourceSystem                String?            @db.VarChar(100)
  customFields                Json               @default("{}")
  createdAt                   DateTime           @default(now())
  updatedAt                   DateTime @updatedAt
  deletedAt                   DateTime?
  createdById                 String?
  updatedById                 String?
  accessorialRates            AccessorialRate[]
  laneRates                   ContractLaneRate[]
  company             Company?           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  tenant                      Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, contractNumber])
  @@index([companyId])
  @@index([effectiveDate])
  @@index([expirationDate])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId])
}

model RateData {
  id               String    @id @default(uuid())
  tenantId         String
  postId           String
  marketLowRate    Decimal?  @db.Decimal(10, 2)
  marketHighRate   Decimal?  @db.Decimal(10, 2)
  marketAvgRate    Decimal?  @db.Decimal(10, 2)
  similarLoadCount Int?
  dataSource       String?   @db.VarChar(50)
  asOfDate         DateTime  @db.Date
  externalId       String?   @db.VarChar(255)
  sourceSystem     String?   @db.VarChar(100)
  customFields     Json      @default("{}")
  createdAt        DateTime  @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  createdById      String?
  updatedById      String?
  post         LoadPost  @relation(fields: [postId], references: [id], onDelete: Cascade)
  tenant           Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([asOfDate])
  @@index([externalId, sourceSystem])
  @@index([postId])
  @@index([tenantId])
}

model RateHistory {
  id               String       @id @default(uuid())
  tenantId         String
  originCity       String       @db.VarChar(100)
  originState      String       @db.VarChar(2)
  destCity         String       @db.VarChar(100)
  destState        String       @db.VarChar(2)
  equipmentType    String       @db.VarChar(50)
  provider         RateProvider
  avgRate          Decimal      @db.Decimal(10, 2)
  lowRate          Decimal      @db.Decimal(10, 2)
  highRate         Decimal      @db.Decimal(10, 2)
  loadVolume       Int?
  truckVolume      Int?
  loadToTruckRatio Decimal?     @db.Decimal(5, 2)
  weekStartDate    DateTime     @db.Date
  externalId       String?      @db.VarChar(255)
  sourceSystem     String?      @db.VarChar(100)
  customFields     Json         @default("{}")
  createdAt        DateTime     @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  createdById      String?
  updatedById      String?
  tenant           Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, originState, destState, equipmentType, weekStartDate, provider])
  @@index([destState])
  @@index([equipmentType])
  @@index([externalId, sourceSystem])
  @@index([originState])
  @@index([provider])
  @@index([tenantId])
  @@index([weekStartDate])
}

model RateLimit {
  id              String         @id @default(uuid())
  tenantId        String?
  scope           RateLimitScope
  identifier      String         @db.VarChar(255)
  maxRequests     Int
  windowSeconds   Int
  currentRequests Int            @default(0)
  windowStartsAt  DateTime       @default(now())
  externalId      String?        @db.VarChar(255)
  sourceSystem    String?        @db.VarChar(100)
  customFields    Json           @default("{}")
  createdAt       DateTime       @default(now())
  updatedAt       DateTime @updatedAt
  deletedAt       DateTime?
  createdById     String?
  updatedById     String?
  Tenant          Tenant?        @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([scope, identifier])
  @@index([externalId, sourceSystem])
  @@index([identifier])
  @@index([scope])
  @@index([tenantId])
  @@index([windowStartsAt])
}

model RateProviderConfig {
  id                String       @id @default(uuid())
  tenantId          String
  provider          RateProvider
  apiKey            String?      @db.VarChar(500)
  apiSecret         String?      @db.VarChar(500)
  apiEndpoint       String?      @db.VarChar(500)
  username          String?      @db.VarChar(255)
  password          String?      @db.VarChar(500)
  isActive          Boolean      @default(true)
  rateLimitPerHour  Int?
  cacheDurationMins Int          @default(60)
  queriesThisMonth  Int          @default(0)
  lastQueryAt       DateTime?
  externalId        String?      @db.VarChar(255)
  sourceSystem      String?      @db.VarChar(100)
  customFields      Json         @default("{}")
  createdAt         DateTime     @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  tenant            Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, provider])
  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([provider])
  @@index([tenantId])
}

model RateQuery {
  id            String       @id @default(uuid())
  tenantId      String
  originCity    String       @db.VarChar(100)
  originState   String       @db.VarChar(2)
  originZip     String?      @db.VarChar(10)
  destCity      String       @db.VarChar(100)
  destState     String       @db.VarChar(2)
  destZip       String?      @db.VarChar(10)
  equipmentType String       @db.VarChar(50)
  provider      RateProvider
  lowRate       Decimal?     @db.Decimal(10, 2)
  highRate      Decimal?     @db.Decimal(10, 2)
  avgRate       Decimal?     @db.Decimal(10, 2)
  confidence    String?      @db.VarChar(50)
  loadVolume    Int?
  truckVolume   Int?
  marketTrend   String?      @db.VarChar(50)
  queryHash     String       @db.VarChar(64)
  cachedUntil   DateTime
  externalId    String?      @db.VarChar(255)
  sourceSystem  String?      @db.VarChar(100)
  customFields  Json         @default("{}")
  createdAt     DateTime     @default(now())
  updatedAt     DateTime @updatedAt
  deletedAt     DateTime?
  createdById   String?
  updatedById   String?
  tenant        Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, queryHash])
  @@index([cachedUntil])
  @@index([createdAt])
  @@index([destState])
  @@index([equipmentType])
  @@index([externalId, sourceSystem])
  @@index([originState])
  @@index([provider])
  @@index([tenantId])
}

model Reminder {
  id                   String         @id @default(uuid())
  tenantId             String
  userId               String
  reminderType         String?        @db.VarChar(100)
  title                String         @db.VarChar(255)
  message              String?
  remindAt             DateTime       @db.Timestamp(6)
  entityType           String?        @db.VarChar(50)
  entityId             String?        @db.VarChar(255)
  status               ReminderStatus @default(PENDING)
  snoozedUntil         DateTime?      @db.Timestamp(6)
  sentAt               DateTime?
  externalId           String?        @db.VarChar(255)
  sourceSystem         String?        @db.VarChar(100)
  customFields         Json           @default("{}")
  createdAt            DateTime       @default(now())
  updatedAt            DateTime @updatedAt
  deletedAt            DateTime?
  createdById          String?
  updatedById          String?
  completedAt          DateTime?
  description          String?
  dismissedAt          DateTime?
  isRecurring          Boolean        @default(false)
  notificationChannels Json           @default("[\"in_app\"]")
  recurrenceEndDate    DateTime?
  recurrenceRule       String?        @db.VarChar(255)
  referenceId          String?        @db.VarChar(255)
  referenceType        String?        @db.VarChar(50)
  referenceUrl         String?        @db.VarChar(500)
  snoozeCount          Int            @default(0)
  timezone             String?        @db.VarChar(100)
  tenant               Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User?              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([referenceType, referenceId])
  @@index([remindAt])
  @@index([status])
  @@index([tenantId])
  @@index([userId])
}

model Report {
  id                 String            @id @default(uuid())
  tenantId           String
  name               String            @db.VarChar(255)
  description        String?
  reportType         ReportType
  sourceQuery        String
  parameters         Json              @default("[]")
  outputFormat       OutputFormat      @default(PDF)
  isScheduled        Boolean           @default(false)
  scheduleExpression String?           @db.VarChar(255)
  isPublic           Boolean           @default(false)
  ownerId            String?
  status             String            @default("ACTIVE") @db.VarChar(50)
  externalId         String?           @db.VarChar(255)
  sourceSystem       String?           @db.VarChar(100)
  customFields       Json              @default("{}")
  createdAt          DateTime          @default(now())
  updatedAt          DateTime @updatedAt
  deletedAt          DateTime?
  createdById        String?
  updatedById        String?
  tenant             Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  reportExecutions ReportExecution[]

  @@index([externalId, sourceSystem])
  @@index([ownerId])
  @@index([reportType])
  @@index([status])
  @@index([tenantId])
}

model ReportExecution {
  id              String          @id @default(uuid())
  tenantId        String
  reportId        String?
  templateId      String?
  executedAt      DateTime        @default(now())
  parametersUsed  Json            @default("{}")
  status          ExecutionStatus @default(PENDING)
  outputFileUrl   String?         @db.VarChar(500)
  executionTimeMs Int?
  rowCount        Int?
  errorMessage    String?
  externalId      String?         @db.VarChar(255)
  sourceSystem    String?         @db.VarChar(100)
  customFields    Json            @default("{}")
  createdAt       DateTime        @default(now())
  updatedAt       DateTime @updatedAt
  deletedAt       DateTime?
  createdById     String?
  updatedById     String?
  report          Report?         @relation(fields: [reportId], references: [id])
  template  ReportTemplate? @relation(fields: [templateId], references: [id])
  tenant          Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([executedAt])
  @@index([externalId, sourceSystem])
  @@index([reportId])
  @@index([status])
  @@index([templateId])
  @@index([tenantId])
}

model ReportTemplate {
  id                   String            @id @default(uuid())
  tenantId             String
  templateName         String            @db.VarChar(255)
  reportType           String            @db.VarChar(100)
  description          String?
  queryTemplate        String
  parameterDefinitions Json              @default("[]")
  scheduleConfig       Json?             @default("{}")
  isActive             Boolean           @default(true)
  externalId           String?           @db.VarChar(255)
  sourceSystem         String?           @db.VarChar(100)
  customFields         Json              @default("{}")
  createdAt            DateTime          @default(now())
  updatedAt            DateTime @updatedAt
  deletedAt            DateTime?
  createdById          String?
  updatedById          String?
  reportExecutions ReportExecution[]
  tenant               Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([reportType])
  @@index([tenantId])
}

model Role {
  id           String    @id @default(uuid())
  tenantId     String?
  name         String    @db.VarChar(100)
  description  String?
  permissions  Json      @default("[]")
  isSystem     Boolean   @default(false)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  customFields Json      @default("{}")
  externalId   String?   @db.VarChar(255)
  sourceSystem String?   @db.VarChar(100)
  updatedById  String?
  Tenant       Tenant?   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  User         User[]

  @@unique([tenantId, name])
  @@index([isSystem])
  @@index([tenantId])
}

model SafetyAlert {
  id                String          @id @default(uuid())
  tenantId          String
  carrierId         String?
  alertType         SafetyAlertType
  alertMessage      String
  severity          String          @db.VarChar(50)
  relatedEntityType String?         @db.VarChar(50)
  relatedEntityId   String?
  isActive          Boolean         @default(true)
  acknowledgedAt    DateTime?
  acknowledgedById  String?
  resolvedAt        DateTime?
  resolvedById      String?
  resolutionNotes   String?
  externalId        String?         @db.VarChar(255)
  sourceSystem      String?         @db.VarChar(100)
  customFields      Json            @default("{}")
  createdAt         DateTime        @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id])
  tenant            Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([alertType])
  @@index([carrierId])
  @@index([createdAt])
  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([severity])
  @@index([tenantId])
}

model SafetyAuditTrail {
  id               String    @id @default(uuid())
  tenantId         String
  carrierId        String?
  eventType        String    @db.VarChar(100)
  eventDescription String
  eventData        Json?
  performedById    String?
  externalId       String?   @db.VarChar(255)
  sourceSystem     String?   @db.VarChar(100)
  customFields     Json      @default("{}")
  createdAt        DateTime  @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  createdById      String?
  updatedById      String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id])
  tenant           Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([carrierId])
  @@index([createdAt])
  @@index([eventType])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
}

model SafetyIncident {
  id                 String             @id @default(uuid())
  tenantId           String
  carrierId          String?
  driverId           String?
  loadId             String?
  incidentType       SafetyIncidentType
  incidentDate       DateTime           @db.Date
  location           String?            @db.VarChar(500)
  description        String
  severity           String?            @db.VarChar(50)
  injuriesCount      Int                @default(0)
  fatalitiesCount    Int                @default(0)
  wasOutOfService    Boolean            @default(false)
  oosReason          String?
  citationNumber     String?            @db.VarChar(100)
  violationCodes     Json?
  fineAmount         Decimal?           @db.Decimal(10, 2)
  investigationNotes String?
  reportUrl          String?            @db.VarChar(500)
  csaPoints          Decimal?           @db.Decimal(5, 2)
  externalId         String?            @db.VarChar(255)
  sourceSystem       String?            @db.VarChar(100)
  customFields       Json               @default("{}")
  createdAt          DateTime           @default(now())
  updatedAt          DateTime @updatedAt
  deletedAt          DateTime?
  createdById        String?
  updatedById        String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id])
  driver             Driver?            @relation(fields: [driverId], references: [id])
  load               Load?              @relation(fields: [loadId], references: [id])
  tenant             Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([carrierId])
  @@index([driverId])
  @@index([externalId, sourceSystem])
  @@index([incidentDate])
  @@index([incidentType])
  @@index([loadId])
  @@index([severity])
  @@index([tenantId])
}

model SafetyInspection {
  id                 String    @id @default(uuid())
  tenantId           String
  carrierId          String?
  driverId           String?
  inspectionNumber   String    @db.VarChar(100)
  inspectionDate     DateTime  @db.Date
  inspectionLevel    Int?
  inspectionState    String?   @db.VarChar(2)
  inspectionLocation String?   @db.VarChar(500)
  totalViolations    Int       @default(0)
  oosViolations      Int       @default(0)
  wasOutOfService    Boolean   @default(false)
  violations         Json?
  basicsAffected     Json?
  reportNumber       String?   @db.VarChar(100)
  reportUrl          String?   @db.VarChar(500)
  externalId         String?   @db.VarChar(255)
  sourceSystem       String?   @db.VarChar(100)
  customFields       Json      @default("{}")
  createdAt          DateTime  @default(now())
  updatedAt          DateTime @updatedAt
  deletedAt          DateTime?
  createdById        String?
  updatedById        String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id])
  driver             Driver?   @relation(fields: [driverId], references: [id])
  tenant             Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, inspectionNumber])
  @@index([carrierId])
  @@index([driverId])
  @@index([externalId, sourceSystem])
  @@index([inspectionDate])
  @@index([tenantId])
  @@index([wasOutOfService])
}

model SalesQuota {
  id                 String    @id @default(uuid())
  tenantId           String
  userId             String
  periodType         String    @db.VarChar(20)
  periodStart        DateTime
  periodEnd          DateTime
  revenueTarget      Decimal?  @db.Decimal(14, 2)
  loadsTarget        Int?
  newCustomersTarget Int?
  revenueActual      Decimal   @default(0) @db.Decimal(14, 2)
  loadsActual        Int       @default(0)
  newCustomersActual Int       @default(0)
  status             String    @default("ACTIVE") @db.VarChar(50)
  createdAt          DateTime  @default(now())
  updatedAt          DateTime @updatedAt
  createdById        String?
  customFields       Json      @default("{}")
  deletedAt          DateTime?
  externalId         String?   @db.VarChar(255)
  sourceSystem       String?   @db.VarChar(100)
  updatedById        String?
  tenant             Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User?              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([tenantId, userId, periodStart])
  @@index([periodStart, periodEnd])
  @@index([tenantId])
  @@index([userId])
}

model SavedAnalyticsView {
  id           String    @id @default(uuid())
  tenantId     String
  userId       String
  viewName     String    @db.VarChar(255)
  entityType   String    @db.VarChar(100)
  filters      Json      @default("[]")
  columns      Json      @default("[]")
  sortOrder    Json      @default("[]")
  isPublic     Boolean   @default(false)
  externalId   String?   @db.VarChar(255)
  sourceSystem String?   @db.VarChar(100)
  customFields Json      @default("{}")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User?              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([entityType])
  @@index([externalId, sourceSystem])
  @@index([isPublic])
  @@index([tenantId])
  @@index([userId])
}

model SavedSearch {
  id           String           @id @default(uuid())
  tenantId     String
  userId       String
  name         String           @db.VarChar(255)
  description  String?
  entityType   SearchEntityType
  query        Json
  filters      Json             @default("{}")
  isPublic     Boolean          @default(false)
  externalId   String?          @db.VarChar(255)
  sourceSystem String?          @db.VarChar(100)
  customFields Json             @default("{}")
  createdAt    DateTime         @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  tenant       Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([entityType])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
  @@index([userId])
}

model ScheduledJob {
  id                                                       String          @id @default(uuid())
  tenantId                                                 String?
  name                                                     String          @db.VarChar(255)
  description                                              String?
  jobType                                                  JobType
  scheduleType                                             ScheduleType
  cronExpression                                           String?         @db.VarChar(255)
  intervalMinutes                                          Int?
  scheduledAt                                              DateTime?
  handlerName                                              String?         @db.VarChar(255)
  parameters                                               Json            @default("{}")
  timeoutMinutes                                           Int?
  retryAttempts                                            Int?
  status                                                   String          @default("ACTIVE") @db.VarChar(50)
  lastRunAt                                                DateTime?
  lastRunStatus                                            String?         @db.VarChar(50)
  nextRunAt                                                DateTime?
  externalId                                               String?         @db.VarChar(255)
  sourceSystem                                             String?         @db.VarChar(100)
  customFields                                             Json            @default("{}")
  createdAt                                                DateTime        @default(now())
  updatedAt                                                DateTime @updatedAt
  deletedAt                                                DateTime?
  createdById                                              String?
  updatedById                                              String?
  allowConcurrent                                          Boolean         @default(false)
  code                                                     String?         @db.VarChar(100)
  failureCount                                             Int             @default(0)
  handler                                                  String          @default("noop") @db.VarChar(255)
  intervalSeconds                                          Int?
  isEnabled                                                Boolean         @default(true)
  lastRunDurationMs                                        Int?
  maxInstances                                             Int             @default(1)
  maxRetries                                               Int             @default(3)
  priority                                                 Int             @default(5)
  queue                                                    String          @default("default") @db.VarChar(100)
  retryDelaySeconds                                        Int             @default(60)
  runAt                                                    DateTime?
  runCount                                                 Int             @default(0)
  timeoutSeconds                                           Int             @default(300)
  timezone                                                 String          @default("UTC") @db.VarChar(100)
  JobAlert                                                 JobAlert[]
  JobDependency_JobDependency_dependsOnJobIdToScheduledJob JobDependency[] @relation("JobDependency_dependsOnJobIdToScheduledJob")
  JobDependency_JobDependency_jobIdToScheduledJob          JobDependency[] @relation("JobDependency_jobIdToScheduledJob")
  JobExecution                                             JobExecution[]
  JobLock                                                  JobLock?
  Tenant                                                   Tenant?         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, code])
  @@index([externalId, sourceSystem])
  @@index([jobType])
  @@index([nextRunAt])
  @@index([queue, priority])
  @@index([status])
  @@index([tenantId])
}

model ScheduledTask {
  id             String     @id @default(uuid())
  tenantId       String
  taskName       String?    @db.VarChar(255)
  taskType       String     @db.VarChar(100)
  scheduledFor   DateTime?  @db.Timestamp(6)
  entityType     String?    @db.VarChar(50)
  entityId       String?    @db.VarChar(255)
  taskData       Json?
  status         TaskStatus @default(PENDING)
  completedAt    DateTime?
  externalId     String?    @db.VarChar(255)
  sourceSystem   String?    @db.VarChar(100)
  customFields   Json       @default("{}")
  createdAt      DateTime   @default(now())
  updatedAt      DateTime @updatedAt
  deletedAt      DateTime?
  createdById    String?
  updatedById    String?
  errorMessage   String?
  handler        String     @db.VarChar(255)
  payload        Json       @default("{}")
  priority       Int        @default(5)
  processedAt    DateTime?
  referenceId    String?    @db.VarChar(255)
  referenceType  String?    @db.VarChar(50)
  scheduledAt    DateTime   @db.Timestamp(6)
  timeoutSeconds Int        @default(60)
  timezone       String     @default("UTC") @db.VarChar(100)
  tenant         Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([referenceType, referenceId])
  @@index([scheduledAt, status])
  @@index([status])
  @@index([taskType])
  @@index([tenantId])
}

model ScheduledWorkflowRun {
  id                 String    @id @default(uuid())
  tenantId           String
  workflowId         String
  scheduleExpression String    @db.VarChar(255)
  lastRunAt          DateTime?
  nextRunAt          DateTime? @db.Timestamp(6)
  isActive           Boolean   @default(true)
  externalId         String?   @db.VarChar(255)
  sourceSystem       String?   @db.VarChar(100)
  customFields       Json      @default("{}")
  createdAt          DateTime  @default(now())
  updatedAt          DateTime @updatedAt
  deletedAt          DateTime?
  createdById        String?
  updatedById        String?
  tenant             Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  workflow           Workflow  @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([nextRunAt])
  @@index([tenantId])
  @@index([workflowId])
}

model SearchHistory {
  id           String           @id @default(uuid())
  tenantId     String
  userId       String
  entityType   SearchEntityType
  searchTerm   String           @db.VarChar(500)
  resultCount  Int              @default(0)
  externalId   String?          @db.VarChar(255)
  sourceSystem String?          @db.VarChar(100)
  customFields Json             @default("{}")
  createdAt    DateTime         @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  tenant       Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([entityType])
  @@index([externalId, sourceSystem])
  @@index([searchTerm])
  @@index([tenantId])
  @@index([userId])
}

model SearchIndex {
  id            String    @id @default(uuid())
  tenantId      String
  entityType    String    @db.VarChar(100)
  indexName     String    @db.VarChar(255)
  fieldsIndexed Json      @default("[]")
  lastUpdated   DateTime  @default(now())
  documentCount Int       @default(0)
  status        String    @default("ACTIVE") @db.VarChar(50)
  externalId    String?   @db.VarChar(255)
  sourceSystem  String?   @db.VarChar(100)
  customFields  Json      @default("{}")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime @updatedAt
  deletedAt     DateTime?
  createdById   String?
  updatedById   String?
  tenant        Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, entityType])
  @@index([entityType])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId])
}

model SearchIndexQueue {
  id           String         @id @default(uuid())
  tenantId     String
  entityType   String         @db.VarChar(100)
  entityId     String         @db.VarChar(255)
  operation    IndexOperation
  priority     Int            @default(5)
  processedAt  DateTime?
  retryCount   Int            @default(0)
  lastError    String?
  externalId   String?        @db.VarChar(255)
  sourceSystem String?        @db.VarChar(100)
  customFields Json           @default("{}")
  createdAt    DateTime       @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  tenant       Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([entityType, entityId])
  @@index([externalId, sourceSystem])
  @@index([operation])
  @@index([priority])
  @@index([processedAt])
  @@index([tenantId])
}

model SearchSuggestion {
  id             String    @id @default(uuid())
  tenantId       String
  entityType     String    @db.VarChar(100)
  suggestionText String    @db.VarChar(255)
  frequency      Int       @default(1)
  lastUsed       DateTime  @default(now())
  isActive       Boolean   @default(true)
  externalId     String?   @db.VarChar(255)
  sourceSystem   String?   @db.VarChar(100)
  customFields   Json      @default("{}")
  createdAt      DateTime  @default(now())
  updatedAt      DateTime @updatedAt
  deletedAt      DateTime?
  createdById    String?
  updatedById    String?
  tenant         Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([entityType])
  @@index([externalId, sourceSystem])
  @@index([frequency])
  @@index([isActive])
  @@index([suggestionText])
  @@index([tenantId])
}

model SearchSynonym {
  id            String    @id @default(uuid())
  tenantId      String
  term          String    @db.VarChar(255)
  synonymsArray Json      @default("[]")
  entityType    String?   @db.VarChar(100)
  isActive      Boolean   @default(true)
  externalId    String?   @db.VarChar(255)
  sourceSystem  String?   @db.VarChar(100)
  customFields  Json      @default("{}")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime @updatedAt
  deletedAt     DateTime?
  createdById   String?
  updatedById   String?
  tenant        Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([entityType])
  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([tenantId])
  @@index([term])
}

model Session {
  id               String    @id @default(uuid())
  userId           String
  refreshTokenHash String    @db.VarChar(255)
  userAgent        String?
  ipAddress        String?   @db.VarChar(45)
  expiresAt        DateTime
  revokedAt        DateTime?
  createdAt        DateTime  @default(now())
  externalId       String?   @db.VarChar(255)
  sourceSystem     String?   @db.VarChar(100)
  tenantId         String?
  updatedAt        DateTime? @updatedAt
  Tenant           Tenant?   @relation(fields: [tenantId], references: [id])
  user                User?              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([refreshTokenHash])
  @@index([userId])
}

model Settlement {
  id                                                         String                     @id @default(uuid())
  tenantId                                                   String
  settlementNumber                                           String                     @db.VarChar(50)
  carrierId                                                  String
  externalId                                                 String?                    @db.VarChar(255)
  sourceSystem                                               String?                    @db.VarChar(100)
  quickbooksId                                               String?                    @db.VarChar(50)
  settlementDate                                             DateTime
  dueDate                                                    DateTime
  paymentType                                                String?                    @db.VarChar(50)
  quickPayFeePercent                                         Decimal?                   @db.Decimal(5, 2)
  quickPayFeeAmount                                          Decimal?                   @db.Decimal(12, 2)
  grossAmount                                                Decimal                    @db.Decimal(12, 2)
  deductionsTotal                                            Decimal                    @default(0) @db.Decimal(12, 2)
  quickPayFee                                                Decimal                    @default(0) @db.Decimal(12, 2)
  netAmount                                                  Decimal                    @db.Decimal(12, 2)
  amountPaid                                                 Decimal                    @default(0) @db.Decimal(12, 2)
  balanceDue                                                 Decimal                    @db.Decimal(12, 2)
  currency                                                   String                     @default("USD") @db.VarChar(3)
  status                                                     String                     @default("DRAFT") @db.VarChar(50)
  paymentMethod                                              String?                    @db.VarChar(50)
  payToName                                                  String?                    @db.VarChar(255)
  payToFactoring                                             Boolean                    @default(false)
  factoringCompanyId                                         String?
  factoringAccount                                           String?                    @db.VarChar(100)
  expenseAccountId                                           String?
  apAccountId                                                String?
  approvedById                                               String?
  approvedAt                                                 DateTime?
  notes                                                      String?
  internalNotes                                              String?
  createdAt                                                  DateTime                   @default(now())
  updatedAt                                                  DateTime @updatedAt
  createdById                                                String?
  updatedById                                                String?
  customFields                                               Json                       @default("{}")
  deletedAt                                                  DateTime?
  CarrierInvoiceSubmission                                   CarrierInvoiceSubmission[]
  FactoredPayment                                            FactoredPayment[]
  ChartOfAccount_Settlement_apAccountIdToChartOfAccount      ChartOfAccount?            @relation("Settlement_apAccountIdToChartOfAccount", fields: [apAccountId], references: [id])
  carrier             Carrier?           @relation(fields: [carrierId], references: [id])
  ChartOfAccount_Settlement_expenseAccountIdToChartOfAccount ChartOfAccount?            @relation("Settlement_expenseAccountIdToChartOfAccount", fields: [expenseAccountId], references: [id])
  tenant                                                     Tenant                     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  lineItems                                                  SettlementLineItem[]

  @@unique([tenantId, settlementNumber])
  @@index([carrierId])
  @@index([dueDate])
  @@index([externalId, sourceSystem])
  @@index([settlementDate])
  @@index([status])
  @@index([tenantId])
}

model SettlementLineItem {
  id               String          @id @default(uuid())
  settlementId     String
  loadId           String?
  lineNumber       Int
  description      String          @db.VarChar(500)
  itemType         String?         @db.VarChar(50)
  quantity         Decimal         @default(1) @db.Decimal(10, 2)
  unitRate         Decimal         @db.Decimal(12, 2)
  amount           Decimal         @db.Decimal(12, 2)
  expenseAccountId String?
  createdAt        DateTime        @default(now())
  createdById      String?
  customFields     Json            @default("{}")
  deletedAt        DateTime?
  externalId       String?         @db.VarChar(255)
  sourceSystem     String?         @db.VarChar(100)
  tenantId         String
  updatedAt        DateTime @updatedAt
  updatedById      String?
  parentAccount   ChartOfAccount?     @relation(fields: [expenseAccountId], references: [id])
  load             Load?              @relation(fields: [loadId], references: [id])
  settlement       Settlement      @relation(fields: [settlementId], references: [id], onDelete: Cascade)
  tenant           Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([settlementId, lineNumber])
  @@index([externalId, sourceSystem])
  @@index([loadId])
  @@index([settlementId])
  @@index([tenantId])
}

model SlaPolicy {
  id                  String    @id @default(uuid())
  tenantId            String
  name                String    @db.VarChar(100)
  description         String?
  conditions          Json
  firstResponseTarget Int
  resolutionTarget    Int
  useBusinessHours    Boolean   @default(true)
  priority            Int       @default(0)
  isActive            Boolean   @default(true)
  externalId          String?   @db.VarChar(255)
  sourceSystem        String?   @db.VarChar(100)
  customFields        Json      @default("{}")
  createdAt           DateTime  @default(now())
  updatedAt           DateTime @updatedAt
  deletedAt           DateTime?
  createdById         String?
  updatedById         String?
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([priority])
  @@index([tenantId])
}

model SmsConversation {
  id                 String       @id @default(uuid())
  tenantId           String
  phoneNumber        String       @db.VarChar(50)
  participantType    String?      @db.VarChar(50)
  participantId      String?
  participantName    String?      @db.VarChar(255)
  loadId             String?
  status             String       @default("ACTIVE") @db.VarChar(50)
  unreadCount        Int          @default(0)
  lastMessageAt      DateTime?
  lastMessagePreview String?      @db.VarChar(255)
  createdAt          DateTime     @default(now())
  updatedAt          DateTime @updatedAt
  createdById        String?
  customFields       Json         @default("{}")
  deletedAt          DateTime?
  externalId         String?      @db.VarChar(255)
  sourceSystem       String?      @db.VarChar(100)
  updatedById        String?
  tenant             Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  messages SmsMessage[]

  @@unique([tenantId, phoneNumber, loadId])
  @@index([externalId, sourceSystem])
  @@index([loadId])
  @@index([participantType, participantId])
  @@index([phoneNumber])
  @@index([tenantId])
}

model SmsMessage {
  id                String          @id @default(uuid())
  conversationId    String
  direction         String          @db.VarChar(20)
  body              String
  mediaUrls         Json?
  status            String          @default("PENDING") @db.VarChar(50)
  providerMessageId String?         @db.VarChar(255)
  errorMessage      String?
  sentAt            DateTime?
  deliveredAt       DateTime?
  receivedAt        DateTime?
  readAt            DateTime?
  createdAt         DateTime        @default(now())
  createdById       String?
  customFields      Json            @default("{}")
  deletedAt         DateTime?
  externalId        String?         @db.VarChar(255)
  sourceSystem      String?         @db.VarChar(100)
  updatedAt         DateTime @updatedAt
  updatedById       String?
  conversation   SmsConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([createdAt])
  @@index([direction])
  @@index([externalId, sourceSystem])
  @@index([status])
}

model StatusHistory {
  id           String    @id @default(uuid())
  tenantId     String
  entityType   String    @db.VarChar(20)
  entityId     String
  oldStatus    String?   @db.VarChar(30)
  newStatus    String    @db.VarChar(30)
  notes        String?
  createdAt    DateTime  @default(now())
  createdById  String?
  loadId       String?
  orderId      String?
  stopId       String?
  customFields Json      @default("{}")
  deletedAt    DateTime?
  externalId   String?   @db.VarChar(255)
  sourceSystem String?   @db.VarChar(100)
  updatedAt    DateTime @updatedAt
  updatedById  String?
  load         Load?              @relation(fields: [loadId], references: [id])
  order               Order?             @relation(fields: [orderId], references: [id])
  stop         Stop?     @relation(fields: [stopId], references: [id])
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([entityType, entityId])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
}

model StepExecution {
  id                  String            @id @default(uuid())
  tenantId            String
  workflowExecutionId String
  workflowStepId      String
  startedAt           DateTime          @default(now())
  completedAt         DateTime?
  status              ExecutionStatus   @default(PENDING)
  inputData           Json              @default("{}")
  outputData          Json?             @default("{}")
  errorMessage        String?
  retryCount          Int               @default(0)
  externalId          String?           @db.VarChar(255)
  sourceSystem        String?           @db.VarChar(100)
  customFields        Json              @default("{}")
  createdAt           DateTime          @default(now())
  updatedAt           DateTime @updatedAt
  deletedAt           DateTime?
  createdById         String?
  updatedById         String?
  tenant              Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  workflowExecution   WorkflowExecution @relation(fields: [workflowExecutionId], references: [id], onDelete: Cascade)
  workflowStep        WorkflowStep      @relation(fields: [workflowStepId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([startedAt])
  @@index([status])
  @@index([tenantId])
  @@index([workflowExecutionId])
  @@index([workflowStepId])
}

model Stop {
  id                   String          @id @default(uuid())
  tenantId             String
  orderId              String
  loadId               String?
  stopType             String          @db.VarChar(20)
  stopSequence         Int
  facilityName         String?         @db.VarChar(255)
  addressLine1         String          @db.VarChar(255)
  addressLine2         String?         @db.VarChar(255)
  city                 String          @db.VarChar(100)
  state                String          @db.VarChar(50)
  postalCode           String          @db.VarChar(20)
  country              String          @default("USA") @db.VarChar(50)
  latitude             Decimal?        @db.Decimal(10, 7)
  longitude            Decimal?        @db.Decimal(10, 7)
  contactName          String?         @db.VarChar(100)
  contactPhone         String?         @db.VarChar(20)
  contactEmail         String?         @db.VarChar(255)
  appointmentRequired  Boolean         @default(false)
  appointmentDate      DateTime?
  appointmentTimeStart String?         @db.VarChar(10)
  appointmentTimeEnd   String?         @db.VarChar(10)
  appointmentNumber    String?         @db.VarChar(50)
  status               String          @default("PENDING") @db.VarChar(20)
  arrivedAt            DateTime?
  departedAt           DateTime?
  weightLbs            Decimal?        @db.Decimal(10, 2)
  pieceCount           Int?
  palletCount          Int?
  specialInstructions  String?
  driverInstructions   String?
  accessorials         Json            @default("[]")
  externalId           String?         @db.VarChar(255)
  sourceSystem         String?         @db.VarChar(100)
  customFields         Json            @default("{}")
  createdAt            DateTime        @default(now())
  updatedAt            DateTime @updatedAt
  createdById          String?
  deletedAt            DateTime?
  updatedById          String?
  OrderItem            OrderItem[]
  StatusHistory        StatusHistory[]
  load                 Load?              @relation(fields: [loadId], references: [id])
  order               Order?             @relation(fields: [orderId], references: [id], onDelete: Cascade)
  tenant               Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([orderId, stopSequence])
  @@index([externalId, sourceSystem])
  @@index([loadId])
  @@index([orderId])
  @@index([status])
  @@index([tenantId])
}

model SubrogationRecord {
  id               String            @id @default(uuid())
  tenantId         String
  claimId          String
  targetParty      String            @db.VarChar(255)
  targetPartyType  String            @db.VarChar(100)
  amountSought     Decimal           @db.Decimal(12, 2)
  amountRecovered  Decimal           @default(0) @db.Decimal(12, 2)
  status           SubrogationStatus @default(PENDING)
  attorneyName     String?           @db.VarChar(255)
  attorneyFirm     String?           @db.VarChar(255)
  caseNumber       String?           @db.VarChar(100)
  filingDate       DateTime?         @db.Date
  settlementDate   DateTime?         @db.Date
  settlementAmount Decimal?          @db.Decimal(12, 2)
  closedDate       DateTime?         @db.Date
  closureReason    String?
  externalId       String?           @db.VarChar(255)
  sourceSystem     String?           @db.VarChar(100)
  customFields     Json              @default("{}")
  createdAt        DateTime          @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  createdById      String?
  updatedById      String?
  claim            Claim             @relation(fields: [claimId], references: [id], onDelete: Cascade)
  tenant           Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([claimId])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([targetPartyType])
  @@index([tenantId])
}

model SupportTeam {
  id                String              @id @default(uuid())
  tenantId          String
  name              String              @db.VarChar(100)
  description       String?
  email             String?             @db.VarChar(255)
  autoAssign        Boolean             @default(false)
  assignmentMethod  String              @default("ROUND_ROBIN") @db.VarChar(20)
  managerId         String?
  isActive          Boolean             @default(true)
  externalId        String?             @db.VarChar(255)
  sourceSystem      String?             @db.VarChar(100)
  customFields      Json                @default("{}")
  createdAt         DateTime            @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  tenant            Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  SupportTeamMember SupportTeamMember[]

  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([tenantId])
}

model SupportTeamMember {
  id                 String      @id @default(uuid())
  teamId             String
  userId             String
  role               String      @default("MEMBER") @db.VarChar(20)
  maxOpenTickets     Int         @default(20)
  currentTicketCount Int         @default(0)
  isAvailable        Boolean     @default(true)
  externalId         String?     @db.VarChar(255)
  sourceSystem       String?     @db.VarChar(100)
  customFields       Json        @default("{}")
  createdAt          DateTime    @default(now())
  updatedAt          DateTime @updatedAt
  deletedAt          DateTime?
  createdById        String?
  updatedById        String?
  team        SupportTeam @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([teamId, userId])
  @@index([externalId, sourceSystem])
  @@index([isAvailable])
  @@index([teamId])
  @@index([userId])
}

model SupportTicket {
  id                  String         @id @default(uuid())
  tenantId            String
  ticketNumber        String         @unique @db.VarChar(50)
  subject             String         @db.VarChar(500)
  description         String
  source              TicketSource
  type                TicketType
  priority            TicketPriority @default(NORMAL)
  status              TicketStatus   @default(NEW)
  requesterId         String?
  requesterName       String?        @db.VarChar(255)
  requesterEmail      String?        @db.VarChar(255)
  assignedToId        String?
  teamId              String?
  firstResponseDue    DateTime?
  resolutionDue       DateTime?
  firstRespondedAt    DateTime?
  resolvedAt          DateTime?
  resolvedBy          String?
  resolutionNotes     String?
  satisfactionRating  Int?
  satisfactionComment String?
  externalId          String?        @db.VarChar(255)
  sourceSystem        String?        @db.VarChar(100)
  customFields        Json           @default("{}")
  createdAt           DateTime       @default(now())
  updatedAt           DateTime @updatedAt
  deletedAt           DateTime?
  createdById         String?
  updatedById         String?
  tenant              Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  TicketReply         TicketReply[]

  @@index([assignedToId])
  @@index([createdAt])
  @@index([externalId, sourceSystem])
  @@index([priority])
  @@index([status])
  @@index([tenantId])
  @@index([ticketNumber])
}

model Survey {
  id                  String           @id @default(uuid())
  tenantId            String
  title               String           @db.VarChar(300)
  description         String?
  surveyType          String           @db.VarChar(30)
  questions           Json
  anonymous           Boolean          @default(false)
  requireAllQuestions Boolean          @default(false)
  showProgress        Boolean          @default(true)
  thankYouMessage     String?
  redirectUrl         String?          @db.VarChar(500)
  triggerEvent        String?          @db.VarChar(100)
  targetSegment       Json?
  status              String           @default("DRAFT") @db.VarChar(20)
  startDate           DateTime?
  endDate             DateTime?
  sentCount           Int              @default(0)
  responseCount       Int              @default(0)
  externalId          String?          @db.VarChar(255)
  sourceSystem        String?          @db.VarChar(100)
  customFields        Json             @default("{}")
  createdAt           DateTime         @default(now())
  updatedAt           DateTime @updatedAt
  deletedAt           DateTime?
  createdById         String?
  updatedById         String?
  tenant              Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  SurveyResponse      SurveyResponse[]

  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([surveyType])
  @@index([tenantId])
}

model SurveyResponse {
  id                    String    @id @default(uuid())
  surveyId              String
  tenantId              String
  userId                String?
  respondentEmail       String?   @db.VarChar(255)
  answers               Json
  completionPercentage  Int       @default(100)
  timeToCompleteSeconds Int?
  responseChannel       String?   @db.VarChar(30)
  userAgent             String?
  externalId            String?   @db.VarChar(255)
  sourceSystem          String?   @db.VarChar(100)
  customFields          Json      @default("{}")
  createdAt             DateTime  @default(now())
  updatedAt             DateTime @updatedAt
  deletedAt             DateTime?
  createdById           String?
  updatedById           String?
  survey                Survey    @relation(fields: [surveyId], references: [id], onDelete: Cascade)
  tenant                Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([externalId, sourceSystem])
  @@index([surveyId])
  @@index([tenantId])
  @@index([userId])
}

model SyncJob {
  id               String          @id @default(uuid())
  tenantId         String
  integrationId    String
  jobType          String          @db.VarChar(100)
  direction        SyncDirection
  schedule         String?         @db.VarChar(255)
  lastSyncAt       DateTime?
  recordsProcessed Int?            @default(0)
  recordsFailed    Int?            @default(0)
  status           ExecutionStatus @default(PENDING)
  lastError        String?
  externalId       String?         @db.VarChar(255)
  sourceSystem     String?         @db.VarChar(100)
  customFields     Json            @default("{}")
  createdAt        DateTime        @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  createdById      String?
  updatedById      String?
  integration      Integration     @relation(fields: [integrationId], references: [id], onDelete: Cascade)
  tenant           Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([integrationId])
  @@index([lastSyncAt])
  @@index([status])
  @@index([tenantId])
}

model SystemConfig {
  id              String         @id @default(uuid())
  category        ConfigCategory
  key             String         @unique @db.VarChar(100)
  value           Json
  description     String?
  dataType        String         @db.VarChar(50)
  validationRules Json?
  externalId      String?        @db.VarChar(255)
  sourceSystem    String?        @db.VarChar(100)
  customFields    Json           @default("{}")
  createdAt       DateTime       @default(now())
  updatedAt       DateTime @updatedAt
  deletedAt       DateTime?
  createdById     String?
  updatedById     String?

  @@index([category])
  @@index([externalId, sourceSystem])
  @@index([key])
}

model Tenant {
  id                         String                       @id @default(uuid())
  name                       String                       @db.VarChar(255)
  slug                       String                       @unique @db.VarChar(255)
  domain                     String?                      @db.VarChar(255)
  settings                   Json                         @default("{}")
  features                   Json                         @default("{}")
  branding                   Json                         @default("{}")
  status                     String                       @default("ACTIVE") @db.VarChar(20)
  trialEndsAt                DateTime?
  subscriptionPlan           String?                      @db.VarChar(50)
  subscriptionStatus         String?                      @db.VarChar(20)
  externalId                 String?                      @db.VarChar(255)
  sourceSystem               String?                      @db.VarChar(100)
  customFields               Json                         @default("{}")
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime @updatedAt
  deletedAt                  DateTime?
  createdById                String?
  updatedById                String?
  APIAuditLog                APIAuditLog[]
  APIRequestLog              APIRequestLog[]
  AccessLog                  AccessLog[]
  AccessorialRate            AccessorialRate[]
  Activity                   Activity[]
  Agent                      Agent[]
  AgentAgreement             AgentAgreement[]
  commissions            AgentCommission[]
  AgentContact               AgentContact[]
  AgentCustomerAssignment    AgentCustomerAssignment[]
  AgentDrawBalance           AgentDrawBalance[]
  AgentLead                  AgentLead[]
  AgentPayout                AgentPayout[]
  AgentPortalUser            AgentPortalUser[]
  AnalyticsCache             AnalyticsCache[]
  ApprovalRequest            ApprovalRequest[]
  AuditAlert                 AuditAlert[]
  AuditAlertIncident         AuditAlertIncident[]
  AuditLog                   AuditLog[]
  AuditRetentionPolicy       AuditRetentionPolicy[]
  AuthorityChange            AuthorityChange[]
  BoardMetric                BoardMetric[]
  BusinessHours              BusinessHours[]
  CacheConfig                CacheConfig[]
  CacheInvalidationRule      CacheInvalidationRule[]
  CacheStats                 CacheStats[]
  CannedResponse             CannedResponse[]
  CapacityResult             CapacityResult[]
  CapacitySearch             CapacitySearch[]
  Carrier                    Carrier[]
  CarrierCapacity            CarrierCapacity[]
  contacts CarrierContact[]
  CarrierDocument            CarrierDocument[]
  CarrierFactoringStatus     CarrierFactoringStatus[]
  CarrierInsurance           CarrierInsurance[]
  CarrierInvoiceSubmission   CarrierInvoiceSubmission[]
  CarrierLoadView            CarrierLoadView[]
  CarrierPerformanceHistory  CarrierPerformanceHistory[]
  CarrierPortalActivityLog   CarrierPortalActivityLog[]
  CarrierPortalDocument      CarrierPortalDocument[]
  CarrierPortalNotification  CarrierPortalNotification[]
  CarrierPortalSession       CarrierPortalSession[]
  CarrierPortalUser          CarrierPortalUser[]
  CarrierQuickPayRequest     CarrierQuickPayRequest[]
  CarrierSavedLoad           CarrierSavedLoad[]
  CarrierWatchlist           CarrierWatchlist[]
  ChangeHistory              ChangeHistory[]
  ChartOfAccount             ChartOfAccount[]
  CheckCall                  CheckCall[]
  CircuitBreakerStateRecord  CircuitBreakerStateRecord[]
  Claim                      Claim[]
  ClaimAdjustment            ClaimAdjustment[]
  ClaimContact               ClaimContact[]
  documents ClaimDocument[]
  items ClaimItem[]
  notes ClaimNote[]
  timeline ClaimTimeline[]
  CollectionActivity         CollectionActivity[]
  CommissionEntry            CommissionEntry[]
  CommissionPayout           CommissionPayout[]
  CommissionPlan             CommissionPlan[]
  CommunicationLog           CommunicationLog[]
  CommunicationTemplate      CommunicationTemplate[]
  Company                    Company[]
  ComplianceCheckpoint       ComplianceCheckpoint[]
  ConfigHistory              ConfigHistory[]
  ConfigTemplate             ConfigTemplate[]
  Contact Contact[]
  Contract                   Contract[]
  ContractAmendment          ContractAmendment[]
  ContractClause             ContractClause[]
  laneRates           ContractLaneRate[]
  ContractMetric             ContractMetric[]
  ContractRateLane           ContractRateLane[]
  ContractRateTable          ContractRateTable[]
  ContractSLA                ContractSLA[]
  ContractTemplate           ContractTemplate[]
  CreditApplication          CreditApplication[]
  CreditHold                 CreditHold[]
  CreditLimit                CreditLimit[]
  CsaScore                   CsaScore[]
  CustomerCommissionOverride CustomerCommissionOverride[]
  Dashboard                  Dashboard[]
  dashboardWidgets            DashboardWidget[]
  Department                 Department[]
  DistributedLock            DistributedLock[]
  Document                   Document[]
  DocumentFolder             DocumentFolder[]
  DocumentTemplate           DocumentTemplate[]
  drivers Driver[]
  DriverQualificationFile    DriverQualificationFile[]
  EdiAcknowledgment          EdiAcknowledgment[]
  EdiBatch                   EdiBatch[]
  EdiBatchMessage            EdiBatchMessage[]
  EdiCodeList                EdiCodeList[]
  EdiCommunicationLog        EdiCommunicationLog[]
  EdiControlNumber           EdiControlNumber[]
  EdiError                   EdiError[]
  EdiEventTrigger            EdiEventTrigger[]
  EdiMessage                 EdiMessage[]
  EdiTradingPartner          EdiTradingPartner[]
  EdiTransactionMapping      EdiTransactionMapping[]
  Employee                   Employee[]
  EmploymentHistory          EmploymentHistory[]
  EscalationRule             EscalationRule[]
  FactoredPayment            FactoredPayment[]
  FactoringCompany           FactoringCompany[]
  FactoringVerification      FactoringVerification[]
  FeatureFlagOverride        FeatureFlagOverride[]
  FeatureRequest             FeatureRequest[]
  FeedbackWidget             FeedbackWidget[]
  FmcsaCarrierRecord         FmcsaCarrierRecord[]
  FmcsaComplianceLog         FmcsaComplianceLog[]
  FuelSurchargeTable         FuelSurchargeTable[]
  GeneratedDocument          GeneratedDocument[]
  Holiday                    Holiday[]
  HubspotSyncLog             HubspotSyncLog[]
  InAppNotification          InAppNotification[]
  insuranceCertificates InsuranceCertificate[]
  Integration                Integration[]
  IntegrationProviderConfig  IntegrationProviderConfig[]
  Invoice                    Invoice[]
  lineItems            InvoiceLineItem[]
  JournalEntry               JournalEntry[]
  lines           JournalEntryLine[]
  KBArticle                  KBArticle[]
  KPIAlert                   KPIAlert[]
  KPIDefinition              KPIDefinition[]
  KPISnapshot                KPISnapshot[]
  LaneAnalytics              LaneAnalytics[]
  loads Load[]
  LoadBid                    LoadBid[]
  LoadBoardAccount           LoadBoardAccount[]
  LoadBoardProvider          LoadBoardProvider[]
  LoadHistory                LoadHistory[]
  LoadPlannerQuote           LoadPlannerQuote[]
  LoadPost                   LoadPost[]
  LoadPosting                LoadPosting[]
  LoadTender                 LoadTender[]
  Location                   Location[]
  LoginAudit                 LoginAudit[]
  NOARecord                  NOARecord[]
  NPSResponse                NPSResponse[]
  NPSSurvey                  NPSSurvey[]
  NotificationPreference     NotificationPreference[]
  NumberSequence             NumberSequence[]
  OnboardingChecklist        OnboardingChecklist[]
  OnboardingTask             OnboardingTask[]
  OperationsCarrier          OperationsCarrier[]
  Opportunity                Opportunity[]
  orders               Order[]
  OrderItem                  OrderItem[]
  PasswordResetToken         PasswordResetToken[]
  applications         PaymentApplication[]
  PaymentMade                PaymentMade[]
  PaymentPlan                PaymentPlan[]
  PaymentReceived            PaymentReceived[]
  PortalActivityLog          PortalActivityLog[]
  PortalBranding             PortalBranding[]
  PortalNotification         PortalNotification[]
  PortalPayment              PortalPayment[]
  PortalSavedPaymentMethod   PortalSavedPaymentMethod[]
  PortalSession              PortalSession[]
  PortalUser                 PortalUser[]
  Position                   Position[]
  PostLead                   PostLead[]
  PostingRule                PostingRule[]
  PostingSchedule            PostingSchedule[]
  QuickbooksSyncLog          QuickbooksSyncLog[]
  Quote                      Quote[]
  QuoteAccessorial           QuoteAccessorial[]
  QuoteRequest               QuoteRequest[]
  QuoteStop                  QuoteStop[]
  RateAlert                  RateAlert[]
  RateAlertHistory           RateAlertHistory[]
  RateContract               RateContract[]
  RateData                   RateData[]
  RateHistory                RateHistory[]
  RateLimit                  RateLimit[]
  RateProviderConfig         RateProviderConfig[]
  RateQuery                  RateQuery[]
  Reminder                   Reminder[]
  Report                     Report[]
  reportExecutions ReportExecution[]
  ReportTemplate             ReportTemplate[]
  Role                       Role[]
  SafetyAlert                SafetyAlert[]
  SafetyAuditTrail           SafetyAuditTrail[]
  SafetyIncident             SafetyIncident[]
  SafetyInspection           SafetyInspection[]
  SalesQuota                 SalesQuota[]
  SavedAnalyticsView         SavedAnalyticsView[]
  SavedSearch                SavedSearch[]
  ScheduledJob               ScheduledJob[]
  ScheduledTask              ScheduledTask[]
  ScheduledWorkflowRun       ScheduledWorkflowRun[]
  SearchHistory              SearchHistory[]
  SearchIndex                SearchIndex[]
  SearchIndexQueue           SearchIndexQueue[]
  SearchSuggestion           SearchSuggestion[]
  SearchSynonym              SearchSynonym[]
  Session                    Session[]
  Settlement                 Settlement[]
  settlementLineItems         SettlementLineItem[]
  SlaPolicy                  SlaPolicy[]
  SmsConversation            SmsConversation[]
  StatusHistory              StatusHistory[]
  stepExecutions              StepExecution[]
  stops               Stop[]
  SubrogationRecord          SubrogationRecord[]
  SupportTeam                SupportTeam[]
  SupportTicket              SupportTicket[]
  Survey                     Survey[]
  SurveyResponse             SurveyResponse[]
  SyncJob                    SyncJob[]
  TenantConfig               TenantConfig[]
  TenderRecipient            TenderRecipient[]
  TicketReply                TicketReply[]
  TimeEntry                  TimeEntry[]
  TimeOffBalance             TimeOffBalance[]
  TimeOffRequest             TimeOffRequest[]
  TransformationTemplate     TransformationTemplate[]
  User                       User[]
  UserCommissionAssignment   UserCommissionAssignment[]
  UserPreference             UserPreference[]
  VolumeCommitment           VolumeCommitment[]
  WebhookDelivery            WebhookDelivery[]
  WebhookEndpoint            WebhookEndpoint[]
  WebhookSubscription        WebhookSubscription[]
  Workflow                   Workflow[]
  WorkflowExecution          WorkflowExecution[]
  workflowSteps               WorkflowStep[]
  WorkflowTemplate           WorkflowTemplate[]

  @@index([externalId, sourceSystem])
  @@index([slug])
  @@index([status])
}

model TenantConfig {
  id           String    @id @default(uuid())
  tenantId     String
  configKey    String    @db.VarChar(255)
  configValue  Json
  dataType     DataType  @default(STRING)
  isEncrypted  Boolean   @default(false)
  externalId   String?   @db.VarChar(255)
  sourceSystem String?   @db.VarChar(100)
  customFields Json      @default("{}")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, configKey])
  @@index([configKey])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
}

model TenderRecipient {
  id                 String     @id @default(uuid())
  tenderId           String
  carrierId          String
  position           Int
  status             String     @default("PENDING") @db.VarChar(50)
  offeredAt          DateTime?
  respondedAt        DateTime?
  expiresAt          DateTime?
  declineReason      String?
  notificationSent   Boolean    @default(false)
  notificationMethod String?    @db.VarChar(50)
  createdAt          DateTime   @default(now())
  createdById        String?
  customFields       Json       @default("{}")
  deletedAt          DateTime?
  externalId         String?    @db.VarChar(255)
  sourceSystem       String?    @db.VarChar(100)
  tenantId           String
  updatedAt          DateTime @updatedAt
  updatedById        String?
  carrier             Carrier?           @relation(fields: [carrierId], references: [id], onDelete: Cascade)
  tenant             Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tender         LoadTender @relation(fields: [tenderId], references: [id], onDelete: Cascade)

  @@unique([tenderId, position])
  @@index([carrierId])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId])
  @@index([tenderId])
}

model TicketReply {
  id            String        @id @default(uuid())
  tenantId      String
  ticketId      String
  replyType     ReplyType
  body          String
  bodyHtml      String?
  authorId      String?
  authorName    String?       @db.VarChar(255)
  attachments   Json?
  externalId    String?       @db.VarChar(255)
  sourceSystem  String?       @db.VarChar(100)
  customFields  Json          @default("{}")
  createdAt     DateTime      @default(now())
  updatedAt     DateTime @updatedAt
  deletedAt     DateTime?
  createdById   String?
  updatedById   String?
  tenant        Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  ticket SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([externalId, sourceSystem])
  @@index([replyType])
  @@index([tenantId])
  @@index([ticketId])
}

model TimeEntry {
  id            String    @id @default(uuid())
  tenantId      String
  employeeId    String
  locationId    String?
  clockIn       DateTime  @db.Timestamp(6)
  clockOut      DateTime? @db.Timestamp(6)
  durationHours Decimal?  @db.Decimal(8, 2)
  approvedBy    String?
  approvedAt    DateTime?
  notes         String?
  externalId    String?   @db.VarChar(255)
  sourceSystem  String?   @db.VarChar(100)
  customFields  Json      @default("{}")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime @updatedAt
  deletedAt     DateTime?
  createdById   String?
  updatedById   String?
  employee      Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  location      Location? @relation(fields: [locationId], references: [id])
  tenant        Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([clockIn])
  @@index([employeeId])
  @@index([externalId, sourceSystem])
  @@index([locationId])
  @@index([tenantId])
}

model TimeOffBalance {
  id           String      @id @default(uuid())
  tenantId     String
  employeeId   String
  timeOffType  TimeOffType
  year         Int
  balanceHours Decimal     @db.Decimal(8, 2)
  accrualRate  Decimal?    @db.Decimal(8, 2)
  maxBalance   Decimal?    @db.Decimal(8, 2)
  externalId   String?     @db.VarChar(255)
  sourceSystem String?     @db.VarChar(100)
  customFields Json        @default("{}")
  createdAt    DateTime    @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  employee     Employee    @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  tenant       Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([employeeId, timeOffType, year])
  @@index([employeeId])
  @@index([externalId, sourceSystem])
  @@index([tenantId])
  @@index([year])
}

model TimeOffRequest {
  id           String               @id @default(uuid())
  tenantId     String
  employeeId   String
  requestType  TimeOffType
  startDate    DateTime             @db.Date
  endDate      DateTime             @db.Date
  totalDays    Decimal              @db.Decimal(5, 2)
  reason       String?
  status       TimeOffRequestStatus @default(PENDING)
  approvedBy   String?
  approvedAt   DateTime?
  deniedBy     String?
  deniedAt     DateTime?
  denialReason String?
  externalId   String?              @db.VarChar(255)
  sourceSystem String?              @db.VarChar(100)
  customFields Json                 @default("{}")
  createdAt    DateTime             @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  createdById  String?
  updatedById  String?
  employee     Employee             @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  tenant       Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@index([externalId, sourceSystem])
  @@index([startDate])
  @@index([status])
  @@index([tenantId])
}

model TransformationTemplate {
  id                  String    @id @default(uuid())
  tenantId            String
  templateName        String    @db.VarChar(255)
  sourceFormat        String    @db.VarChar(100)
  targetFormat        String    @db.VarChar(100)
  transformationLogic String
  testCases           Json      @default("[]")
  externalId          String?   @db.VarChar(255)
  sourceSystem        String?   @db.VarChar(100)
  customFields        Json      @default("{}")
  createdAt           DateTime  @default(now())
  updatedAt           DateTime @updatedAt
  deletedAt           DateTime?
  createdById         String?
  updatedById         String?
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([externalId, sourceSystem])
  @@index([sourceFormat])
  @@index([targetFormat])
  @@index([tenantId])
}

model TruckType {
  id                     String                   @id @default(uuid())
  name                   String                   @db.VarChar(100)
  category               String                   @db.VarChar(50)
  deckLengthFt           Decimal                  @db.Decimal(5, 2)
  deckWidthFt            Decimal                  @db.Decimal(5, 2)
  deckHeightFt           Decimal                  @db.Decimal(5, 2)
  wellLengthFt           Decimal                  @default(0) @db.Decimal(5, 2)
  maxCargoWeightLbs      Int
  imageUrl               String?                  @db.VarChar(500)
  description            String?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime @updatedAt
  deletedAt              DateTime?
  baseRateCents          Int?
  bestFor                String[]                 @default([])
  features               String[]                 @default([])
  isActive               Boolean                  @default(true)
  loadingMethod          String?                  @db.VarChar(50)
  maxLegalCargoHeightFt  Decimal?                 @db.Decimal(5, 2)
  maxLegalCargoWidthFt   Decimal?                 @db.Decimal(5, 2)
  ratePerMileCents       Int?
  sortOrder              Int                      @default(0)
  tareWeightLbs          Int?
  wellHeightFt           Decimal?                 @db.Decimal(5, 2)
  LoadPlannerTruck       LoadPlannerTruck[]
  OperationsCarrierTruck OperationsCarrierTruck[]

  @@index([category])
  @@index([isActive])
}

model User {
  id                                                 String                       @id @default(uuid())
  tenantId                                           String
  email                                              String                       @db.VarChar(255)
  passwordHash                                       String                       @db.VarChar(255)
  emailVerifiedAt                                    DateTime?
  firstName                                          String                       @db.VarChar(100)
  lastName                                           String                       @db.VarChar(100)
  phone                                              String?                      @db.VarChar(20)
  avatarUrl                                          String?                      @db.VarChar(500)
  timezone                                           String                       @default("America/Chicago") @db.VarChar(50)
  locale                                             String                       @default("en") @db.VarChar(10)
  status                                             String                       @default("INVITED") @db.VarChar(20)
  lastLoginAt                                        DateTime?
  failedLoginAttempts                                Int                          @default(0)
  lockedUntil                                        DateTime?
  roleId                                             String?
  externalId                                         String?                      @db.VarChar(255)
  sourceSystem                                       String?                      @db.VarChar(100)
  customFields                                       Json                         @default("{}")
  createdAt                                          DateTime                     @default(now())
  updatedAt                                          DateTime @updatedAt
  deletedAt                                          DateTime?
  createdById                                        String?
  updatedById                                        String?
  mfaEnabled                                         Boolean                      @default(false)
  mfaSecret                                          String?                      @db.VarChar(255)
  APIAuditLog                                        APIAuditLog[]
  AccessLog                                          AccessLog[]
  Activity                                           Activity[]
  AgentPortalUser                                    AgentPortalUser[]
  CommissionEntry                                    CommissionEntry[]
  CommissionPayout_CommissionPayout_approvedByToUser CommissionPayout[]           @relation("CommissionPayout_approvedByToUser")
  CommissionPayout_CommissionPayout_userIdToUser     CommissionPayout[]           @relation("CommissionPayout_userIdToUser")
  Company                                            Company[]
  CustomerCommissionOverride                         CustomerCommissionOverride[]
  documents Document[]
  DocumentFolder                                     DocumentFolder[]
  DocumentShare                                      DocumentShare[]
  DocumentTemplate                                   DocumentTemplate[]
  Employee                                           Employee?
  FeatureFlagOverride                                FeatureFlagOverride[]
  FolderDocument                                     FolderDocument[]
  GeneratedDocument                                  GeneratedDocument[]
  InAppNotification                                  InAppNotification[]
  LoginAudit                                         LoginAudit[]
  NotificationPreference                             NotificationPreference?
  Opportunity                                        Opportunity[]
  orders               Order[]
  PasswordResetToken                                 PasswordResetToken[]
  Quote                                              Quote[]
  Reminder                                           Reminder[]
  SalesQuota                                         SalesQuota[]
  SavedAnalyticsView                                 SavedAnalyticsView[]
  Session                                            Session[]
  User_User_createdByIdToUser                        User?                        @relation("User_createdByIdToUser", fields: [createdById], references: [id])
  other_User_User_createdByIdToUser                  User[]                       @relation("User_createdByIdToUser")
  role                Role?              @relation(fields: [roleId], references: [id])
  tenant                                             Tenant                       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  User_User_updatedByIdToUser                        User?                        @relation("User_updatedByIdToUser", fields: [updatedById], references: [id])
  other_User_User_updatedByIdToUser                  User[]                       @relation("User_updatedByIdToUser")
  UserCommissionAssignment                           UserCommissionAssignment[]
  UserPreference                                     UserPreference[]

  @@unique([tenantId, email])
  @@index([email])
  @@index([externalId, sourceSystem])
  @@index([roleId])
  @@index([status])
  @@index([tenantId])
}

model UserCommissionAssignment {
  id              String         @id @default(uuid())
  tenantId        String
  userId          String
  planId          String
  overrideRate    Decimal?       @db.Decimal(5, 2)
  overrideFlat    Decimal?       @db.Decimal(10, 2)
  effectiveDate   DateTime       @db.Date
  endDate         DateTime?      @db.Date
  drawAmount      Decimal        @default(0) @db.Decimal(10, 2)
  drawRecoverable Boolean        @default(true)
  status          String         @default("ACTIVE") @db.VarChar(50)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime @updatedAt
  createdById     String?
  customFields    Json           @default("{}")
  deletedAt       DateTime?
  externalId      String?        @db.VarChar(255)
  sourceSystem    String?        @db.VarChar(100)
  updatedById     String?
  plan  CommissionPlan @relation(fields: [planId], references: [id])
  tenant          Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User?              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([tenantId, userId, effectiveDate])
  @@index([externalId, sourceSystem])
  @@index([planId])
  @@index([tenantId])
  @@index([userId])
}

model UserPreference {
  id              String    @id @default(uuid())
  tenantId        String
  userId          String
  preferenceKey   String    @db.VarChar(255)
  preferenceValue Json
  dataType        DataType  @default(STRING)
  externalId      String?   @db.VarChar(255)
  sourceSystem    String?   @db.VarChar(100)
  customFields    Json      @default("{}")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime @updatedAt
  deletedAt       DateTime?
  createdById     String?
  updatedById     String?
  tenant          Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                User?              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, preferenceKey])
  @@index([externalId, sourceSystem])
  @@index([preferenceKey])
  @@index([tenantId])
  @@index([userId])
}

model VolumeCommitment {
  id               String    @id @default(uuid())
  tenantId         String
  contractId       String
  periodStart      DateTime  @db.Date
  periodEnd        DateTime  @db.Date
  minimumLoads     Int?
  minimumRevenue   Decimal?  @db.Decimal(14, 2)
  minimumWeight    Decimal?  @db.Decimal(14, 2)
  actualLoads      Int       @default(0)
  actualRevenue    Decimal   @default(0) @db.Decimal(14, 2)
  actualWeight     Decimal   @default(0) @db.Decimal(14, 2)
  shortfallFee     Decimal?  @db.Decimal(12, 2)
  shortfallPercent Decimal?  @db.Decimal(5, 2)
  status           String    @default("ACTIVE") @db.VarChar(50)
  externalId       String?   @db.VarChar(255)
  sourceSystem     String?   @db.VarChar(100)
  customFields     Json      @default("{}")
  createdAt        DateTime  @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?
  createdById      String?
  updatedById      String?
  contract         Contract?            @relation(fields: [contractId], references: [id], onDelete: Cascade)
  tenant           Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([contractId])
  @@index([externalId, sourceSystem])
  @@index([periodStart])
  @@index([status])
  @@index([tenantId])
}

model WebhookDelivery {
  id              String           @id @default(uuid())
  tenantId        String
  endpointId      String?
  integrationId   String?
  event           String           @db.VarChar(100)
  payload         Json
  requestHeaders  Json?
  requestBody     Json?
  responseStatus  Int?
  responseHeaders Json?
  responseBody    String?
  status          WebhookStatus    @default(PENDING)
  attempts        Int              @default(0)
  lastAttempt     DateTime?
  nextRetry       DateTime?
  errorMessage    String?
  externalId      String?          @db.VarChar(255)
  sourceSystem    String?          @db.VarChar(100)
  customFields    Json             @default("{}")
  createdAt       DateTime         @default(now())
  updatedAt       DateTime @updatedAt
  deletedAt       DateTime?
  createdById     String?
  updatedById     String?
  endpoint WebhookEndpoint? @relation(fields: [endpointId], references: [id])
  integration     Integration?     @relation(fields: [integrationId], references: [id])
  tenant          Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([endpointId])
  @@index([event])
  @@index([externalId, sourceSystem])
  @@index([integrationId])
  @@index([status])
  @@index([tenantId])
}

model WebhookEndpoint {
  id                  String                @id @default(uuid())
  tenantId            String
  name                String                @db.VarChar(255)
  url                 String                @db.VarChar(500)
  description         String?
  events              String[]
  secret              String?               @db.VarChar(255)
  status              String                @default("ACTIVE") @db.VarChar(50)
  externalId          String?               @db.VarChar(255)
  sourceSystem        String?               @db.VarChar(100)
  customFields        Json                  @default("{}")
  createdAt           DateTime              @default(now())
  updatedAt           DateTime @updatedAt
  deletedAt           DateTime?
  createdById         String?
  updatedById         String?
  WebhookDelivery     WebhookDelivery[]
  tenant              Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  WebhookSubscription WebhookSubscription[]

  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId, deletedAt])
  @@index([tenantId])
  @@index([tenantId, status])
}

model WebhookSubscription {
  id                String          @id @default(uuid())
  tenantId          String
  webhookEndpointId String
  eventType         String          @db.VarChar(100)
  filterConditions  Json            @default("{}")
  isActive          Boolean         @default(true)
  externalId        String?         @db.VarChar(255)
  sourceSystem      String?         @db.VarChar(100)
  customFields      Json            @default("{}")
  createdAt         DateTime        @default(now())
  updatedAt         DateTime @updatedAt
  deletedAt         DateTime?
  createdById       String?
  updatedById       String?
  tenant            Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  endpoint   WebhookEndpoint @relation(fields: [webhookEndpointId], references: [id], onDelete: Cascade)

  @@index([eventType])
  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([tenantId])
  @@index([webhookEndpointId])
}

model Workflow {
  id                   String                 @id @default(uuid())
  tenantId             String
  name                 String                 @db.VarChar(255)
  description          String?
  triggerType          TriggerType
  triggerEvent         String?                @db.VarChar(100)
  triggerConditions    Json                   @default("{}")
  status               String                 @default("ACTIVE") @db.VarChar(50)
  version              Int                    @default(1)
  externalId           String?                @db.VarChar(255)
  sourceSystem         String?                @db.VarChar(100)
  customFields         Json                   @default("{}")
  createdAt            DateTime               @default(now())
  updatedAt            DateTime @updatedAt
  deletedAt            DateTime?
  createdById          String?
  updatedById          String?
  ScheduledWorkflowRun ScheduledWorkflowRun[]
  tenant               Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  WorkflowExecution    WorkflowExecution[]
  workflowSteps         WorkflowStep[]

  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId])
  @@index([triggerType])
}

model WorkflowExecution {
  id            String                  @id @default(uuid())
  tenantId      String
  workflowId    String
  triggerData   Json
  status        WorkflowExecutionStatus @default(PENDING)
  startedAt     DateTime?
  completedAt   DateTime?
  result        Json?
  errorMessage  String?
  externalId    String?                 @db.VarChar(255)
  sourceSystem  String?                 @db.VarChar(100)
  customFields  Json                    @default("{}")
  createdAt     DateTime                @default(now())
  updatedAt     DateTime @updatedAt
  deletedAt     DateTime?
  createdById   String?
  updatedById   String?
  stepExecutions StepExecution[]
  tenant        Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  workflow      Workflow                @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([externalId, sourceSystem])
  @@index([status])
  @@index([tenantId])
  @@index([workflowId])
}

model WorkflowStep {
  id             String          @id @default(uuid())
  tenantId       String
  workflowId     String
  stepNumber     Int
  stepName       String          @db.VarChar(255)
  stepType       StepType
  actionConfig   Json            @default("{}")
  conditionLogic String?
  timeoutSeconds Int?            @default(3600)
  retryConfig    Json?           @default("{}")
  externalId     String?         @db.VarChar(255)
  sourceSystem   String?         @db.VarChar(100)
  customFields   Json            @default("{}")
  createdAt      DateTime        @default(now())
  updatedAt      DateTime @updatedAt
  deletedAt      DateTime?
  createdById    String?
  updatedById    String?
  stepExecutions  StepExecution[]
  tenant         Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  workflow       Workflow        @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@unique([workflowId, stepNumber])
  @@index([externalId, sourceSystem])
  @@index([stepType])
  @@index([tenantId])
  @@index([workflowId])
}

model WorkflowTemplate {
  id            String    @id @default(uuid())
  tenantId      String
  templateName  String    @db.VarChar(255)
  category      String?   @db.VarChar(100)
  description   String?
  triggerConfig Json      @default("{}")
  stepsJson     Json      @default("[]")
  isSystem      Boolean   @default(false)
  isActive      Boolean   @default(true)
  externalId    String?   @db.VarChar(255)
  sourceSystem  String?   @db.VarChar(100)
  customFields  Json      @default("{}")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime @updatedAt
  deletedAt     DateTime?
  createdById   String?
  updatedById   String?
  tenant        Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([externalId, sourceSystem])
  @@index([isActive])
  @@index([isSystem])
  @@index([tenantId])
}

enum AgentCommissionStatus {
  CALCULATED
  APPROVED
  PAID
  ADJUSTED
  VOIDED
}

enum AgentPayoutStatus {
  PENDING
  APPROVED
  PROCESSING
  PAID
  FAILED
}

enum AgentStatus {
  PENDING
  ACTIVE
  SUSPENDED
  TERMINATED
}

enum AgentTier {
  STANDARD
  SILVER
  GOLD
  PLATINUM
}

enum AgentType {
  REFERRING
  SELLING
  HYBRID
}

enum AggregationType {
  SUM
  AVG
  COUNT
  MIN
  MAX
  RATIO
}

enum AgreementStatus {
  DRAFT
  ACTIVE
  EXPIRED
  TERMINATED
}

enum AlertCondition {
  RATE_INCREASE
  RATE_DECREASE
  RATE_THRESHOLD
}

enum ApprovalType {
  SINGLE
  ALL
  ANY
  SEQUENTIAL
}

enum AssignmentStatus {
  ACTIVE
  SUNSET
  TRANSFERRED
  TERMINATED
}

enum AssignmentType {
  PRIMARY
  SECONDARY
  SPLIT
}

enum AuditAction {
  CREATE
  READ
  UPDATE
  DELETE
  LOGIN
  LOGOUT
  EXPORT
  IMPORT
}

enum AuditActionCategory {
  DATA
  AUTH
  ADMIN
  SYSTEM
}

enum AuditEventType {
  LOGIN_SUCCESS
  LOGIN_FAILED
  PASSWORD_RESET
  MFA_ENABLED
  DATA_EXPORT
  PERMISSION_CHANGE
}

enum AuditSeverity {
  INFO
  WARNING
  CRITICAL
}

enum AuditSeverityLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum AuthType {
  API_KEY
  OAUTH2
  BASIC
  NONE
}

enum CSABasicType {
  UNSAFE_DRIVING
  HOS_COMPLIANCE
  DRIVER_FITNESS
  CONTROLLED_SUBSTANCES
  VEHICLE_MAINTENANCE
  HAZMAT_COMPLIANCE
  CRASH_INDICATOR
}

enum CacheType {
  ENTITY
  QUERY
  SESSION
  CONFIG
}

enum CapacityStatus {
  AVAILABLE
  COMMITTED
  INACTIVE
}

enum CarrierDocumentStatus {
  UPLOADED
  REVIEWING
  APPROVED
  REJECTED
}

enum CarrierDocumentType {
  POD
  LUMPER_RECEIPT
  SCALE_TICKET
  BOL_SIGNED
  WEIGHT_TICKET
  OTHER
}

enum CarrierPortalNotificationType {
  LOAD_ASSIGNED
  LOAD_CANCELLED
  DOCUMENT_REQUEST
  PAYMENT_PROCESSED
  INVOICE_APPROVED
  INVOICE_REJECTED
  QUICK_PAY_APPROVED
  QUICK_PAY_REJECTED
  GENERAL
}

enum CarrierPortalUserRole {
  OWNER
  ADMIN
  DISPATCHER
  DRIVER
}

enum ChangeReason {
  PROMOTION
  TRANSFER
  SALARY_ADJUSTMENT
  DEMOTION
  DEPARTMENT_RESTRUCTURE
  OTHER
}

enum CircuitBreakerState {
  CLOSED
  OPEN
  HALF_OPEN
}

enum CircuitState {
  CLOSED
  OPEN
  HALF_OPEN
}

enum ClaimDisposition {
  CARRIER_LIABILITY
  SHIPPER_LIABILITY
  RECEIVER_LIABILITY
  SHARED_LIABILITY
  NO_LIABILITY
}

enum ClaimStatus {
  DRAFT
  SUBMITTED
  UNDER_INVESTIGATION
  PENDING_DOCUMENTATION
  APPROVED
  DENIED
  SETTLED
  CLOSED
}

enum ClaimType {
  CARGO_DAMAGE
  CARGO_LOSS
  SHORTAGE
  LATE_DELIVERY
  OVERCHARGE
  OTHER
}

enum CollectionActivityType {
  CALL
  EMAIL
  LETTER
  LEGAL_NOTICE
  COLLECTIONS_AGENCY
}

enum CommissionSplitType {
  PERCENT_OF_REP
  PERCENT_OF_MARGIN
  FLAT_PER_LOAD
  TIERED
}

enum ComplianceStatus {
  COMPLIANT
  NON_COMPLIANT
  PENDING_VERIFICATION
  EXPIRED
}

enum ConfigCategory {
  SECURITY
  LIMITS
  DEFAULTS
  INTEGRATIONS
  EMAIL
  NOTIFICATIONS
}

enum ConfigTemplateType {
  TENANT
  USER
}

enum ContractClauseType {
  PAYMENT_TERMS
  LIABILITY
  INSURANCE
  TERMINATION
  DISPUTE_RESOLUTION
  CONFIDENTIALITY
  COMPLIANCE
  FORCE_MAJEURE
  CUSTOM
}

enum ContractStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  SENT_FOR_SIGNATURE
  ACTIVE
  EXPIRED
  TERMINATED
}

enum ContractType {
  CUSTOMER_RATE
  CARRIER_RATE
  DEDICATED_CAPACITY
  VOLUME_COMMITMENT
  AGENT_AGREEMENT
}

enum CreditApplicationStatus {
  PENDING
  UNDER_REVIEW
  APPROVED
  CONDITIONAL_APPROVAL
  DENIED
  EXPIRED
}

enum CreditHoldReason {
  PAYMENT_OVERDUE
  CREDIT_LIMIT_EXCEEDED
  FRAUD_SUSPECTED
  INSUFFICIENT_INSURANCE
  CARRIER_OOS
  MANUAL_HOLD
}

enum CreditLimitStatus {
  ACTIVE
  SUSPENDED
  EXPIRED
  EXCEEDED
}

enum DQFDocumentType {
  APPLICATION
  MVR
  PSP
  MEDICAL_CARD
  DRUG_TEST
  ROAD_TEST
  CLEARINGHOUSE
  EMPLOYMENT_VERIFICATION
}

enum DataType {
  STRING
  NUMBER
  BOOLEAN
  JSON
  DATE
}

enum DayOfWeek {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum EdiCommunicationProtocol {
  FTP
  SFTP
  FTPS
  AS2
  HTTPS
  VAN
}

enum EdiDirection {
  INBOUND
  OUTBOUND
}

enum EdiMessageStatus {
  PENDING
  QUEUED
  SENT
  DELIVERED
  ACKNOWLEDGED
  ERROR
  REJECTED
}

enum EdiTransactionType {
  EDI_204
  EDI_214
  EDI_210
  EDI_211
  EDI_990
  EDI_997
  EDI_315
  EDI_322
}

enum EdiValidationStatus {
  VALID
  WARNING
  ERROR
}

enum EmploymentStatus {
  ACTIVE
  ON_LEAVE
  TERMINATED
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  TEMP
}

enum ExecutionStatus {
  PENDING
  RUNNING
  COMPLETED
  FAILED
  CANCELLED
}

enum FactoringStatus {
  NONE
  FACTORED
  QUICK_PAY_ONLY
}

enum FeatureFlagStatus {
  ACTIVE
  DEPRECATED
  ARCHIVED
}

enum FeatureRequestStatus {
  SUBMITTED
  UNDER_REVIEW
  PLANNED
  IN_PROGRESS
  COMPLETED
  DECLINED
}

enum FeedbackType {
  BUG
  SUGGESTION
  COMPLAINT
  PRAISE
  OTHER
}

enum IndexOperation {
  CREATE
  UPDATE
  DELETE
  REINDEX
}

enum IndexStatus {
  ACTIVE
  REBUILDING
  ERROR
}

enum InsuranceType {
  AUTO_LIABILITY
  CARGO
  GENERAL_LIABILITY
  WORKERS_COMP
  UMBRELLA
  BOND
}

enum IntegrationCategory {
  LOAD_BOARD
  ACCOUNTING
  ELD
  CRM
  RATING
  TMS
  DOCUMENT
  TRACKING
}

enum InvalidationType {
  DELETE
  REFRESH
}

enum JobExecutionStatus {
  PENDING
  RUNNING
  COMPLETED
  FAILED
  CANCELLED
  TIMEOUT
}

enum JobType {
  SYSTEM
  TENANT
  USER
}

enum KPICategory {
  FINANCIAL
  OPERATIONAL
  CARRIER
  CUSTOMER
  SALES
}

enum LeadStatus {
  SUBMITTED
  IN_REVIEW
  QUALIFIED
  WORKING
  CONVERTED
  REJECTED
  EXPIRED
}

enum LoadBoardProviderType {
  DAT
  TRUCKSTOP
  SYLECTUS
  TRUCKER_TOOLS
  LOAD_BOARD
}

enum LoadPostStatus {
  DRAFT
  POSTED
  RESPONDED
  COVERED
  EXPIRED
  CANCELLED
}

enum LoginMethod {
  PASSWORD
  SSO
  OAUTH
  MFA
  API_KEY
}

enum MetricType {
  ON_TIME_DELIVERY
  LOAD_VOLUME
  REVENUE
  COST_PER_MILE
  CLAIMS_RATIO
  CUSTOM
}

enum NOAStatus {
  PENDING
  VERIFIED
  ACTIVE
  EXPIRED
  RELEASED
}

enum NPSCategory {
  PROMOTER
  PASSIVE
  DETRACTOR
}

enum OutputFormat {
  PDF
  EXCEL
  CSV
  JSON
}

enum PaymentMethod {
  ACH
  CHECK
  WIRE
  CREDIT_CARD
}

enum PaymentPlanStatus {
  ACTIVE
  COMPLETED
  DEFAULTED
  CANCELLED
}

enum PeriodType {
  HOUR
  DAY
  WEEK
  MONTH
  QUARTER
  YEAR
}

enum PortalNotificationType {
  QUOTE_READY
  LOAD_UPDATE
  INVOICE_AVAILABLE
  PAYMENT_RECEIVED
  DOCUMENT_UPLOADED
  MESSAGE_RECEIVED
  SHIPMENT_DELAYED
  DELIVERY_CONFIRMED
  GENERAL
}

enum PortalPaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
}

enum PortalUserRole {
  ADMIN
  USER
  VIEW_ONLY
}

enum PortalUserStatus {
  PENDING
  ACTIVE
  SUSPENDED
  DEACTIVATED
}

enum PostLeadStatus {
  NEW
  CONTACTED
  QUOTED
  ACCEPTED
  DECLINED
}

enum PostingFrequency {
  IMMEDIATE
  HOURLY
  DAILY
  MANUAL
}

enum QuickPayStatus {
  REQUESTED
  APPROVED
  REJECTED
  PROCESSED
}

enum QuoteRequestStatus {
  SUBMITTED
  REVIEWING
  QUOTED
  ACCEPTED
  DECLINED
  EXPIRED
}

enum RateLimitScope {
  USER
  TENANT
  IP
  GLOBAL
}

enum RateProvider {
  DAT
  TRUCKSTOP
  INTERNAL
}

enum RateType {
  FLAT
  PER_MILE
  PER_CWT
  PER_PALLET
  PERCENTAGE
}

enum ReminderStatus {
  PENDING
  SENT
  SNOOZED
  DISMISSED
  COMPLETED
}

enum ReplyType {
  PUBLIC
  INTERNAL_NOTE
  SYSTEM
}

enum ReportType {
  STANDARD
  CUSTOM
  AD_HOC
}

enum ResetFrequency {
  NEVER
  DAILY
  MONTHLY
  YEARLY
}

enum SLAType {
  ON_TIME_PICKUP
  ON_TIME_DELIVERY
  CLAIMS_RATIO
  TENDER_ACCEPTANCE
}

enum SaferDataStatus {
  ACTIVE
  INACTIVE
  OUT_OF_SERVICE
}

enum SafetyAlertType {
  INSURANCE_EXPIRING
  AUTHORITY_EXPIRING
  CSA_THRESHOLD_EXCEEDED
  OUT_OF_SERVICE
  VIOLATION_PATTERN
}

enum SafetyIncidentType {
  ACCIDENT
  CITATION
  INSPECTION_VIOLATION
  DOT_AUDIT_FINDING
  INSURANCE_CLAIM
}

enum ScheduleType {
  CRON
  INTERVAL
  ONCE
  MANUAL
}

enum SearchEntityType {
  ORDERS
  LOADS
  COMPANIES
  CARRIERS
  CONTACTS
  INVOICES
  DOCUMENTS
}

enum StepType {
  ACTION
  CONDITION
  APPROVAL
  WAIT
  PARALLEL
  LOOP
}

enum SubrogationStatus {
  PENDING
  IN_PROGRESS
  RECOVERED
  UNRECOVERABLE
  CLOSED
}

enum SurveyType {
  NPS
  CSAT
  CUSTOM
  EXIT
  ONBOARDING
}

enum SyncDirection {
  INBOUND
  OUTBOUND
  BIDIRECTIONAL
}

enum SyncFrequency {
  REALTIME
  HOURLY
  DAILY
  MANUAL
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
  CANCELLED
}

enum TicketPriority {
  URGENT
  HIGH
  NORMAL
  LOW
}

enum TicketSource {
  EMAIL
  PORTAL
  PHONE
  CHAT
  INTERNAL
}

enum TicketStatus {
  NEW
  OPEN
  PENDING
  ON_HOLD
  RESOLVED
  CLOSED
}

enum TicketType {
  QUESTION
  PROBLEM
  INCIDENT
  REQUEST
}

enum TimeOffRequestStatus {
  PENDING
  APPROVED
  DENIED
  CANCELLED
}

enum TimeOffType {
  PTO
  SICK
  VACATION
  PERSONAL
  FLOATING_HOLIDAY
}

enum TrendDirection {
  UP
  DOWN
  FLAT
}

enum TriggerType {
  EVENT
  SCHEDULE
  MANUAL
  WEBHOOK
}

enum VerificationMethod {
  PHONE_CALL
  EMAIL
  FAX
  ONLINE_PORTAL
  MAIL
}

enum VerificationStatus {
  PENDING
  VERIFIED
  PARTIAL
  DECLINED
}

enum WebhookStatus {
  PENDING
  DELIVERED
  FAILED
  RETRYING
}

enum WorkflowExecutionStatus {
  PENDING
  RUNNING
  COMPLETED
  FAILED
  CANCELLED
  WAITING
}
