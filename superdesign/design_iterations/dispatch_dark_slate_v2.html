<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Ultra TMS â€” Dispatch Board (Dark Slate Command)</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        :root {
            --slate-950: #0f172a;
            --slate-900: #1e293b;
            --slate-800: #334155;
            --slate-700: #475569;
            --slate-600: #64748b;
            --slate-500: #64748b;
            --slate-400: #94a3b8;
            --slate-300: #cbd5e1;
            --slate-200: #e2e8f0;
            --slate-100: #f1f5f9;
            --slate-50: #f8fafc;
            --white: #ffffff;
            --accent: #6366f1;
            --accent-light: #818cf8;
            --accent-dark: #4f46e5;
            --accent-bg: #eef2ff;
            --success: #10b981;
            --success-light: #d1fae5;
            --warning: #f59e0b;
            --warning-light: #fef3c7;
            --danger: #ef4444;
            --danger-light: #fee2e2;
            --blue: #3b82f6;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--slate-50);
            color: var(--text-primary);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
        }

        /* ===== HEADER BAR ===== */
        .header {
            height: 52px;
            background: var(--slate-950);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            width: 22px;
            height: 22px;
            background: var(--accent);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-icon svg {
            width: 12px;
            height: 12px;
            fill: white;
        }

        .logo-text {
            font-size: 16px;
            font-weight: 700;
            color: var(--white);
            letter-spacing: -0.3px;
        }

        .header-nav {
            display: flex;
            align-items: center;
            gap: 0;
            height: 100%;
        }

        .header-nav a {
            text-decoration: none;
            color: var(--slate-400);
            font-size: 13px;
            font-weight: 500;
            padding: 0 18px;
            height: 100%;
            display: flex;
            align-items: center;
            position: relative;
            transition: color 0.15s;
            letter-spacing: -0.1px;
        }

        .header-nav a:hover {
            color: var(--slate-200);
        }

        .header-nav a.active {
            color: var(--white);
        }

        .header-nav a.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 18px;
            right: 18px;
            height: 2px;
            background: var(--accent);
            border-radius: 2px 2px 0 0;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .header-icon-btn {
            width: 34px;
            height: 34px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--slate-400);
            cursor: pointer;
            transition: all 0.15s;
            position: relative;
            border: none;
            background: none;
        }

        .header-icon-btn:hover {
            background: var(--slate-800);
            color: var(--slate-200);
        }

        .header-icon-btn svg {
            width: 18px;
            height: 18px;
        }

        .notif-badge {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 16px;
            height: 16px;
            background: var(--danger);
            color: white;
            font-size: 9px;
            font-weight: 700;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--slate-950);
        }

        .user-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 11px;
            font-weight: 700;
            margin-left: 8px;
            cursor: pointer;
            letter-spacing: 0.5px;
        }

        /* ===== SUB-HEADER ===== */
        .sub-header {
            height: 44px;
            background: var(--white);
            border-bottom: 1px solid var(--slate-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            position: sticky;
            top: 52px;
            z-index: 99;
        }

        .sub-header-left {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .load-count {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: -0.2px;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            color: var(--text-muted);
        }

        .sync-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse-dot 2s ease-in-out infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        .sub-header-center {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-pill {
            display: flex;
            align-items: center;
            gap: 5px;
            height: 28px;
            padding: 0 10px;
            background: var(--white);
            border: 1px solid var(--slate-200);
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s;
            white-space: nowrap;
            font-family: inherit;
        }

        .filter-pill:hover {
            border-color: var(--slate-300);
            background: var(--slate-50);
        }

        .filter-pill svg {
            width: 12px;
            height: 12px;
            color: var(--slate-400);
        }

        .sub-header-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            height: 30px;
            padding: 0 14px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background 0.15s;
            font-family: inherit;
        }

        .btn-primary:hover {
            background: var(--accent-dark);
        }

        .btn-ghost {
            height: 30px;
            padding: 0 12px;
            background: none;
            color: var(--text-secondary);
            border: 1px solid var(--slate-200);
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.15s;
            font-family: inherit;
        }

        .btn-ghost:hover {
            background: var(--slate-50);
            border-color: var(--slate-300);
        }

        .view-toggle {
            display: flex;
            align-items: center;
            border: 1px solid var(--slate-200);
            border-radius: 6px;
            overflow: hidden;
            height: 30px;
        }

        .view-toggle-btn {
            width: 32px;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            background: none;
            color: var(--slate-400);
            cursor: pointer;
            transition: all 0.15s;
        }

        .view-toggle-btn.active {
            background: var(--slate-100);
            color: var(--text-primary);
        }

        .view-toggle-btn:not(:last-child) {
            border-right: 1px solid var(--slate-200);
        }

        .view-toggle-btn svg {
            width: 14px;
            height: 14px;
        }

        /* ===== TABLE CONTAINER ===== */
        .table-container {
            margin: 16px 20px;
            background: var(--white);
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.06);
            border: 1px solid var(--slate-200);
            overflow: hidden;
        }

        .table-scroll {
            overflow-x: auto;
            overflow-y: visible;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1400px;
        }

        /* ===== TABLE HEADER ===== */
        thead th {
            background: var(--slate-700);
            color: var(--white);
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.6px;
            padding: 0 14px;
            height: 36px;
            text-align: left;
            white-space: nowrap;
            position: sticky;
            top: 96px;
            z-index: 50;
            border-bottom: none;
        }

        thead th:first-child {
            padding-left: 16px;
        }

        thead th.sortable {
            cursor: pointer;
            user-select: none;
        }

        thead th.sortable:hover {
            background: var(--slate-600);
        }

        .sort-arrows {
            display: inline-flex;
            flex-direction: column;
            margin-left: 4px;
            gap: 1px;
            vertical-align: middle;
        }

        .sort-arrows svg {
            width: 8px;
            height: 8px;
            opacity: 0.4;
        }

        .sort-arrows svg.active {
            opacity: 1;
        }

        th.col-checkbox { width: 40px; text-align: center; }
        th.col-load { width: 90px; position: sticky; left: 0; z-index: 52; background: var(--slate-700); }
        th.col-status { width: 10px; padding: 0; }
        th.col-route { width: 180px; }
        th.col-distance { width: 80px; text-align: right; }
        th.col-carrier { width: 140px; }
        th.col-driver { width: 120px; }
        th.col-equip { width: 80px; }
        th.col-pickup { width: 130px; }
        th.col-delivery { width: 130px; }
        th.col-rate { width: 90px; text-align: right; }
        th.col-margin { width: 110px; text-align: right; }
        th.col-rpm { width: 70px; text-align: right; }
        th.col-actions { width: 60px; text-align: center; }

        /* ===== TABLE BODY ===== */
        tbody tr.data-row {
            border-bottom: 1px solid var(--slate-100);
            cursor: pointer;
            transition: background 0.1s;
            position: relative;
        }

        tbody tr.data-row:hover {
            background: var(--slate-50);
        }

        tbody tr.data-row.selected {
            background: var(--accent-bg);
        }

        tbody tr.data-row td {
            padding: 0 14px;
            height: 44px;
            font-size: 13px;
            color: var(--text-primary);
            vertical-align: middle;
            white-space: nowrap;
        }

        tbody tr.data-row td:first-child {
            padding-left: 16px;
        }

        /* Status border cell */
        td.status-border {
            width: 3px !important;
            padding: 0 !important;
            position: relative;
        }

        td.status-border::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
        }

        tr[data-status="in-transit"] td.status-border::after { background: var(--warning); }
        tr[data-status="unassigned"] td.status-border::after { background: var(--danger); }
        tr[data-status="tendered"] td.status-border::after { background: var(--blue); }
        tr[data-status="dispatched"] td.status-border::after { background: var(--accent); }
        tr[data-status="delivered"] td.status-border::after { background: var(--success); }
        tr[data-status="completed"] td.status-border::after { background: var(--slate-300); }

        /* Alternating group background */
        tr.alt-group { background: var(--slate-50); }
        tr.alt-group:hover { background: #edf0f5; }

        /* Sticky load column */
        td.col-load {
            position: sticky;
            left: 0;
            z-index: 10;
            background: inherit;
            font-weight: 600;
            font-size: 12px;
            color: var(--accent);
        }

        tr.data-row:hover td.col-load {
            background: var(--slate-50);
        }

        tr.data-row.selected td.col-load {
            background: var(--accent-bg);
        }

        tr.alt-group td.col-load {
            background: var(--slate-50);
        }

        tr.alt-group:hover td.col-load {
            background: #edf0f5;
        }

        /* Column styles */
        .route-text {
            display: flex;
            flex-direction: column;
            gap: 1px;
        }

        .route-origin {
            font-weight: 500;
            font-size: 13px;
        }

        .route-dest {
            font-size: 11px;
            color: var(--text-muted);
        }

        .route-arrow {
            color: var(--slate-300);
            font-size: 10px;
        }

        td.text-right {
            text-align: right;
        }

        td.text-center {
            text-align: center;
        }

        .carrier-name {
            font-weight: 500;
            font-size: 13px;
        }

        .driver-name {
            font-size: 13px;
        }

        .equip-tag {
            display: inline-block;
            padding: 2px 7px;
            background: var(--slate-100);
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .date-text {
            font-size: 12px;
        }

        .date-time {
            font-size: 10px;
            color: var(--text-muted);
        }

        .rate-value {
            font-family: 'SF Mono', 'Fira Code', 'Cascadia Code', monospace;
            font-variant-numeric: tabular-nums;
            font-size: 13px;
            font-weight: 500;
        }

        .margin-value {
            font-family: 'SF Mono', 'Fira Code', 'Cascadia Code', monospace;
            font-variant-numeric: tabular-nums;
            font-size: 12px;
            font-weight: 600;
        }

        .margin-good { color: #059669; }
        .margin-ok { color: var(--text-primary); }
        .margin-bad { color: var(--danger); }

        .margin-cell {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 8px;
        }

        .rpm-value {
            font-family: 'SF Mono', 'Fira Code', 'Cascadia Code', monospace;
            font-variant-numeric: tabular-nums;
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Sparkline */
        .sparkline {
            display: inline-block;
            vertical-align: middle;
        }

        /* Actions */
        .action-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: none;
            border-radius: 6px;
            color: var(--slate-400);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }

        .action-btn:hover {
            background: var(--slate-100);
            color: var(--text-primary);
        }

        .action-btn svg {
            width: 16px;
            height: 16px;
        }

        /* Checkbox */
        .row-checkbox {
            width: 16px;
            height: 16px;
            accent-color: var(--accent);
            cursor: pointer;
        }

        /* ===== EXPANDED ROW ===== */
        .detail-row {
            display: none;
        }

        .detail-row.open {
            display: table-row;
        }

        .detail-row td {
            padding: 0 !important;
            background: var(--slate-50);
            border-bottom: 2px solid var(--accent);
        }

        .detail-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.35s ease, padding 0.35s ease;
            padding: 0 24px;
        }

        .detail-row.open .detail-content {
            max-height: 400px;
            padding: 20px 24px;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 24px;
        }

        .detail-section h4 {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-muted);
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--slate-200);
        }

        .detail-field {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            font-size: 12px;
        }

        .detail-label {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .detail-value {
            color: var(--text-primary);
            font-weight: 500;
            text-align: right;
        }

        .detail-value.mono {
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-variant-numeric: tabular-nums;
        }

        .detail-status-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-transit { background: var(--warning-light); color: #92400e; }
        .badge-unassigned { background: var(--danger-light); color: #991b1b; }
        .badge-tendered { background: #dbeafe; color: #1e40af; }
        .badge-dispatched { background: var(--accent-bg); color: var(--accent-dark); }
        .badge-delivered { background: var(--success-light); color: #065f46; }
        .badge-completed { background: var(--slate-100); color: var(--slate-600); }

        .badge-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .badge-transit .badge-dot { background: var(--warning); }
        .badge-unassigned .badge-dot { background: var(--danger); }
        .badge-tendered .badge-dot { background: var(--blue); }
        .badge-dispatched .badge-dot { background: var(--accent); }
        .badge-delivered .badge-dot { background: var(--success); }
        .badge-completed .badge-dot { background: var(--slate-400); }

        /* ===== BOTTOM BAR ===== */
        .table-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
            border-top: 1px solid var(--slate-100);
            font-size: 12px;
            color: var(--text-secondary);
        }

        .pagination {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .page-btn {
            width: 30px;
            height: 30px;
            border: 1px solid var(--slate-200);
            background: var(--white);
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
            font-family: inherit;
        }

        .page-btn:hover {
            background: var(--slate-50);
            border-color: var(--slate-300);
        }

        .page-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .page-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .page-btn svg {
            width: 14px;
            height: 14px;
        }

        /* ===== BULK ACTION BAR ===== */
        .bulk-bar {
            display: none;
            align-items: center;
            gap: 16px;
            padding: 10px 20px;
            background: var(--slate-900);
            color: white;
            font-size: 13px;
            font-weight: 500;
            border-radius: 10px;
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 200;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: slide-up 0.25s ease;
        }

        .bulk-bar.visible {
            display: flex;
        }

        @keyframes slide-up {
            from { transform: translateX(-50%) translateY(20px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }

        .bulk-count {
            font-variant-numeric: tabular-nums;
            color: var(--accent-light);
            font-weight: 600;
        }

        .bulk-divider {
            width: 1px;
            height: 20px;
            background: var(--slate-700);
        }

        .bulk-action {
            height: 30px;
            padding: 0 14px;
            border: 1px solid var(--slate-600);
            background: none;
            color: white;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            font-family: inherit;
        }

        .bulk-action:hover {
            background: var(--slate-700);
        }

        .bulk-action.primary {
            background: var(--accent);
            border-color: var(--accent);
        }

        .bulk-action.primary:hover {
            background: var(--accent-dark);
        }

        .bulk-close {
            width: 28px;
            height: 28px;
            border: none;
            background: none;
            color: var(--slate-400);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            margin-left: 4px;
        }

        .bulk-close:hover {
            background: var(--slate-700);
            color: white;
        }

        .bulk-close svg {
            width: 16px;
            height: 16px;
        }

        /* ===== DISTANCE COLUMN ===== */
        .distance-value {
            font-size: 13px;
            font-weight: 500;
        }

        .distance-unit {
            font-size: 10px;
            color: var(--text-muted);
            margin-left: 2px;
        }

        /* Unassigned carrier/driver placeholder */
        .unassigned-text {
            color: var(--danger);
            font-style: italic;
            font-size: 12px;
        }

        /* ===== SCROLLBAR ===== */
        .table-scroll::-webkit-scrollbar {
            height: 8px;
        }

        .table-scroll::-webkit-scrollbar-track {
            background: var(--slate-100);
        }

        .table-scroll::-webkit-scrollbar-thumb {
            background: var(--slate-300);
            border-radius: 4px;
        }

        .table-scroll::-webkit-scrollbar-thumb:hover {
            background: var(--slate-400);
        }
    </style>
</head>
<body>

<!-- ===== HEADER ===== -->
<header class="header">
    <div class="header-left">
        <div class="logo-icon">
            <svg viewBox="0 0 12 12"><path d="M2 2h3v3H2zM7 2h3v3H7zM2 7h3v3H2zM7 7h3v3H7z"/></svg>
        </div>
        <span class="logo-text">Ultra TMS</span>
    </div>

    <nav class="header-nav">
        <a href="#">Dashboard</a>
        <a href="#">Loads</a>
        <a href="#" class="active">Dispatch</a>
        <a href="#">Carriers</a>
        <a href="#">Billing</a>
    </nav>

    <div class="header-right">
        <button class="header-icon-btn" title="Search">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        </button>
        <button class="header-icon-btn" title="Notifications">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
            <span class="notif-badge">3</span>
        </button>
        <div class="user-avatar">RK</div>
    </div>
</header>

<!-- ===== SUB-HEADER ===== -->
<div class="sub-header">
    <div class="sub-header-left">
        <span class="load-count">571 loads</span>
        <span class="sync-status">
            <span class="sync-dot"></span>
            Last sync: 2m ago
        </span>
    </div>

    <div class="sub-header-center">
        <button class="filter-pill">
            All Statuses
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="m6 9 6 6 6-6"/></svg>
        </button>
        <button class="filter-pill">
            This Week
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="m6 9 6 6 6-6"/></svg>
        </button>
        <button class="filter-pill">
            Carrier
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="m6 9 6 6 6-6"/></svg>
        </button>
        <button class="filter-pill">
            Equipment
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="m6 9 6 6 6-6"/></svg>
        </button>
    </div>

    <div class="sub-header-right">
        <button class="btn-primary">
            <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg>
            New Load
        </button>
        <button class="btn-ghost">
            <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7,10 12,15 17,10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            Export
        </button>
        <div class="view-toggle">
            <button class="view-toggle-btn active" title="Table View">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 6h18M3 12h18M3 18h18"/></svg>
            </button>
            <button class="view-toggle-btn" title="Map View">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polygon points="1,6 1,22 8,18 16,22 23,18 23,2 16,6 8,2"/></svg>
            </button>
        </div>
    </div>
</div>

<!-- ===== TABLE ===== -->
<div class="table-container">
    <div class="table-scroll">
        <table id="dispatchTable">
            <thead>
                <tr>
                    <th class="col-checkbox"><input type="checkbox" class="row-checkbox" id="selectAll"/></th>
                    <th class="col-status"></th>
                    <th class="col-load sortable">Load #<span class="sort-arrows"><svg class="active" viewBox="0 0 8 8"><path d="M4 0 L8 4 L0 4 Z" fill="currentColor"/></svg><svg viewBox="0 0 8 8"><path d="M0 0 L8 0 L4 4 Z" fill="currentColor"/></svg></span></th>
                    <th class="col-route">Route</th>
                    <th class="col-distance sortable" style="text-align:right">Distance<span class="sort-arrows"><svg viewBox="0 0 8 8"><path d="M4 0 L8 4 L0 4 Z" fill="currentColor"/></svg><svg viewBox="0 0 8 8"><path d="M0 0 L8 0 L4 4 Z" fill="currentColor"/></svg></span></th>
                    <th class="col-carrier">Carrier</th>
                    <th class="col-driver">Driver</th>
                    <th class="col-equip">Equip</th>
                    <th class="col-pickup sortable">Pickup<span class="sort-arrows"><svg viewBox="0 0 8 8"><path d="M4 0 L8 4 L0 4 Z" fill="currentColor"/></svg><svg viewBox="0 0 8 8"><path d="M0 0 L8 0 L4 4 Z" fill="currentColor"/></svg></span></th>
                    <th class="col-delivery sortable">Delivery<span class="sort-arrows"><svg viewBox="0 0 8 8"><path d="M4 0 L8 4 L0 4 Z" fill="currentColor"/></svg><svg viewBox="0 0 8 8"><path d="M0 0 L8 0 L4 4 Z" fill="currentColor"/></svg></span></th>
                    <th class="col-rate sortable" style="text-align:right">Rate<span class="sort-arrows"><svg viewBox="0 0 8 8"><path d="M4 0 L8 4 L0 4 Z" fill="currentColor"/></svg><svg viewBox="0 0 8 8"><path d="M0 0 L8 0 L4 4 Z" fill="currentColor"/></svg></span></th>
                    <th class="col-margin sortable" style="text-align:right">Margin<span class="sort-arrows"><svg viewBox="0 0 8 8"><path d="M4 0 L8 4 L0 4 Z" fill="currentColor"/></svg><svg class="active" viewBox="0 0 8 8"><path d="M0 0 L8 0 L4 4 Z" fill="currentColor"/></svg></span></th>
                    <th class="col-rpm" style="text-align:right">RPM</th>
                    <th class="col-actions">
                        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
                    </th>
                </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
        </table>
    </div>

    <!-- FOOTER -->
    <div class="table-footer">
        <span>Showing <strong>1-20</strong> of <strong>571</strong> loads</span>
        <div class="pagination">
            <button class="page-btn" disabled>
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg>
            </button>
            <button class="page-btn active">1</button>
            <button class="page-btn">2</button>
            <button class="page-btn">3</button>
            <button class="page-btn">4</button>
            <button class="page-btn" style="pointer-events:none;border:none;background:none;color:var(--text-muted)">...</button>
            <button class="page-btn">23</button>
            <button class="page-btn">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg>
            </button>
        </div>
    </div>
</div>

<!-- ===== BULK ACTION BAR ===== -->
<div class="bulk-bar" id="bulkBar">
    <span><span class="bulk-count" id="bulkCount">0</span> selected</span>
    <span class="bulk-divider"></span>
    <button class="bulk-action primary">Assign Carrier</button>
    <button class="bulk-action">Update Status</button>
    <button class="bulk-action">Export</button>
    <button class="bulk-close" id="bulkClose">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 6 6 18M6 6l12 12"/></svg>
    </button>
</div>

<script>
(function() {
    "use strict";

    // ===== MOCK DATA =====
    var loads = [
        { id: "LD-7841", status: "in-transit",  origin: "Chicago, IL",      dest: "Detroit, MI",       dist: 282,  carrier: "Midwest Express",      driver: "James Wilson",    equip: "Dry Van",   pickup: "Feb 8, 08:00",  delivery: "Feb 8, 16:00",  rate: 1850,  margin: 22.4, rpm: 3.28, sparkline: [18,22,19,24,22] },
        { id: "LD-7842", status: "in-transit",  origin: "Dallas, TX",       dest: "Houston, TX",       dist: 239,  carrier: "Lone Star Freight",    driver: "Carlos Mendez",   equip: "Reefer",    pickup: "Feb 8, 06:00",  delivery: "Feb 8, 14:00",  rate: 2100,  margin: 18.7, rpm: 4.39, sparkline: [15,18,20,17,19] },
        { id: "LD-7843", status: "in-transit",  origin: "Atlanta, GA",      dest: "Nashville, TN",     dist: 248,  carrier: "Southern Haul",        driver: "Devon Brooks",    equip: "Flatbed",   pickup: "Feb 7, 22:00",  delivery: "Feb 8, 10:00",  rate: 1920,  margin: 16.3, rpm: 3.87, sparkline: [14,16,15,18,16] },
        { id: "LD-7858", status: "in-transit",  origin: "San Antonio, TX",  dest: "El Paso, TX",       dist: 552,  carrier: "Texas Star Lines",     driver: "Miguel Alvarez",  equip: "Dry Van",   pickup: "Feb 8, 03:00",  delivery: "Feb 8, 20:00",  rate: 3100,  margin: 13.8, rpm: 2.81, sparkline: [11,13,12,15,14] },
        { id: "LD-7844", status: "unassigned",  origin: "Los Angeles, CA",  dest: "Phoenix, AZ",       dist: 372,  carrier: null,                   driver: null,              equip: "Dry Van",   pickup: "Feb 9, 07:00",  delivery: "Feb 9, 18:00",  rate: 2450,  margin: null, rpm: 3.29, sparkline: null },
        { id: "LD-7845", status: "unassigned",  origin: "Seattle, WA",      dest: "Portland, OR",      dist: 174,  carrier: null,                   driver: null,              equip: "Reefer",    pickup: "Feb 9, 05:00",  delivery: "Feb 9, 11:00",  rate: 1380,  margin: null, rpm: 3.97, sparkline: null },
        { id: "LD-7846", status: "unassigned",  origin: "Denver, CO",       dest: "Salt Lake City, UT",dist: 525,  carrier: null,                   driver: null,              equip: "Dry Van",   pickup: "Feb 9, 08:00",  delivery: "Feb 10, 06:00", rate: 3200,  margin: null, rpm: 3.05, sparkline: null },
        { id: "LD-7847", status: "tendered",    origin: "Miami, FL",        dest: "Jacksonville, FL",  dist: 346,  carrier: "Suncoast Logistics",   driver: "Maria Santos",    equip: "Reefer",    pickup: "Feb 9, 04:00",  delivery: "Feb 9, 14:00",  rate: 2680,  margin: 14.1, rpm: 3.87, sparkline: [12,14,11,15,14] },
        { id: "LD-7848", status: "tendered",    origin: "Boston, MA",       dest: "New York, NY",      dist: 215,  carrier: "Northeast Carriers",   driver: "Tom Fitzgerald",  equip: "Dry Van",   pickup: "Feb 9, 06:00",  delivery: "Feb 9, 12:00",  rate: 1750,  margin: 11.8, rpm: 4.07, sparkline: [10,12,9,13,12] },
        { id: "LD-7859", status: "tendered",    origin: "Portland, OR",     dest: "Boise, ID",         dist: 431,  carrier: "Mountain West Haul",   driver: "Jake Morrison",   equip: "Dry Van",   pickup: "Feb 10, 06:00", delivery: "Feb 10, 20:00", rate: 2870,  margin: 7.3,  rpm: 3.33, sparkline: [5,7,6,9,7] },
        { id: "LD-7849", status: "dispatched",  origin: "Kansas City, MO",  dest: "St. Louis, MO",     dist: 248,  carrier: "Heartland Transport",  driver: "Mike O'Brien",    equip: "Flatbed",   pickup: "Feb 8, 14:00",  delivery: "Feb 8, 22:00",  rate: 1640,  margin: 19.5, rpm: 3.31, sparkline: [17,19,21,18,20] },
        { id: "LD-7850", status: "dispatched",  origin: "Minneapolis, MN",  dest: "Milwaukee, WI",     dist: 337,  carrier: "Great Lakes Freight",  driver: "Sarah Johnson",   equip: "Dry Van",   pickup: "Feb 8, 12:00",  delivery: "Feb 9, 04:00",  rate: 2290,  margin: 21.3, rpm: 3.40, sparkline: [19,21,20,23,21] },
        { id: "LD-7851", status: "dispatched",  origin: "Philadelphia, PA", dest: "Baltimore, MD",     dist: 101,  carrier: "Mid-Atlantic Lines",   driver: "Kevin Park",      equip: "Dry Van",   pickup: "Feb 8, 10:00",  delivery: "Feb 8, 15:00",  rate: 980,   margin: 24.6, rpm: 4.85, sparkline: [22,24,21,26,25] },
        { id: "LD-7852", status: "dispatched",  origin: "Columbus, OH",     dest: "Indianapolis, IN",  dist: 176,  carrier: "Buckeye Carriers",     driver: "Lisa Chen",       equip: "Reefer",    pickup: "Feb 8, 13:00",  delivery: "Feb 8, 20:00",  rate: 1520,  margin: 8.4,  rpm: 4.32, sparkline: [7,9,6,10,8] },
        { id: "LD-7853", status: "delivered",   origin: "San Francisco, CA",dest: "Sacramento, CA",    dist: 87,   carrier: "Pacific Coast Trans",  driver: "Robert Kim",      equip: "Dry Van",   pickup: "Feb 7, 08:00",  delivery: "Feb 7, 13:00",  rate: 850,   margin: 15.2, rpm: 4.89, sparkline: [13,15,14,16,15] },
        { id: "LD-7854", status: "delivered",   origin: "Charlotte, NC",    dest: "Raleigh, NC",       dist: 167,  carrier: "Carolina Freight",     driver: "Angela White",    equip: "Flatbed",   pickup: "Feb 7, 06:00",  delivery: "Feb 7, 12:00",  rate: 1280,  margin: 17.9, rpm: 3.83, sparkline: [15,17,16,19,18] },
        { id: "LD-7855", status: "delivered",   origin: "Tampa, FL",        dest: "Orlando, FL",       dist: 84,   carrier: "Florida Express",      driver: "Daniel Torres",   equip: "Reefer",    pickup: "Feb 7, 05:00",  delivery: "Feb 7, 09:00",  rate: 720,   margin: 12.5, rpm: 4.29, sparkline: [10,12,11,14,13] },
        { id: "LD-7856", status: "completed",   origin: "Pittsburgh, PA",   dest: "Cleveland, OH",     dist: 130,  carrier: "Steel City Haulers",   driver: "Frank Miller",    equip: "Dry Van",   pickup: "Feb 6, 08:00",  delivery: "Feb 6, 14:00",  rate: 1100,  margin: 20.1, rpm: 4.23, sparkline: [18,20,19,22,20] },
        { id: "LD-7857", status: "completed",   origin: "Memphis, TN",      dest: "Little Rock, AR",   dist: 135,  carrier: "River Valley Trans",   driver: "Ray Thompson",    equip: "Flatbed",   pickup: "Feb 6, 06:00",  delivery: "Feb 6, 12:00",  rate: 1050,  margin: 9.2,  rpm: 3.89, sparkline: [7,9,8,11,9] },
        { id: "LD-7860", status: "completed",   origin: "Omaha, NE",        dest: "Des Moines, IA",    dist: 139,  carrier: "Plains Transport",     driver: "Amy Russell",     equip: "Reefer",    pickup: "Feb 5, 10:00",  delivery: "Feb 5, 16:00",  rate: 1180,  margin: 23.7, rpm: 4.25, sparkline: [21,23,22,25,24] }
    ];

    // Deterministic MC numbers keyed by carrier name
    var mcNumbers = {
        "Midwest Express": "MC-842391",
        "Lone Star Freight": "MC-915472",
        "Southern Haul": "MC-873204",
        "Texas Star Lines": "MC-901856",
        "Suncoast Logistics": "MC-887633",
        "Northeast Carriers": "MC-934517",
        "Mountain West Haul": "MC-856294",
        "Heartland Transport": "MC-868421",
        "Great Lakes Freight": "MC-923178",
        "Mid-Atlantic Lines": "MC-891045",
        "Buckeye Carriers": "MC-876532",
        "Pacific Coast Trans": "MC-945621",
        "Carolina Freight": "MC-812789",
        "Florida Express": "MC-897345",
        "Steel City Haulers": "MC-834567",
        "River Valley Trans": "MC-856789",
        "Plains Transport": "MC-823456"
    };

    var driverPhones = {
        "James Wilson": "(555) 312-4781",
        "Carlos Mendez": "(555) 469-8823",
        "Devon Brooks": "(555) 678-3341",
        "Miguel Alvarez": "(555) 512-9102",
        "Maria Santos": "(555) 786-2245",
        "Tom Fitzgerald": "(555) 234-6678",
        "Jake Morrison": "(555) 891-3345",
        "Mike O'Brien": "(555) 445-7712",
        "Sarah Johnson": "(555) 667-9934",
        "Kevin Park": "(555) 223-5567",
        "Lisa Chen": "(555) 334-8891",
        "Robert Kim": "(555) 556-1124",
        "Angela White": "(555) 778-4456",
        "Daniel Torres": "(555) 889-7789",
        "Frank Miller": "(555) 112-3345",
        "Ray Thompson": "(555) 445-6678",
        "Amy Russell": "(555) 778-9901"
    };

    var statusLabels = {
        "in-transit": "In Transit",
        "unassigned": "Unassigned",
        "tendered": "Tendered",
        "dispatched": "Dispatched",
        "delivered": "Delivered",
        "completed": "Completed"
    };

    var statusBadgeClass = {
        "in-transit": "badge-transit",
        "unassigned": "badge-unassigned",
        "tendered": "badge-tendered",
        "dispatched": "badge-dispatched",
        "delivered": "badge-delivered",
        "completed": "badge-completed"
    };

    var expandedRowId = null;
    var selectedRows = {};

    function selectedCount() {
        var c = 0;
        for (var k in selectedRows) { if (selectedRows[k]) c++; }
        return c;
    }

    function generateSparkline(data, color) {
        if (!data) return "";
        var w = 36, h = 14;
        var max = data[0], min = data[0];
        for (var i = 1; i < data.length; i++) {
            if (data[i] > max) max = data[i];
            if (data[i] < min) min = data[i];
        }
        var range = max - min;
        if (range === 0) range = 1;
        var pts = [];
        for (var i = 0; i < data.length; i++) {
            var x = (i / (data.length - 1)) * w;
            var y = h - ((data[i] - min) / range) * (h - 2) - 1;
            pts.push(x.toFixed(1) + "," + y.toFixed(1));
        }
        return '<svg class="sparkline" width="' + w + '" height="' + h + '" viewBox="0 0 ' + w + ' ' + h + '"><polyline points="' + pts.join(" ") + '" fill="none" stroke="' + color + '" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>';
    }

    function getMarginClass(margin) {
        if (margin === null) return "";
        if (margin > 15) return "margin-good";
        if (margin >= 10) return "margin-ok";
        return "margin-bad";
    }

    function getSparkColor(margin) {
        if (margin === null) return "#94a3b8";
        if (margin > 15) return "#059669";
        if (margin >= 10) return "#475569";
        return "#ef4444";
    }

    function escapeHtml(str) {
        var div = document.createElement("div");
        div.appendChild(document.createTextNode(str));
        return div.innerHTML;
    }

    function formatNumber(n) {
        return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function buildRow(load, isAlt) {
        var isExpanded = expandedRowId === load.id;
        var isSelected = !!selectedRows[load.id];

        var tr = document.createElement("tr");
        tr.className = "data-row" + (isAlt ? " alt-group" : "") + (isSelected ? " selected" : "");
        tr.setAttribute("data-status", load.status);
        tr.setAttribute("data-id", load.id);

        // Checkbox
        var tdCb = document.createElement("td");
        tdCb.className = "text-center";
        var cb = document.createElement("input");
        cb.type = "checkbox";
        cb.className = "row-checkbox";
        cb.checked = isSelected;
        cb.addEventListener("click", function(e) {
            e.stopPropagation();
            selectedRows[load.id] = !selectedRows[load.id];
            if (!selectedRows[load.id]) delete selectedRows[load.id];
            updateBulkBar();
            tr.classList.toggle("selected", !!selectedRows[load.id]);
            if (tr.querySelector("td.col-load")) {
                // update background
            }
        });
        tdCb.appendChild(cb);
        tr.appendChild(tdCb);

        // Status border
        var tdSt = document.createElement("td");
        tdSt.className = "status-border";
        tr.appendChild(tdSt);

        // Load #
        var tdLoad = document.createElement("td");
        tdLoad.className = "col-load";
        tdLoad.textContent = load.id;
        tr.appendChild(tdLoad);

        // Route
        var tdRoute = document.createElement("td");
        var routeDiv = document.createElement("div");
        routeDiv.className = "route-text";
        var originSpan = document.createElement("span");
        originSpan.className = "route-origin";
        originSpan.textContent = load.origin;
        var destSpan = document.createElement("span");
        destSpan.className = "route-dest";
        var arrowSpan = document.createElement("span");
        arrowSpan.className = "route-arrow";
        arrowSpan.innerHTML = "&darr;";
        destSpan.appendChild(arrowSpan);
        destSpan.appendChild(document.createTextNode(" " + load.dest));
        routeDiv.appendChild(originSpan);
        routeDiv.appendChild(destSpan);
        tdRoute.appendChild(routeDiv);
        tr.appendChild(tdRoute);

        // Distance
        var tdDist = document.createElement("td");
        tdDist.className = "text-right";
        var distVal = document.createElement("span");
        distVal.className = "distance-value";
        distVal.textContent = formatNumber(load.dist);
        var distUnit = document.createElement("span");
        distUnit.className = "distance-unit";
        distUnit.textContent = " mi";
        tdDist.appendChild(distVal);
        tdDist.appendChild(distUnit);
        tr.appendChild(tdDist);

        // Carrier
        var tdCarrier = document.createElement("td");
        if (load.carrier) {
            var cn = document.createElement("span");
            cn.className = "carrier-name";
            cn.textContent = load.carrier;
            tdCarrier.appendChild(cn);
        } else {
            var un = document.createElement("span");
            un.className = "unassigned-text";
            un.textContent = "Unassigned";
            tdCarrier.appendChild(un);
        }
        tr.appendChild(tdCarrier);

        // Driver
        var tdDriver = document.createElement("td");
        if (load.driver) {
            var dn = document.createElement("span");
            dn.className = "driver-name";
            dn.textContent = load.driver;
            tdDriver.appendChild(dn);
        } else {
            var un2 = document.createElement("span");
            un2.className = "unassigned-text";
            un2.textContent = "--";
            tdDriver.appendChild(un2);
        }
        tr.appendChild(tdDriver);

        // Equipment
        var tdEquip = document.createElement("td");
        var eqTag = document.createElement("span");
        eqTag.className = "equip-tag";
        eqTag.textContent = load.equip;
        tdEquip.appendChild(eqTag);
        tr.appendChild(tdEquip);

        // Pickup
        var tdPickup = document.createElement("td");
        var pickParts = load.pickup.split(", ");
        var pickDate = document.createElement("div");
        pickDate.className = "date-text";
        pickDate.textContent = pickParts[0];
        var pickTime = document.createElement("div");
        pickTime.className = "date-time";
        pickTime.textContent = pickParts[1] || "";
        tdPickup.appendChild(pickDate);
        tdPickup.appendChild(pickTime);
        tr.appendChild(tdPickup);

        // Delivery
        var tdDelivery = document.createElement("td");
        var delParts = load.delivery.split(", ");
        var delDate = document.createElement("div");
        delDate.className = "date-text";
        delDate.textContent = delParts[0];
        var delTime = document.createElement("div");
        delTime.className = "date-time";
        delTime.textContent = delParts[1] || "";
        tdDelivery.appendChild(delDate);
        tdDelivery.appendChild(delTime);
        tr.appendChild(tdDelivery);

        // Rate
        var tdRate = document.createElement("td");
        tdRate.className = "text-right";
        var rateSpan = document.createElement("span");
        rateSpan.className = "rate-value";
        rateSpan.textContent = "$" + formatNumber(load.rate);
        tdRate.appendChild(rateSpan);
        tr.appendChild(tdRate);

        // Margin + sparkline
        var tdMargin = document.createElement("td");
        tdMargin.className = "text-right";
        var marginDiv = document.createElement("div");
        marginDiv.className = "margin-cell";
        // Sparkline via a wrapper
        if (load.sparkline) {
            var sparkWrap = document.createElement("span");
            sparkWrap.innerHTML = generateSparkline(load.sparkline, getSparkColor(load.margin));
            marginDiv.appendChild(sparkWrap);
        }
        var marginSpan = document.createElement("span");
        marginSpan.className = "margin-value " + getMarginClass(load.margin);
        marginSpan.textContent = load.margin !== null ? load.margin.toFixed(1) + "%" : "--";
        marginDiv.appendChild(marginSpan);
        tdMargin.appendChild(marginDiv);
        tr.appendChild(tdMargin);

        // RPM
        var tdRpm = document.createElement("td");
        tdRpm.className = "text-right";
        var rpmSpan = document.createElement("span");
        rpmSpan.className = "rpm-value";
        rpmSpan.textContent = "$" + load.rpm.toFixed(2);
        tdRpm.appendChild(rpmSpan);
        tr.appendChild(tdRpm);

        // Actions
        var tdActions = document.createElement("td");
        tdActions.className = "text-center";
        var actBtn = document.createElement("button");
        actBtn.className = "action-btn";
        actBtn.innerHTML = '<svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>';
        actBtn.addEventListener("click", function(e) { e.stopPropagation(); });
        tdActions.appendChild(actBtn);
        tr.appendChild(tdActions);

        // Row click -> expand
        tr.addEventListener("click", function(e) {
            if (e.target.closest(".row-checkbox") || e.target.closest(".action-btn")) return;
            if (expandedRowId === load.id) {
                expandedRowId = null;
            } else {
                expandedRowId = load.id;
            }
            renderTable();
        });

        return tr;
    }

    function buildDetailRow(load) {
        var isExpanded = expandedRowId === load.id;

        var detailTr = document.createElement("tr");
        detailTr.className = "detail-row" + (isExpanded ? " open" : "");
        detailTr.id = "detail-" + load.id;

        var td = document.createElement("td");
        td.setAttribute("colspan", "14");

        var content = document.createElement("div");
        content.className = "detail-content";

        var grid = document.createElement("div");
        grid.className = "detail-grid";

        // --- Section 1: Route Details ---
        var sec1 = document.createElement("div");
        sec1.className = "detail-section";
        var h41 = document.createElement("h4");
        h41.textContent = "Route Details";
        sec1.appendChild(h41);

        var routeFields = [
            ["Origin", load.origin],
            ["Destination", load.dest],
            ["Distance", load.dist + " mi"],
            ["Equipment", load.equip],
            ["Pickup Window", load.pickup],
            ["Delivery Window", load.delivery]
        ];

        for (var i = 0; i < routeFields.length; i++) {
            var field = document.createElement("div");
            field.className = "detail-field";
            var label = document.createElement("span");
            label.className = "detail-label";
            label.textContent = routeFields[i][0];
            var value = document.createElement("span");
            value.className = "detail-value" + (routeFields[i][0] === "Distance" ? " mono" : "");
            value.textContent = routeFields[i][1];
            field.appendChild(label);
            field.appendChild(value);
            sec1.appendChild(field);
        }

        // Status badge
        var statusField = document.createElement("div");
        statusField.className = "detail-field";
        var statusLabel = document.createElement("span");
        statusLabel.className = "detail-label";
        statusLabel.textContent = "Status";
        var statusValue = document.createElement("span");
        statusValue.className = "detail-value";
        var badge = document.createElement("span");
        badge.className = "detail-status-badge " + statusBadgeClass[load.status];
        var dot = document.createElement("span");
        dot.className = "badge-dot";
        badge.appendChild(dot);
        badge.appendChild(document.createTextNode(statusLabels[load.status]));
        statusValue.appendChild(badge);
        statusField.appendChild(statusLabel);
        statusField.appendChild(statusValue);
        sec1.appendChild(statusField);

        grid.appendChild(sec1);

        // --- Section 2: Carrier & Driver ---
        var sec2 = document.createElement("div");
        sec2.className = "detail-section";
        var h42 = document.createElement("h4");
        h42.textContent = "Carrier & Driver";
        sec2.appendChild(h42);

        var carrierFields = [
            ["Carrier", load.carrier || "Not Assigned"],
            ["Driver", load.driver || "Not Assigned"],
            ["MC Number", load.carrier ? (mcNumbers[load.carrier] || "MC-000000") : "--"],
            ["Phone", load.driver ? (driverPhones[load.driver] || "--") : "--"],
            ["Insurance", load.carrier ? "Verified" : "--"]
        ];

        for (var j = 0; j < carrierFields.length; j++) {
            var field2 = document.createElement("div");
            field2.className = "detail-field";
            var label2 = document.createElement("span");
            label2.className = "detail-label";
            label2.textContent = carrierFields[j][0];
            var value2 = document.createElement("span");
            value2.className = "detail-value";
            if (carrierFields[j][0] === "MC Number") value2.classList.add("mono");
            if (carrierFields[j][0] === "Insurance" && carrierFields[j][1] === "Verified") {
                value2.style.color = "var(--success)";
            }
            if (!load.carrier && (carrierFields[j][0] === "Carrier" || carrierFields[j][0] === "Driver")) {
                value2.classList.add("unassigned-text");
            }
            value2.textContent = carrierFields[j][1];
            field2.appendChild(label2);
            field2.appendChild(value2);
            sec2.appendChild(field2);
        }

        grid.appendChild(sec2);

        // --- Section 3: Financial ---
        var sec3 = document.createElement("div");
        sec3.className = "detail-section";
        var h43 = document.createElement("h4");
        h43.textContent = "Financial";
        sec3.appendChild(h43);

        var carrierCost = load.carrier && load.margin !== null ? Math.round(load.rate * (1 - load.margin / 100)) : null;
        var profit = load.margin !== null ? Math.round(load.rate * load.margin / 100) : null;

        var finFields = [
            ["Customer Rate", "$" + formatNumber(load.rate), true, null],
            ["Carrier Cost", carrierCost !== null ? "$" + formatNumber(carrierCost) : "--", true, null],
            ["Margin", load.margin !== null ? load.margin.toFixed(1) + "%" : "--", true, getMarginClass(load.margin)],
            ["Profit", profit !== null ? "$" + formatNumber(profit) : "--", true, getMarginClass(load.margin)],
            ["Rate/Mile", "$" + load.rpm.toFixed(2), true, null],
            ["Payment Terms", "Net 30", false, null]
        ];

        for (var k = 0; k < finFields.length; k++) {
            var field3 = document.createElement("div");
            field3.className = "detail-field";
            var label3 = document.createElement("span");
            label3.className = "detail-label";
            label3.textContent = finFields[k][0];
            var value3 = document.createElement("span");
            value3.className = "detail-value" + (finFields[k][2] ? " mono" : "");
            if (finFields[k][3]) value3.classList.add(finFields[k][3]);
            if (finFields[k][0] === "Customer Rate") {
                value3.style.fontSize = "14px";
                value3.style.fontWeight = "700";
            }
            value3.textContent = finFields[k][1];
            field3.appendChild(label3);
            field3.appendChild(value3);
            sec3.appendChild(field3);
        }

        grid.appendChild(sec3);

        content.appendChild(grid);
        td.appendChild(content);
        detailTr.appendChild(td);

        return detailTr;
    }

    function renderTable() {
        var tbody = document.getElementById("tableBody");
        // Clear
        while (tbody.firstChild) tbody.removeChild(tbody.firstChild);

        var prevStatus = null;
        var groupIndex = 0;

        for (var i = 0; i < loads.length; i++) {
            var load = loads[i];
            if (load.status !== prevStatus) {
                groupIndex++;
                prevStatus = load.status;
            }
            var isAlt = groupIndex % 2 === 0;

            var row = buildRow(load, isAlt);
            tbody.appendChild(row);

            var detailRow = buildDetailRow(load);
            tbody.appendChild(detailRow);
        }
    }

    function updateBulkBar() {
        var bar = document.getElementById("bulkBar");
        var count = document.getElementById("bulkCount");
        var c = selectedCount();
        if (c > 0) {
            bar.classList.add("visible");
            count.textContent = c;
        } else {
            bar.classList.remove("visible");
        }
    }

    function clearSelection() {
        selectedRows = {};
        updateBulkBar();
        renderTable();
    }

    // Select all
    document.getElementById("selectAll").addEventListener("change", function(e) {
        if (e.target.checked) {
            for (var i = 0; i < loads.length; i++) {
                selectedRows[loads[i].id] = true;
            }
        } else {
            selectedRows = {};
        }
        updateBulkBar();
        renderTable();
    });

    // Bulk close
    document.getElementById("bulkClose").addEventListener("click", clearSelection);

    // Initial render
    renderTable();

})();
</script>

</body>
</html>
